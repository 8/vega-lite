!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.vl=e()}}(function(){return function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(i)return i(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return a(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,n){"use strict";var r=(e("./globals"),e("./util")),a=e("./consts"),i={};r.extend(i,a,r),i.Encoding=e("./Encoding"),i.compile=e("./compile/compile"),i.data=e("./data"),i.field=e("./field"),i.enc=e("./enc"),i.schema=e("./schema/schema"),i.toShorthand=i.Encoding.shorthand,t.exports=i},{"./Encoding":22,"./compile/compile":26,"./consts":40,"./data":41,"./enc":42,"./field":43,"./globals":44,"./schema/schema":45,"./util":47}],2:[function(e,t,n){},{}],3:[function(e,t,n){function r(){if(!s){s=!0;for(var e,t=o.length;t;){e=o,o=[];for(var n=-1;++n<t;)e[n]();t=o.length}s=!1}}function a(){}var i=t.exports={},o=[],s=!1;i.nextTick=function(e){o.push(e),s||setTimeout(r,0)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=a,i.addListener=a,i.once=a,i.off=a,i.removeListener=a,i.removeAllListeners=a,i.emit=a,i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],4:[function(e,t,n){function r(e){e=e||{};var t,n,r,s,u,l,c,f,d=e.maxbins||15,p=e.base||10,n=Math.log(p),m=e.div||[5,2],h=e.min,g=e.max,y=g-h;if(null!=e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,a(e.steps,y/d,0,e.steps.length))];else{r=Math.ceil(Math.log(d)/n),s=e.minstep||0,t=Math.max(s,Math.pow(p,Math.round(Math.log(y)/n)-r));do t*=p;while(Math.ceil(y/t)>d);for(c=0;c<m.length;++c)l=t/m[c],l>=s&&d>=y/l&&(t=l)}return l=Math.log(t),u=l>=0?0:~~(-l/n)+1,f=Math.pow(p,-u-1),h=Math.min(h,Math.floor(h/t+f)*t),g=Math.ceil(g/t)*t,{start:h,stop:g,step:t,unit:{precision:u},value:i,index:o}}function a(e,t,n,r){for(;r>n;){var a=n+r>>>1;l.cmp(e[a],t)<0?n=a+1:r=a}return n}function i(e){return this.step*Math.floor(e/this.step+f)}function o(e){return Math.floor((e-this.start)/this.step+f)}function s(e){return this.unit.date(i.call(this,e))}function u(e){return o.call(this,this.unit.unit(e))}var l=e("./util"),c=e("./date-units"),f=1e-15;r.date=function(e){e=e||{};var t=e.min,n=e.max,a=e.maxbins||20,i=e.minbins||4,o=+n-+t;return unit=e.unit?c[e.unit]:c.find(o,i,a),bins=r({min:null!=unit.min?unit.min:unit.unit(t),max:null!=unit.max?unit.max:unit.unit(n),maxbins:a,minstep:unit.minstep,steps:unit.step}),bins.unit=unit,bins.index=u,e.raw||(bins.value=s),bins},t.exports=r},{"./date-units":5,"./util":21}],5:[function(e,t,n){var r=e("./util"),a=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]],i=[{type:"second",minstep:1,format:"%Y %b %-d %H:%M:%S.%L",date:function(e){return new Date(1e3*e)},unit:function(e){return+e/1e3}},{type:"minute",minstep:1,format:"%Y %b %-d %H:%M",date:function(e){return new Date(6e4*e)},unit:function(e){return~~(+e/6e4)}},{type:"hour",minstep:1,format:"%Y %b %-d %H:00",date:function(e){return new Date(36e5*e)},unit:function(e){return~~(+e/36e5)}},{type:"day",minstep:1,step:[1,7],format:"%Y %b %-d",date:function(e){return new Date(864e5*e)},unit:function(e){return~~(+e/864e5)}},{type:"month",minstep:1,step:[1,3,6],format:"%b %Y",date:function(e){return new Date(Date.UTC(~~(e/12),e%12,1))},unit:function(e){return r.isNumber(e)&&(e=new Date(e)),12*e.getUTCFullYear()+e.getUTCMonth()}},{type:"year",minstep:1,format:"%Y",date:function(e){return new Date(Date.UTC(e,0,1))},unit:function(e){return(r.isNumber(e)?new Date(e):e).getUTCFullYear()}}],o={type:"minuteOfHour",min:0,max:59,minstep:1,format:"%M",date:function(e){return new Date(Date.UTC(1970,0,1,0,e))},unit:function(e){return(r.isNumber(e)?new Date(e):e).getUTCMinutes()}},s={type:"hourOfDay",min:0,max:23,minstep:1,format:"%H",date:function(e){return new Date(Date.UTC(1970,0,1,e))},unit:function(e){return(r.isNumber(e)?new Date(e):e).getUTCHours()}},u={type:"dayOfWeek",min:0,max:6,step:[1],format:"%a",date:function(e){return new Date(Date.UTC(1970,0,4+e))},unit:function(e){return(r.isNumber(e)?new Date(e):e).getUTCDay()}},l={type:"dayOfMonth",min:1,max:31,step:[1],format:"%-d",date:function(e){return new Date(Date.UTC(1970,0,e))},unit:function(e){return(r.isNumber(e)?new Date(e):e).getUTCDate()}},c={type:"monthOfYear",min:0,max:11,step:[1],format:"%b",date:function(e){return new Date(Date.UTC(1970,e%12,1))},unit:function(e){return(r.isNumber(e)?new Date(e):e).getUTCMonth()}},f={second:i[0],minute:i[1],hour:i[2],day:i[3],month:i[4],year:i[5],minuteOfHour:o,hourOfDay:s,dayOfWeek:u,dayOfMonth:l,monthOfYear:c,timesteps:i};f.find=function(e,t,n){var r,o,s,u=a[0];for(r=1,o=a.length;o>r;++r)if(u=a[r],e>u[0]){if(s=e/u[0],s>n)return i[a[r-1][1]];if(s>=t)return i[u[1]]}return i[a[a.length-1][1]]},t.exports=f},{"./util":21}],6:[function(e,t,n){var r=t.exports={};r.repeat=function(e,t){var n,r=Array(t);for(n=0;t>n;++n)r[n]=e;return r},r.zeros=function(e){return r.repeat(0,e)},r.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,a=[],i=-1;if(0>n)for(;(r=e+n*++i)>t;)a.push(r);else for(;(r=e+n*++i)<t;)a.push(r);return a},r.random={},r.random.uniform=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,a=function(){return e+n*Math.random()};return a.samples=function(e){return r.zeros(e).map(a)},a},r.random.integer=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,a=function(){return e+Math.floor(n*Math.random())};return a.samples=function(e){return r.zeros(e).map(a)},a},r.random.normal=function(e,t){e=e||0,t=t||1;var n=void 0,a=function(){var r,a,i=0,o=0;if(void 0!==n)return i=n,n=void 0,i;do i=2*Math.random()-1,o=2*Math.random()-1,r=i*i+o*o;while(0==r||r>1);return a=Math.sqrt(-2*Math.log(r)/r),n=e+o*a*t,e+i*a*t};return a.samples=function(e){return r.zeros(e).map(a)},a}},{}],7:[function(e,t,n){function r(e,t){var n,r=null;if(e.types&&(r=t(e.types),s.isString(r)))return r;for(n=0;!s.isNotNull(r)&&n<e.length;++n)r=t?t(e[n]):e[n];return s.isDate(r)?"date":s.isNumber(r)?"number":"string"}function a(e,t,n){for(var r,a,i=l.range(n.start,n.stop+n.step/2,n.step).map(function(e){return{value:n.value(e),count:0}}),o=0;o<e.length;++o)if(r=t?t(e[o]):e[o],s.isNotNull(r)){if(a=n.index(r),0>a||a>=i.length||!isFinite(a))continue;i[a].count+=1}return i.bins=n,i}function i(e,t,n){var r=o.unique(e,t).counts;return s.keys(r).map(function(e){return{value:e,count:r[e]}}).sort(s.comparator(n?"-count":"+value"))}var o=e("./stats"),s=e("./util"),u=e("./bin"),l=e("./generate");t.exports=function(e,t,n){void 0!==n||s.isFunction(t)||(n=t,t=null);var l=n&&n.type||r(e,t);if("number"!==l&&"date"!==l&&"integer"!==l)return i(e,t,n&&n.sort);var c=o.extent(e,t),f=s.extend({min:c[0],max:c[1]},n);"integer"===l&&null==f.minstep&&(f.minstep=1);var d="date"===l?u.date(f):u(f);return a(e,t,d)}},{"./bin":4,"./generate":6,"./stats":18,"./util":21}],8:[function(e,t,n){(function(e){var n="undefined"!=typeof window?window.d3:"undefined"!=typeof e?e.d3:null;t.exports=function(e,t){var r=n.csv.parse(e?e.toString():e);return r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,t,n){t.exports={json:e("./json"),csv:e("./csv"),tsv:e("./tsv"),topojson:e("./topojson"),treejson:e("./treejson")}},{"./csv":8,"./json":10,"./topojson":11,"./treejson":12,"./tsv":13}],10:[function(e,t,n){var r=e("../../util");t.exports=function(e,t){var n=r.isObject(e)&&!r.isBuffer(e)?e:JSON.parse(e);return t&&t.property&&(n=r.accessor(t.property)(n)),n}},{"../../util":21}],11:[function(e,t,n){(function(n){var r=e("./json"),a="undefined"!=typeof window?window.topojson:"undefined"!=typeof n?n.topojson:null;t.exports=function(e,t){if(null==a)throw Error("TopoJSON library not loaded.");var n,i=r(e,t);if(t&&t.feature){if(n=i.objects[t.feature])return a.feature(i,n).features;throw Error("Invalid TopoJSON object: "+t.feature)}if(t&&t.mesh){if(n=i.objects[t.mesh])return[a.mesh(i,i.objects[t.mesh])];throw Error("Invalid TopoJSON object: "+t.mesh)}throw Error("Missing TopoJSON feature or mesh parameter.")}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./json":10}],12:[function(e,t,n){function r(e,t){function n(e,a){r.push(e);var i=e[t];if(i)for(var o=0;o<i.length;++o)n(i[o],e)}t=t||"children";var r=[];return n(e,null),r.root=e,r}var a=e("./json");t.exports=function(e,t){return e=a(e,t),r(e,t&&t.children)}},{"./json":10}],13:[function(e,t,n){(function(e){var n="undefined"!=typeof window?window.d3:"undefined"!=typeof e?e.d3:null;t.exports=function(e,t){var r=n.tsv.parse(e?e.toString():e);return r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(e,t,n){function r(t){var n=t.url;if(!n&&t.file)return f+t.file;if(t.baseURL&&!c.test(n)&&(l.startsWith(n,"/")||"/"===t.baseURL[t.baseURL.length-1]||(n="/"+n),n=t.baseURL+n),l.isNode&&l.startsWith(n,"//")&&(n=(t.defaultProtocol||"http")+":"+n),t.domainWhiteList){var r,a;if(l.isNode){var i=e("url").parse(n);r=i.hostname,a=null}else{var o=document.createElement("a");o.href=n,""==o.host&&(o.href=o.href),r=o.hostname.toLowerCase(),a=window.location.hostname}if(a!==r){var s=t.domainWhiteList.some(function(e){var t=r.length-e.length;return e===r||t>1&&"."===r[t-1]&&r.lastIndexOf(e)===t});if(!s)throw"URL is not whitelisted: "+n}}return n}function a(e,t){var n=t||function(e){throw e};try{var r=a.sanitizeUrl(e)}catch(i){return void n(i)}return r?l.isNode?l.startsWith(r,f)?s(r.slice(f.length),t):u(r,t):o(r,t):void n("Invalid URL: "+r)}function i(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}function o(e,t){function n(){var e=a.status;!e&&i(a)||e>=200&&300>e||304===e?t(null,a.responseText):t(a,null)}var r=!!t,a=new XMLHttpRequest;return!this.XDomainRequest||"withCredentials"in a||!/^(http(s)?:)?\/\//.test(e)||(a=new XDomainRequest),r&&("onload"in a?a.onload=a.onerror=n:a.onreadystatechange=function(){a.readyState>3&&n()}),a.open("GET",e,r),a.send(),!r&&i(a)?a.responseText:void 0}function s(t,n){var r=e("fs");return n?void e("fs").readFile(t,n):r.readFileSync(t,"utf8")}function u(t,n){return n?void e("request")(t,function(e,t,r){e||200!==t.statusCode?n(e,null):n(null,r)}):e("sync-request")("GET",t).getBody()}var l=e("../util"),c=/^([A-Za-z]+:)?\/\//,f="file://";a.sanitizeUrl=r,t.exports=a},{"../util":21,fs:2,request:2,"sync-request":2,url:2}],15:[function(e,t,n){var r=e("../util"),a=e("./load"),i=e("./read");t.exports=r.keys(i.formats).reduce(function(e,t){return e[t]=function(e,n,o){r.isString(e)&&(e={url:e}),2===arguments.length&&r.isFunction(n)&&(o=n,n=void 0),n=r.extend({parse:"auto"},n),n.type=t;var s=a(e,o?function(e,t){e&&o(e,null);try{t=i(t,n)}catch(r){o(r,null)}o(null,t)}:void 0);return s?i(s,n):void 0},e},{})},{"../util":21,"./load":14,"./read":16}],16:[function(e,t,n){function r(e,t){var n=t&&t.type||"json";return e=u[n](e,t),t&&t.parse&&o(e,t.parse),e}function a(e,t){var n,r,a,i=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(a=t?t(e[n]):e[n],r=0;r<i.length;++r)s.isNotNull(a)&&!c[i[r]](a)&&(i.splice(r,1),r-=1);if(0===i.length)return"string"}return i[0]}function i(e,t){return t=t||s.keys(e[0]),t.reduce(function(t,n){var r=a(e,s.accessor(n));return l[r]&&(t[n]=r),t},{})}function o(e,t){var n,r,a,o,u,c,f=e.length;for(t="auto"===t?i(e):s.duplicate(t),n=s.keys(t),r=n.map(function(e){return l[t[e]]}),o=0,c=n.length;f>o;++o)for(a=e[o],u=0;c>u;++u)a[n[u]]=r[u](a[n[u]]);e.types=t}var s=e("../util"),u=e("./formats"),l={"boolean":s["boolean"],integer:s.number,number:s.number,date:s.date,string:s.identity},c={"boolean":function(e){return"true"===e||"false"===e||s.isBoolean(e)},integer:function(e){return c.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!s.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};r.type=a,r.types=i,r.formats=u,r.parse=o,t.exports=r},{"../util":21,"./formats":9}],17:[function(e,t,n){var r=e("./util"),a={load:e("./import/load"),read:e("./import/read"),bin:e("./bin"),histogram:e("./histogram"),summary:e("./summary"),template:e("./template"),dateunits:e("./date-units")};r.extend(a,r),r.extend(a,e("./generate")),r.extend(a,e("./stats")),r.extend(a,e("./import/loaders")),t.exports=a},{"./bin":4,"./date-units":5,"./generate":6,"./histogram":7,"./import/load":14,"./import/loaders":15,"./import/read":16,"./stats":18,"./summary":19,"./template":20,"./util":21}],18:[function(e,t,r){var a=e("./util"),i=e("./generate"),o={};o.unique=function(e,t,r){if(!a.isArray(e)||0===e.length)return[];r=r||[];var i,o,s={};for(o=0,n=e.length;o<n;++o)i=t?t(e[o]):e[o],i in s?s[i]+=1:(s[i]=1,r.push(i));return r.counts=s,r},o.count=function(e,t){if(!a.isArray(e)||0===e.length)return 0;var r,i,o=0;for(i=0,n=e.length;i<n;++i)r=t?t(e[i]):e[i],null!=r&&(o+=1);return o},o.count.distinct=function(e,t){if(!a.isArray(e)||0===e.length)return 0;var r,i,o={},s=0;for(i=0,n=e.length;i<n;++i)r=t?t(e[i]):e[i],r in o||(o[r]=1,s+=1);return s},o.count.nulls=function(e,t){if(!a.isArray(e)||0===e.length)return 0;var r,i,o=0;for(i=0,n=e.length;i<n;++i)r=t?t(e[i]):e[i],null==r&&(o+=1);return o},o.median=function(e,t){if(!a.isArray(e)||0===e.length)return 0;t&&(e=e.map(t)),e=e.filter(a.isNotNull).sort(a.cmp);var n=Math.floor(e.length/2);return e.length%2?e[n]:(e[n-1]+e[n])/2},o.quantile=function(e,t,n){void 0===n&&(n=t,t=a.identity);var r=(e.length-1)*n+1,i=Math.floor(r),o=+t(e[i-1]),s=r-i;return s?o+s*(t(e[i])-o):o},o.mean=function(e,t){if(!a.isArray(e)||0===e.length)return 0;var n,r,i,o,s=0;for(r=0,i=0;r<e.length;++r)o=t?t(e[r]):e[r],null==o||isNaN(o)||(n=o-s,s+=n/++i);return s},o.variance=function(e,t){if(!a.isArray(e)||0===e.length)return 0;var n,r,i,o,s=0,u=0;for(r=0,i=0;r<e.length;++r)o=t?t(e[r]):e[r],null==o||isNaN(o)||(n=o-s,s+=n/++i,u+=n*(o-s));return u/=i-1},o.stdev=function(e,t){return Math.sqrt(o.variance(e,t))},o.modeskew=function(e,t){var n=o.mean(e,t),r=o.median(e,t),a=o.stdev(e,t);return 0===a?0:(n-r)/a},o.extent=function(e,t){var n,r,i,o,s=e.length;for(o=0;s>o;++o)if(i=t?t(e[o]):e[o],i="string"==typeof i?i.length:i,a.isNotNull(i)){n=r=i;break}for(;s>o;++o)i=t?t(e[o]):e[o],i="string"==typeof i?i.length:i,a.isNotNull(i)&&(n>i&&(n=i),i>r&&(r=i));return[n,r]},o.extent.index=function(e,t){var n,r,i,o,s,u,l=e.length;for(u=0;l>u;++u)if(s=t?t(e[u]):e[u],s="string"==typeof s?s.length:s,a.isNotNull(s)){n=r=s,i=o=u;break}for(;l>u;++u)s=t?t(e[u]):e[u],s="string"==typeof s?s.length:s,a.isNotNull(s)&&(n>s&&(n=s,i=u),s>r&&(r=s,o=u));return[i,o]},o.dot=function(e,t,n){var r,a,i=0;if(n)for(r=0;r<e.length;++r)a=t(e[r])*n(e[r]),isNaN(a)||(i+=a);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(r=0;r<e.length;++r)a=e[r]*t[r],isNaN(a)||(i+=a)}return i},o.rank=function(e,t){var n,r,i,o=e.map(function(e,n){return{idx:n,val:t?t(e):e}}).sort(a.comparator("val")),s=e.length,u=Array(s),l=-1,c={};for(n=0;s>n;++n){if(r=o[n].val,0>l&&c===r)l=n-1;else if(l>-1&&c!==r){for(i=1+(n-1+l)/2;n>l;++l)u[o[l].idx]=i;l=-1}u[o[n].idx]=n+1,c=r}if(l>-1)for(i=1+(s-1+l)/2;s>l;++l)u[o[l].idx]=i;return u},o.cor=function(e,t,n){var r=n;n=r?e.map(n):t,t=r?e.map(t):e;var a=o.dot(t,n),i=o.mean(t),s=o.mean(n),u=o.stdev(t),l=o.stdev(n),c=e.length;return(a-c*i*s)/((c-1)*u*l)},o.cor.rank=function(e,t,n){var r,a,i,s=n?o.rank(e,t):o.rank(e),u=n?o.rank(e,n):o.rank(t),l=e.length;for(r=0,a=0;l>r;++r)i=s[r]-u[r],a+=i*i;return 1-6*a/(l*(l*l-1))},o.cor.dist=function(e,t,n){var r,a,i,s,u=n?e.map(t):e,l=n?e.map(n):t,c=o.dist.mat(u),f=o.dist.mat(l),d=c.length;for(r=0,a=0,i=0,s=0;d>r;++r)a+=c[r]*c[r],i+=f[r]*f[r],s+=c[r]*f[r];return Math.sqrt(s/Math.sqrt(a*i))},o.dist=function(e,t,n,r){var i,o,s=a.isFunction(n),u=e,l=s?e:t,c=s?r:n,f=e.length,d=0;if(2===c||void 0===c){for(o=0;f>o;++o)i=s?t(u[o])-n(l[o]):u[o]-l[o],d+=i*i;return Math.sqrt(d)}for(o=0;f>o;++o)i=Math.abs(s?t(u[o])-n(l[o]):u[o]-l[o]),d+=Math.pow(i,c);return Math.pow(d,1/c)},o.dist.mat=function(e){var t,n,r,a=e.length,o=a*a,s=Array(o),u=i.zeros(a),l=0;for(n=0;a>n;++n)for(s[n*a+n]=0,r=n+1;a>r;++r)s[n*a+r]=t=Math.abs(e[n]-e[r]),s[r*a+n]=t,u[n]+=t,u[r]+=t;for(n=0;a>n;++n)l+=u[n],u[n]/=a;for(l/=o,n=0;a>n;++n)for(r=n;a>r;++r)s[n*a+r]+=l-u[n]-u[r],s[r*a+n]=s[n*a+r];return s},o.entropy=function(e,t){var n,r,a=0,i=0,o=e.length;for(n=0;o>n;++n)a+=t?t(e[n]):e[n];if(0===a)return 0;for(n=0;o>n;++n)r=(t?t(e[n]):e[n])/a,r>0&&(i+=r*Math.log(r)/Math.LN2);return-i},o.entropy.normalized=function(e,t){var n=o.entropy(e,t);return 0===n?0:n*Math.LN2/Math.log(e.length)},o.entropy.mutual=function(e,t,n,r){var a,i,o,s=r?e.map(t):e,u=r?e.map(n):t,l=r?e.map(r):n,c={},f={},d=0,p=l.length,m=0;for(a=0;p>a;++a)c[s[a]]=0,f[u[a]]=0;for(a=0;p>a;++a)c[s[a]]+=l[a],f[u[a]]+=l[a],d+=l[a];for(i=1/(d*Math.LN2),a=0;p>a;++a)0!==l[a]&&(o=d*l[a]/(c[s[a]]*f[u[a]]),m+=l[a]*i*Math.log(o));return m},o.profile=function(e,t){var n,r,i,s,u,l=0,f=0,d=0,p=null,m=null,h=0,g=[],y={};for(i=0,c=0;i<e.length;++i)s=t?t(e[i]):e[i],y[s]=s in y?y[s]+1:(d+=1,1),a.isNotNull(s)&&(u="string"==typeof s?s.length:s,(null===p||p>u)&&(p=u),(null===m||u>m)&&(m=u),n=u-l,l+=n/++f,h+=n*(u-l),g.push(u));return h/=f-1,r=Math.sqrt(h),g.sort(a.cmp),{unique:y,count:f,nulls:e.length-f,distinct:d,min:p,max:m,mean:l,stdev:r,median:s=o.quantile(g,.5),modeskew:0===r?0:(l-s)/r,iqr:[o.quantile(g,.25),o.quantile(g,.75)]}},t.exports=o},{"./generate":6,"./util":21}],19:[function(e,t,n){function r(){var e=this,t=[];return e.forEach(function(e){t.push("----- Field: '"+e.field+"' -----"),t.push("string"==typeof e.min||e.distinct<10?i(e):a(e)),t.push("")}),t.join("\n")}function a(e){return["distinct: "+e.distinct,"nulls:    "+e.nulls,"min:      "+e.min,"max:      "+e.max,"median:   "+e.median,"mean:     "+e.mean,"stdev:    "+e.stdev,"modeskew: "+e.modeskew].join("\n")}function i(e){var t=["distinct: "+e.distinct,"nulls:    "+e.nulls,"top values: "],n=e.unique,r=o.keys(n).sort(function(e,t){return n[t]-n[e]}).slice(0,6).map(function(e){return" '"+e+"' ("+n[e]+")"});return t.concat(r).join("\n")}var o=e("./util"),s=e("./stats");t.exports=function(e,t){if(null==e||0===e.length)return null;t=t||o.keys(e[0]);var n=t.map(function(t){var n=s.profile(e,o.accessor(t));return n.field=t,n});return n.toString=r,n}},{"./stats":18,"./util":21}],20:[function(e,t,n){(function(n){function r(e){var t=a(e,"d");t="var __t; return "+t+";";try{return new Function("d",t).bind(c)}catch(n){throw n.source=t,n}}function a(e,t){t=t||"obj";var n=0,r="'",a=f;return e.replace(a,function(a,s,u){return r+=e.slice(n,u).replace(p,o),n=u+a.length,s&&(r+="'\n+((__t=("+i(s,t)+"))==null?'':__t)+\n'"),a}),r+"'"}function i(e,t){function n(e){return e=e||"",i?(i=!1,o="String("+o+")"+e):o+=e,o}var r=e.split("|"),a=r.shift().trim(),i=!0,o=u.field(a).map(u.str).join("][");o=t+"["+o+"]";for(var c=0;c<r.length;++c){var f,d,p,m=r[c],h=null;switch((f=m.indexOf(":"))>0&&(m=m.slice(0,f),h=r[c].slice(f+1).split(",").map(function(e){return e.trim()})),m=m.trim()){case"length":n(".length");break;case"lower":n(".toLowerCase()");break;case"upper":n(".toUpperCase()");break;case"lower-locale":n(".toLocaleLowerCase()");break;case"upper-locale":n(".toLocaleUpperCase()");break;case"trim":n(".trim()");break;case"left":d=u.number(h[0]),n(".slice(0,"+d+")");break;case"right":d=u.number(h[0]),n(".slice(-"+d+")");break;case"mid":d=u.number(h[0]),p=d+u.number(h[1]),n(".slice(+"+d+","+p+")");break;case"slice":d=u.number(h[0]),n(".slice("+d+(h.length>1?","+u.number(h[1]):"")+")");break;case"truncate":d=u.number(h[0]),p=h[1],p="left"!==p&&"middle"!==p&&"center"!==p?"right":p,o="this.truncate("+n()+","+d+',"'+p+'")';break;case"number":d=s(h[0],l.format),i=!1,o="this.formats["+d+"]("+o+")";break;case"time":d=s(h[0],l.time.format),i=!1,o="this.formats["+d+"]("+o+")";break;default:throw Error("Unrecognized template filter: "+m)}}return o}function o(e){return"\\"+d[e]}function s(e,t){if(!("'"===e[0]&&"'"===e[e.length-1]||'"'!==e[0]&&'"'===e[e.length-1]))throw Error("Format pattern must be quoted: "+e);if(e=e.slice(1,-1),!c.format_map[e]){var n=t(e),r=c.formats.length;c.formats.push(n),c.format_map[e]=r}return c.format_map[e]}var u=e("./util"),l="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,c={formats:[],format_map:{},truncate:u.truncate};t.exports=r,r.clearFormatCache=function(){c.formats=[],c.format_map={}};var f=/\{\{(.+?)\}\}|$/g,d={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},p=/\\|'|\r|\n|\u2028|\u2029/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./util":21}],21:[function(e,t,n){(function(n){function r(e){return e.replace(u,"$1\\'")}function a(e,t,n){var r=0,a=e.split(l);return e=n?(a=a.reverse()).filter(function(e){return r+=e.length,t>=r}).reverse():a.filter(function(e){return r+=e.length,t>=r}),e.length?e.join("").trim():a[0].slice(0,t)}var i=e("buffer").Buffer,o=t.exports={};o.isNode="undefined"!=typeof n&&"undefined"!=typeof n.stderr;var s=Object.prototype.toString;o.isObject=function(e){return e===Object(e)},o.isFunction=function(e){return"[object Function]"==s.call(e)},o.isString=function(e){return"[object String]"==s.call(e)},o.isArray=Array.isArray||function(e){return"[object Array]"==s.call(e)},o.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},o.isBoolean=function(e){return"[object Boolean]"==s.call(e)},o.isDate=function(e){return"[object Date]"==s.call(e)},o.isNotNull=function(e){return null!=e&&("number"!=typeof e?!0:!isNaN(e))},o.isBuffer=i&&i.isBuffer||o["false"],o.number=function(e){return null==e?null:+e},o["boolean"]=function(e){return null==e?null:"false"===e?!1:!!e},o.date=function(e){return null==e?null:Date.parse(e)},o.array=function(e){return null!=e?o.isArray(e)?e:[e]:[]},o.str=function(e){return o.isArray(e)?"["+e.map(o.str)+"]":o.isObject(e)?JSON.stringify(e):o.isString(e)?"'"+r(e)+"'":e};var u=/(^|[^\\])'/g;o.identity=function(e){return e},o["true"]=function(){return!0},o["false"]=function(){return!1},o.duplicate=function(e){return JSON.parse(JSON.stringify(e))},o.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},o.extend=function(e){for(var t,n,r=1,a=arguments.length;a>r;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},o.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},o.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},o.toMap=function(e){return e.reduce(function(e,t){return e[t]=1,e},{})},o.keystr=function(e){return e.join("|")},o.field=function(e){return e.split("\\.").map(function(e){return e.split(".")}).reduce(function(e,t){return e.length&&(e[e.length-1]+="."+t.shift()),e.push.apply(e,t),e},[])},o.accessor=function(e){var t;return o.isFunction(e)||null==e?e:o.isString(e)&&(t=o.field(e)).length>1?function(e){return t.reduce(function(e,t){return e[t]},e)}:function(t){return t[e]}},o.mutator=function(e){var t;return o.isString(e)&&(t=o.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},o.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=o.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),o.accessor(e)}),function(n,r){var a,i,o,s,u;for(a=0,i=e.length;i>a;++a){if(o=e[a],s=o(n),u=o(r),u>s)return-1*t[a];if(s>u)return t[a]}return 0}},o.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:null===e&&null===t?0:null===e?-1:null===t?1:0/0},o.numcmp=function(e,t){return e-t},o.stablesort=function(e,t,n){var r=e.reduce(function(e,t,r){return e[n(t)]=r,e},{});return e.sort(function(e,a){var i=t(e),o=t(a);return o>i?-1:i>o?1:r[n(e)]-r[n(a)]}),e},o.startsWith=String.prototype.startsWith?function(e,t){return e.startsWith(t)}:function(e,t){return 0===e.lastIndexOf(t,0)},o.truncate=function(e,t,n,r,i){var o=e.length;if(t>=o)return e;i=void 0!==i?String(i):"…";var s=Math.max(0,t-i.length);switch(n){case"left":return i+(r?a(e,s,1):e.slice(o-s));case"middle":case"center":var u=Math.ceil(s/2),l=Math.floor(s/2);return(r?a(e,u):e.slice(0,u))+i+(r?a(e,l,1):e.slice(o-l));default:return(r?a(e,s):e.slice(0,s))+i}};var l=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("_process"))},{_process:3,buffer:2}],22:[function(e,t,n){"use strict";{var r=(e("./globals"),e("./consts")),a=e("./util"),i=e("./field"),o=e("./enc"),s=e("./schema/schema");e("./compile/time"),t.exports=function(){function e(e,t,n,a,i,o){var u=s.instantiate(),l={data:n,marktype:e,enc:t,config:a,filter:i||[]};for(var c in u.enc)u.enc[c].type=r.dataTypes[u.enc[c].type];var f=s.util.merge(u,o||{},l);this._data=f.data,this._marktype=f.marktype,this._enc=f.enc,this._config=f.config,this._filter=f.filter}var t=e.prototype;return t.marktype=function(){return this._marktype},t.is=function(e){return this._marktype===e},t.has=function(e){return void 0!==this._enc[e].name},t.enc=function(e){return this._enc[e]},t.filter=function(){var e=[],t=this.fields(),n=this;return a.forEach(t,function(t,r){"*"!==r&&(n.config("filterNull").Q&&t.containsType[Q]||n.config("filterNull").T&&t.containsType[T]||n.config("filterNull").O&&t.containsType[O])&&e.push({operands:[r],operator:"notNull"})}),e.concat(this._filter)},t.field=function(e,t,n){if(!this.has(e))return null;var r=t?"":"data.";return"count"===this._enc[e].aggr?r+"count":!n&&this._enc[e].bin?r+"bin_"+this._enc[e].name:!n&&this._enc[e].aggr?r+this._enc[e].aggr+"_"+this._enc[e].name:!n&&this._enc[e].fn?r+this._enc[e].fn+"_"+this._enc[e].name:r+this._enc[e].name},t.fieldName=function(e){return this._enc[e].name},t.fields=function(){return o.fields(this._enc)},t.fieldTitle=function(e){if(i.isCount(this._enc[e]))return i.count.displayName;var t=this._enc[e].aggr||this._enc[e].fn||this._enc[e].bin&&"bin";return t?t.toUpperCase()+"("+this._enc[e].name+")":this._enc[e].name},t.scale=function(e){return this._enc[e].scale||{}},t.axis=function(e){return this._enc[e].axis||{}},t.band=function(e){return this._enc[e].band||{}},t.bandSize=function(e,t){return t=t||e===Y&&this.has(ROW)&&this.has(Y)||e===X&&this.has(COL)&&this.has(X),this.band(e).size||this.config(t?"smallBandSize":"largeBandSize")},t.aggr=function(e){return this._enc[e].aggr},t.bin=function(e){var t=this._enc[e].bin;return t==={}?!1:t===!0?{maxbins:s.MAXBINS_DEFAULT}:t},t.legend=function(e){return this._enc[e].legend},t.value=function(e){return this._enc[e].value},t.fn=function(e){return this._enc[e].fn},t.sort=function(t,n){var r=this._enc[t].sort,a=this._enc,o=i.isType.byCode;if((!r||0===r.length)&&e.toggleSort.support({enc:this._enc},n,!0)&&"Q"===this.config("toggleSort")){var s=o(a.x,O)?a.y:a.x;o(a[t],O)&&(r=[{name:s.name,aggr:s.aggr,type:s.type,reverse:!0}])}return r},t.length=function(){return a.keys(this._enc).length},t.map=function(e){return o.map(this._enc,e)},t.reduce=function(e,t){return o.reduce(this._enc,e,t)},t.forEach=function(e){return o.forEach(this._enc,e)},t.type=function(e){return this.has(e)?this._enc[e].type:null},t.role=function(e){return this.has(e)?i.role(this._enc[e]):null},t.text=function(e){var t=this._enc[TEXT].text;return e?t[e]:t},t.font=function(e){var t=this._enc[TEXT].font;return e?t[e]:t},t.isType=function(t,n){var r=this.enc(t);return r&&e.isType(r,n)},e.isType=function(e,t){return(e.type&t)>0},e.isOrdinalScale=function(e,t){return i.isOrdinalScale(e.enc(t),!0)},e.isDimension=function(e,t){return i.isDimension(e.enc(t),!0)},e.isMeasure=function(e,t){return i.isMeasure(e.enc(t),!0)},t.isOrdinalScale=function(t){return this.has(t)&&e.isOrdinalScale(this,t)},t.isDimension=function(t){return this.has(t)&&e.isDimension(this,t)},t.isMeasure=function(t){return this.has(t)&&e.isMeasure(this,t)},t.isAggregate=function(){return o.isAggregate(this._enc)},e.isAggregate=function(e){return o.isAggregate(e.enc)},e.alwaysNoOcclusion=function(e,t){return o.isAggregate(e.enc)},e.isStack=function(e){return("bar"===e.marktype||"area"===e.marktype)&&e.enc.color},t.isStack=function(){return(this.is("bar")||this.is("area"))&&this.has("color")},t.cardinality=function(e,t){return i.cardinality(this.enc(e),t,this.config("filterNull"),!0)},t.isRaw=function(){return!this.isAggregate()},t.data=function(e){return this._data[e]},t.config=function(e){return this._config[e]},t.toSpec=function(e){var t,n=a.duplicate(this._enc);for(var i in n)n[i].type=r.dataTypeNames[n[i].type];t={marktype:this._marktype,enc:n,filter:this._filter},e||(t.config=a.duplicate(this._config));var o=s.instantiate();return s.util.subtract(t,o)},t.toShorthand=function(){var e=r.shorthand;return"mark"+e.assign+this._marktype+e.delim+o.shorthand(this._enc)},e.shorthand=function(e){var t=r.shorthand;return"mark"+t.assign+e.marktype+t.delim+o.shorthand(e.enc)},e.fromShorthand=function(t,n,a,i){var s=r.shorthand,u=t.split(s.delim),l=u.shift().split(s.assign)[1].trim(),c=o.fromShorthand(u,!0);return new e(l,c,n,a,null,i)},e.specFromShorthand=function(t,n,r,a){return e.fromShorthand(t,n,r).toSpec(a)},e.fromSpec=function(t,n){var i=a.duplicate(t.enc||{});for(var o in i)i[o].type=r.dataTypes[i[o].type];return new e(t.marktype,i,t.data,t.config,t.filter,n)},e.transpose=function(e){var t=e.enc,n=a.duplicate(e.enc);return n.x=t.y,n.y=t.x,n.row=t.col,n.col=t.row,e.enc=n,e},e.toggleSort=function(e){return e.config=e.config||{},e.config.toggleSort="Q"===e.config.toggleSort?"O":"Q",e},e.toggleSort.direction=function(t,n){if(e.toggleSort.support(t,n)){var r=t.enc;return"O"===r.x.type?"x":"y"}},e.toggleSort.mode=function(e){return e.config.toggleSort},e.toggleSort.support=function(t,n,r){var a=t.enc,s=i.isType.get(r);return!o.has(a,ROW)&&!o.has(a,COL)&&o.has(a,X)&&o.has(a,Y)&&e.alwaysNoOcclusion(t,n)?s(a.x,O)&&i.isMeasure(a.y,r)?"x":s(a.y,O)&&i.isMeasure(a.x,r)?"y":!1:!1},e.toggleFilterNullO=function(e){return e.config=e.config||{},e.config.filterNull=e.config.filterNull||{T:!0,Q:!0},e.config.filterNull.O=!e.config.filterNull.O,e},e.toggleFilterNullO.support=function(e,t){var n=o.fields(e.enc);for(var r in n){var a=n[r];if(a.containsType.O&&r in t&&t[r].nulls>0)return!0}return!1},e}()}},{"./compile/time":39,"./consts":40,"./enc":42,"./field":43,"./globals":44,"./schema/schema":45,"./util":47}],23:[function(e,t,n){"use strict";function r(e,t,n){n=n||{};var r={},i={},o={},s={},u=e.data[1];return t.forEach(function(e,n){e.aggr?"count"===e.aggr?i.count={op:"count",field:"*"}:i[e.aggr+"|"+e.name]={op:e.aggr,field:"data."+e.name}:(r[e.name]=t.field(n),n==ROW||n==COL?s[e.name]=r[e.name]:n!==X&&n!==Y&&(o[e.name]=r[e.name]))}),r=a.vals(r),i=a.vals(i),i.length>0&&!n.preaggregatedData&&(u.transform||(u.transform=[]),u.transform.push({type:"aggregate",groupby:r,fields:i})),{details:a.vals(o),dims:r,facets:a.vals(s),aggregated:i.length>0}}var a=(e("../globals"),e("../util"));t.exports=r},{"../globals":44,"../util":47}],24:[function(e,t,n){"use strict";function r(e,t,n,r,a){var u=null,l=n.fieldTitle(t);return t===X?u=r.cellWidth/n.config("characterWidth"):t===Y&&(u=r.cellHeight/n.config("characterWidth")),e.title=u?o.truncate(l,u):l,t===ROW&&s(e,["properties","title"],{angle:{value:0},align:{value:"right"},baseline:{value:"middle"},dy:{value:-r.height/2-20}}),e.titleOffset=i(n,r,t),e}function a(e,t,n,r,a){var i;n.isType(t,T)&&(i=n.fn(t))&&l.hasScale(i)&&s(e,["properties","labels","text","scale"],"time-"+i);

var o=["properties","labels","text","template"];return n.axis(t).format?e.format=n.axis(t).format:n.isType(t,Q)?s(e,o,"{{data | number:'.3s'}}"):n.isType(t,T)&&!n.fn(t)?s(e,o,"{{data | time:'%Y-%m-%d'}}"):n.isType(t,T)&&"year"===n.fn(t)?s(e,o,"{{data | number:'d'}}"):n.isType(t,O)&&n.axis(t).maxLabelLength&&s(e,o,"{{data | truncate:"+n.axis(t).maxLabelLength+"}}"),e}function i(e,t,n){var r=e.axis(n).titleOffset;if(r)return r;switch(n){case ROW:return 0;case COL:return 35}return u(t,[n,"axisTitleOffset"])}var o=(e("../globals"),e("../util")),s=o.setter,u=o.getter,l=e("./time"),c=t.exports={};c.names=function(e){return o.keys(o.keys(e).reduce(function(t,n){var r=e[n].scale;return(r===X||r===Y)&&(t[e[n].scale]=1),t},{}))},c.defs=function(e,t,n,r,a){return e.reduce(function(e,i){return e.push(c.def(i,t,n,r,a)),e},[])},c.def=function(e,t,n,o,u){var l=e,c=e==COL,f=e==ROW,d=i(t,n,Y)+20,p=n.cellPadding;c&&(l="x"),f&&(l="y");var m={type:l,scale:e};return t.axis(e).grid&&(m.grid=!0,m.layer=f||c?"front":"back",c?s(m,["properties","grid"],{x:{offset:n.cellWidth*(1+p/2),scale:"col"},y:{value:-n.cellHeight*(p/2)},stroke:{value:t.config("cellGridColor")}}):f?s(m,["properties","grid"],{y:{offset:-n.cellHeight*(p/2),scale:"row"},x:{value:d},x2:{offset:d+.05*n.cellWidth,group:"mark.group.width",mult:1},stroke:{value:t.config("cellGridColor")}}):s(m,["properties","grid","stroke"],{value:t.config("gridColor")})),t.axis(e).title&&(m=r(m,e,t,n,u)),(f||c)&&(s(m,["properties","ticks"],{opacity:{value:0}}),s(m,["properties","majorTicks"],{opacity:{value:0}}),s(m,["properties","axis"],{opacity:{value:0}})),c&&(m.orient="top"),f&&(m.offset=d),e==X&&(t.has(Y)&&t.isOrdinalScale(Y)&&t.cardinality(Y,o)>30&&(m.orient="top"),t.isDimension(X)||t.isType(X,T)?s(m,["properties","labels"],{angle:{value:270},align:{value:"right"},baseline:{value:"middle"}}):m.ticks=5),m=a(m,e,t,n,u)}},{"../globals":44,"../util":47,"./time":39}],25:[function(e,t,n){"use strict";function r(e,t,n){n=n||{};n.preaggregatedData||(e.transform||(e.transform=[]),t.forEach(function(n,r){t.bin(r)&&e.transform.push({type:"bin",field:"data."+n.name,output:"data.bin_"+n.name,maxbins:t.bin(r).maxbins})}))}e("../globals"),e("../util");t.exports=r},{"../globals":44,"../util":47}],26:[function(e,t,n){"use strict";function r(e,t,n){return r.encoding(a.fromSpec(e,n),t)}e("../globals");t.exports=r;var a=e("../Encoding"),i=r.axis=e("./axis"),o=r.filter=e("./filter"),s=r.legend=e("./legend"),u=r.marks=e("./marks"),l=r.scale=e("./scale");r.aggregate=e("./aggregate"),r.bin=e("./bin"),r.facet=e("./facet"),r.group=e("./group"),r.layout=e("./layout"),r.sort=e("./sort"),r.stack=e("./stack"),r.style=e("./style"),r.subfacet=e("./subfacet"),r.template=e("./template"),r.time=e("./time"),r.shorthand=function(e,t,n,i){return r.encoding(a.fromShorthand(e,n,i),t)},r.encoding=function(e,t){var n=r.layout(e,t),a=r.style(e,t),c=r.template(e,n,t),f=c.marks[0],d=u[e.marktype()],p=u.def(d,e,n,a),m=p[0];o.addFilters(c,e);for(var h=r.sort(c,e,t),g=e.has(ROW),y=e.has(COL),v=!!e.data("vegaServer"),b=0;b<p.length;b++)f.marks.push(p[b]);r.bin(c.data[1],e,{preaggregatedData:v});var x=u[e.marktype()].line;v||(c=r.time(c,e));var O=r.aggregate(c,e,{preaggregatedData:v}),T=O.details,S=T&&T.length>0,w=S&&r.stack(c,e,m,O.facets);if(S&&(w||x)&&r.subfacet(f,m,T,w,e),x){var k=e.isMeasure(X)&&e.isDimension(Y)?Y:X;m.from||(m.from={}),m.from.transform=[{type:"sort",by:"-"+e.field(k)}]}return g||y?(c=r.facet(f,e,n,a,h,c,m,w,t),c.legends=s.defs(e)):(f.scales=l.defs(l.names(m.properties.update),e,n,a,h,{stack:w,stats:t}),f.axes=i.defs(i.names(m.properties.update),e,n,t),f.legends=s.defs(e)),o.filterLessThanZero(c,e),c}},{"../Encoding":22,"../globals":44,"./aggregate":23,"./axis":24,"./bin":25,"./facet":27,"./filter":28,"./group":29,"./layout":30,"./legend":31,"./marks":32,"./scale":33,"./sort":34,"./stack":35,"./style":36,"./subfacet":37,"./template":38,"./time":39}],27:[function(e,t,n){"use strict";function r(e,t,n,r,u,l,c,f,d){var p,m,h=e.properties.enter,g=[],y=[],v=t.has(ROW),b=t.has(COL);h.fill={value:t.config("cellBackgroundColor")},e.from={data:e.marks[0].from.data};for(var x=0;x<e.marks.length;x++){var O=e.marks[x];O.from.transform?delete O.from.data:delete O.from}v?(t.isDimension(ROW)||a.error("Row encoding should be ordinal."),h.y={scale:ROW,field:"keys."+g.length},h.height={value:n.cellHeight},g.push(t.field(ROW)),b&&(p=a.duplicate(e.from),p.transform=p.transform||[],p.transform.unshift({type:"facet",keys:[t.field(COL)]})),m=o("x-axes",{axes:t.has(X)?i.defs(["x"],t,n,d):void 0,x:b?{scale:COL,field:"keys.0"}:{value:0},width:b&&{value:n.cellWidth},from:p}),l.marks.unshift(m),l.axes=l.axes||[],l.axes.push.apply(l.axes,i.defs(["row"],t,n,d))):t.has(X)&&y.push.apply(y,i.defs(["x"],t,n,d)),b?(t.isDimension(COL)||a.error("Col encoding should be ordinal."),h.x={scale:COL,field:"keys."+g.length},h.width={value:n.cellWidth},g.push(t.field(COL)),v&&(p=a.duplicate(e.from),p.transform=p.transform||[],p.transform.unshift({type:"facet",keys:[t.field(ROW)]})),m=o("y-axes",{axes:t.has(Y)?i.defs(["y"],t,n,d):void 0,y:v&&{scale:ROW,field:"keys.0"},x:v&&{value:0},height:v&&{value:n.cellHeight},from:p}),l.marks.unshift(m),l.axes=l.axes||[],l.axes.push.apply(l.axes,i.defs(["col"],t,n,d))):t.has(Y)&&y.push.apply(y,i.defs(["y"],t,n,d)),l.scales=(l.scales||[]).concat(s.defs(s.names(h).concat(s.names(c.properties.update)),t,n,r,u,{stack:f,facet:!0,stats:d})),y.length>0&&(e.axes=y);var T=e.from.transform||(e.from.transform=[]);return T.unshift({type:"facet",keys:g}),l}var a=(e("../globals"),e("../util")),i=e("./axis"),o=e("./group").def,s=e("./scale");t.exports=r},{"../globals":44,"../util":47,"./axis":24,"./group":29,"./scale":33}],28:[function(e,t,n){"use strict";var r=(e("../globals"),t.exports={}),a={">":!0,">=":!0,"=":!0,"!=":!0,"<":!0,"<=":!0};r.addFilters=function(e,t){var n=t.filter(),r=e.data[0];r.transform||(r.transform=[]);for(var i in n){var o=n[i],s="",u=o.operator,l=o.operands;if(a[u]){"="===u&&(u="==");var c=l[0],f=l[1];s="d.data."+c+u+f}else if("notNull"===u)for(var d in l)s+="d.data."+l[d]+"!==null",d<l.length-1&&(s+=" && ");else console.warn("Unsupported operator: ",u);r.transform.push({type:"filter",test:s})}},r.filterLessThanZero=function(e,t){t.forEach(function(n,r){"log"===t.scale(r).type&&e.data[1].transform.push({type:"filter",test:"d."+t.field(r)+">0"})})}},{"../globals":44}],29:[function(e,t,n){"use strict";function r(e,t){return t=t||{},{_name:e||void 0,type:"group",from:t.from,properties:{enter:{x:t.x||void 0,y:t.y||void 0,width:t.width||{group:"width"},height:t.height||{group:"height"}}},scales:t.scales||void 0,axes:t.axes||void 0,marks:t.marks||[]}}t.exports={def:r}},{}],30:[function(e,t,n){"use strict";function r(e,t){var n=a(e,t);return n=o(e,t,n)}function a(e,t){var n,r,a=e.has(ROW),i=e.has(COL),o=e.has(X),s=e.has(Y),u=e.marktype(),l=o&&e.isDimension(X)?e.cardinality(X,t):1,c=s&&e.isDimension(Y)?e.cardinality(Y,t):1,f=l>e.config("largeBandMaxCardinality")||c>e.config("largeBandMaxCardinality"),d=e.config("cellPadding");n=o?e.isOrdinalScale(X)?(l+e.band(X).padding)*e.bandSize(X,f):i||a?e.enc(COL).width:e.config("singleWidth"):u===TEXT?e.config("textCellWidth"):e.bandSize(X),r=s?e.isOrdinalScale(Y)?(c+e.band(Y).padding)*e.bandSize(Y,f):i||a?e.enc(ROW).height:e.config("singleHeight"):e.bandSize(Y);var p=n,m=r;if(i){var h=e.cardinality(COL,t);p=n*((1+d)*(h-1)+1)}if(a){var g=e.cardinality(ROW,t);m=r*((1+d)*(g-1)+1)}return{cellWidth:n,cellHeight:r,cellPadding:d,width:p,height:m,x:{useSmallBand:f},y:{useSmallBand:f}}}function i(e,t,n){return e.isType(n,Q)?20:e.isType(n,T)?20:t[e.fieldName(n)].max}function o(e,t,n){return[X,Y].forEach(function(r){var a;e.isDimension(r)||e.isType(r,T)?a=i(e,t,r):"count"===e.aggr(r)?a=3:e.isType(r,Q)&&(a=r===X?3:Math.min(i(e,t,r),7)),u(n,[r,"axisTitleOffset"],e.config("characterWidth")*a+20)}),n}{var s=(e("../globals"),e("../util")),u=s.setter;e("../schema/schema"),e("./time"),e("../field")}t.exports=r},{"../field":43,"../globals":44,"../schema/schema":45,"../util":47,"./time":39}],31:[function(e,t,n){"use strict";var r=(e("../globals"),e("./time")),a=t.exports={};a.defs=function(e){var t=[];if(e.has(COLOR)&&e.legend(COLOR)&&t.push(a.def(COLOR,e,{fill:COLOR,orient:"right"})),e.has(SIZE)&&e.legend(SIZE)&&t.push(a.def(SIZE,e,{size:SIZE,orient:1===t.length?"left":"right"})),e.has(SHAPE)&&e.legend(SHAPE)){if(2===t.length)return console.error("Vegalite currently only supports two legends"),t;t.push(a.def(SHAPE,e,{shape:SHAPE,orient:1===t.length?"left":"right"}))}return t},a.def=function(e,t,n){var a,i=n;if(i.title=t.fieldTitle(e),t.isType(e,T)&&(a=t.fn(e))&&r.hasScale(a)){var o=i.properties=i.properties||{},s=o.labels=o.labels||{},u=s.text=s.text||{};u.scale="time-"+a}return i}},{"../globals":44,"./time":39}],32:[function(e,t,n){"use strict";function r(e,t,n){var r={};return e.isMeasure(X)?(r.x={scale:X,field:e.field(X)},e.isDimension(Y)&&(r.x2={scale:X,value:"log"===e.scale(X).type?1:0})):r.xc=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isMeasure(Y)?(r.y={scale:Y,field:e.field(Y)},r.y2={scale:Y,value:"log"===e.scale(Y).type?1:0}):r.yc=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},r.width=!e.has(X)||e.isOrdinalScale(X)?e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:e.bandSize(X,t.x.useSmallBand),offset:-1}:{value:2},r.height=!e.has(Y)||e.isOrdinalScale(Y)?e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:e.bandSize(Y,t.y.useSmallBand),offset:-1}:{value:2},r.fill=e.has(COLOR)?{scale:COLOR,field:e.field(COLOR)}:{value:e.value(COLOR)},e.has(ALPHA)?r.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)&&(r.opacity={value:e.value(ALPHA)}),r}function a(e,t,n){var r={};return e.has(X)?r.x={scale:X,field:e.field(X)}:e.has(X)||(r.x={value:e.bandSize(X,t.x.useSmallBand)/2}),e.has(Y)?r.y={scale:Y,field:e.field(Y)}:e.has(Y)||(r.y={value:e.bandSize(Y,t.y.useSmallBand)/2}),e.has(SIZE)?r.size={scale:SIZE,field:e.field(SIZE)}:e.has(SIZE)||(r.size={value:e.value(SIZE)}),e.has(SHAPE)?r.shape={scale:SHAPE,field:e.field(SHAPE)}:e.has(SHAPE)||(r.shape={value:e.value(SHAPE)}),e.has(COLOR)?r.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(r.stroke={value:e.value(COLOR)}),e.has(ALPHA)?r.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)?r.opacity={value:e.value(ALPHA)}:e.has(COLOR)||(r.opacity={value:n.opacity}),r.strokeWidth={value:e.config("strokeWidth")},r}function i(e,t,n){var r={};return e.has(X)?r.x={scale:X,field:e.field(X)}:e.has(X)||(r.x={value:0}),e.has(Y)?r.y={scale:Y,field:e.field(Y)}:e.has(Y)||(r.y={group:"height"}),e.has(COLOR)?r.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(r.stroke={value:e.value(COLOR)}),e.has(ALPHA)?r.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)&&(r.opacity={value:e.value(ALPHA)}),r.strokeWidth={value:e.config("strokeWidth")},r}function o(e,t,n){var r={};return e.isMeasure(X)?(r.x={scale:X,field:e.field(X)},e.isDimension(Y)&&(r.x2={scale:X,value:0},r.orient={value:"horizontal"})):r.x=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isMeasure(Y)?(r.y={scale:Y,field:e.field(Y)},r.y2={scale:Y,value:0}):r.y=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},e.has(COLOR)?r.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(r.fill={value:e.value(COLOR)}),e.has(ALPHA)?r.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)&&(r.opacity={value:e.value(ALPHA)}),r}function s(e,t,n){var r={};return e.has(X)?(r.x={scale:X,field:e.field(X)},e.isDimension(X)&&(r.x.offset=-e.bandSize(X,t.x.useSmallBand)/3)):e.has(X)||(r.x={value:0}),e.has(Y)?(r.y={scale:Y,field:e.field(Y)},e.isDimension(Y)&&(r.y.offset=-e.bandSize(Y,t.y.useSmallBand)/3)):e.has(Y)||(r.y={value:0}),r.width=!e.has(X)||e.isDimension(X)?{value:e.bandSize(X,t.y.useSmallBand)/1.5}:{value:1},r.height=!e.has(Y)||e.isDimension(Y)?{value:e.bandSize(Y,t.y.useSmallBand)/1.5}:{value:1},r.fill=e.has(COLOR)?{scale:COLOR,field:e.field(COLOR)}:{value:e.value(COLOR)},e.has(ALPHA)?r.opacity={scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)?r.opacity={value:e.value(ALPHA)}:e.has(COLOR)||(r.opacity={value:n.opacity}),r}function u(e){return function(t,n,r){var a={};return t.has(X)?a.x={scale:X,field:t.field(X)}:t.has(X)||(a.x={value:t.bandSize(X,n.x.useSmallBand)/2}),t.has(Y)?a.y={scale:Y,field:t.field(Y)}:t.has(Y)||(a.y={value:t.bandSize(Y,n.y.useSmallBand)/2}),t.has(SIZE)?a.size={scale:SIZE,field:t.field(SIZE)}:t.has(X)||(a.size={value:t.value(SIZE)}),a.shape={value:e},t.has(COLOR)?a.fill={scale:COLOR,field:t.field(COLOR)}:t.has(COLOR)||(a.fill={value:t.value(COLOR)}),t.has(ALPHA)?a.opacity={scale:ALPHA,field:t.field(ALPHA)}:void 0!==t.value(ALPHA)?a.opacity={value:t.value(ALPHA)}:t.has(COLOR)||(a.opacity={value:r.opacity}),a}}function l(e,t,n){var r={};return e.has(X)?r.x={scale:X,field:e.field(X)}:e.has(X)||(r.x=e.has(TEXT)&&e.isType(TEXT,Q)?{value:t.cellWidth-5}:{value:e.bandSize(X,t.x.useSmallBand)/2}),e.has(Y)?r.y={scale:Y,field:e.field(Y)}:e.has(Y)||(r.y={value:e.bandSize(Y,t.y.useSmallBand)/2}),e.has(SIZE)?r.fontSize={scale:SIZE,field:e.field(SIZE)}:e.has(SIZE)||(r.fontSize={value:e.font("size")}),r.fill={value:"black"},r.opacity=e.has(ALPHA)?{scale:ALPHA,field:e.field(ALPHA)}:void 0!==e.value(ALPHA)?{value:e.value(ALPHA)}:{value:n.opacity},e.has(TEXT)?e.isType(TEXT,Q)?(r.text={template:"{{"+e.field(TEXT)+" | number:'.3s'}}"},r.align={value:"right"}):r.text={field:e.field(TEXT)}:r.text={value:"Abc"},r.font={value:e.font("family")},r.fontWeight={value:e.font("weight")},r.fontStyle={value:e.font("style")},r.baseline={value:e.text("baseline")},r}var c=(e("../globals"),e("../util"),e("./scale"),t.exports={});c.def=function(e,t,n,r){var a=[];if(t.marktype()===TEXT&&t.has(COLOR)){var i={x:{value:0},y:{value:0},x2:{value:n.cellWidth},y2:{value:n.cellHeight},fill:{scale:COLOR,field:t.field(COLOR)}};a.push({type:"rect",from:{data:TABLE},properties:{enter:i,update:i}})}var o=e.prop(t,n,r);return a.push({type:e.type,from:{data:TABLE},properties:{enter:o,update:o}}),a},c.bar={type:"rect",stack:!0,prop:r,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1}},c.line={type:"line",line:!0,prop:i,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1,detail:1}},c.area={type:"area",stack:!0,line:!0,requiredEncoding:["x","y"],prop:o,supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1}},c.tick={type:"rect",prop:s,supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1,detail:1}},c.circle={type:"symbol",prop:u("circle"),supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1,detail:1}},c.square={type:"symbol",prop:u("square"),supportedEncoding:c.circle.supportedEncoding},c.point={type:"symbol",prop:a,supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1,shape:1,detail:1}},c.text={type:"text",prop:l,requiredEncoding:["text"],supportedEncoding:{row:1,col:1,size:1,color:1,alpha:1,text:1}}},{"../globals":44,"../util":47,"./scale":33}],33:[function(e,t,n){"use strict";function r(e,t,n,r){if(t.isType(e,T)){var a=o.scale.domain(t.fn(e),e);if(a)return a}if(t.bin(e)&&r.stats){var s=i.getbins(r.stats[t.fieldName(e)],t.bin(e).maxbins),u=i.range(s.start,s.stop,s.step);return e===Y?u.reverse():u}return e==r.stack?{data:STACKED,field:"data."+(r.facet?"max_":"")+"sum_"+t.field(e,!0)}:{data:n.getDataset(e),field:t.field(e)}}function a(e,t,n,r,a){var i=t.scale(e.name);switch(e.name){case X:"ordinal"===e.type?e.bandWidth=t.bandSize(X,n.x.useSmallBand):(e.range=n.cellWidth?[0,n.cellWidth]:"width",e.zero=t.isType(e.name,T)&&"year"===t.fn(e.name)?!1:void 0===i.zero?!0:i.zero,e.reverse=i.reverse),e.round=!0,e.nice="time"===e.type?t.fn(e.name):!0;break;case Y:"ordinal"===e.type?e.bandWidth=t.bandSize(Y,n.y.useSmallBand):(e.range=n.cellHeight?[n.cellHeight,0]:"height",e.zero=t.isType(e.name,T)&&"year"===t.fn(e.name)?!1:void 0===i.zero?!0:i.zero,e.reverse=i.reverse),e.round=!0,e.nice="time"===e.type?t.fn(e.name)||t.config("timeScaleNice"):!0;break;case ROW:e.bandWidth=n.cellHeight,e.round=!0,e.nice=!0;break;case COL:e.bandWidth=n.cellWidth,e.round=!0,e.nice=!0;break;case SIZE:if(t.is("bar"))e.range=[3,Math.max(t.bandSize(X),t.bandSize(Y))];else if(t.is(TEXT))e.range=[8,40];else{var o=Math.min(t.bandSize(X),t.bandSize(Y))-1;e.range=[10,.8*o*o]}e.round=!0,e.zero=!1;break;case SHAPE:e.range="shapes";break;case COLOR:var s=t.scale(COLOR).range;void 0===s&&("ordinal"===e.type?s=r.colorRange:(s=["#A9DB9F","#0D5C21"],e.zero=!1)),e.range=s;break;case ALPHA:e.range=[.2,1];break;default:throw new Error("Unknown encoding name: "+e.name)}switch(e.name){case ROW:case COL:e.padding=t.config("cellPadding"),e.outerPadding=0;break;case X:case Y:"ordinal"===e.type&&(e.points=!0,e.padding=t.band(e.name).padding)}}var i=(e("../globals"),e("../util")),o=e("./time"),s=t.exports={};s.names=function(e){return i.keys(i.keys(e).reduce(function(t,n){return e[n]&&e[n].scale&&(t[e[n].scale]=1),t},{}))},s.defs=function(e,t,n,i,o,u){return u=u||{},e.reduce(function(e,l){var c={name:l,type:s.type(l,t),domain:r(l,t,o,u)};return"ordinal"!==c.type||t.bin(l)||0!==t.sort(l).length||(c.sort=!0),a(c,t,n,i,u),e.push(c),e},[])},s.type=function(e,t){switch(t.type(e)){case O:return"ordinal";case T:var n=t.fn(e);return n&&o.scale.type(n,e)||"time";case Q:return t.bin(e)?e===COLOR?"linear":"ordinal":t.scale(e).type}}},{"../globals":44,"../util":47,"./time":39}],34:[function(e,t,n){"use strict";function r(e,t,n,r){var a={},i=0;return t.forEach(function(r,o){var s=t.sort(o,n);if(s.length>0){var u=s.map(function(e){return{op:e.aggr,field:"data."+e.name}}),l=s.map(function(e){var t=e.reverse?"-":"";return t+"data."+("count"===e.aggr?"count":e.aggr+"_"+e.name)}),c="sorted"+i++,f=[{type:"aggregate",groupby:["data."+r.name],fields:u},{type:"sort",by:l}];e.data.push({name:c,source:RAW,transform:f}),a[o]=c}}),{spec:e,getDataset:function(e){var t=a[e];return t?t:TABLE}}}e("../globals");t.exports=r},{"../globals":44}],35:[function(e,t,n){"use strict";function r(e,t,n,r){if(!a[t.marktype()].stack)return!1;if(!t.has(COLOR))return!1;var i=null,o=null,s=null,u=t.isMeasure(X),l=t.isMeasure(Y);if(u&&!l)i=Y,o=X,s=0;else{if(!l||u)return null;i=X,o=Y,s=1}var c={name:STACKED,source:TABLE,transform:[{type:"aggregate",groupby:[t.field(i)].concat(r),fields:[{op:"sum",field:t.field(o)}]}]};return r&&r.length>0&&c.transform.push({type:"aggregate",groupby:r,fields:[{op:"max",field:"data.sum_"+t.field(o,!0)}]}),e.data.push(c),n.from.transform=[{type:"stack",point:t.field(i),height:t.field(o),output:{y1:o,y0:o+"2"}}],n.properties.update[o]=n.properties.enter[o]={scale:o,field:o},n.properties.update[o+"2"]=n.properties.enter[o+"2"]={scale:o,field:o+"2"},o}var a=(e("../globals"),e("../util"),e("./marks"));t.exports=r},{"../globals":44,"../util":47,"./marks":32}],36:[function(e,t,n){"use strict";function r(e,t){if(e.has(COLOR)&&e.isDimension(COLOR)){var n=e.cardinality(COLOR,t);return 10>=n?"category10":"category20"}return null}function a(e,t){if(!t)return 1;var n=0;if(e.isAggregate())n=1,e.forEach(function(r,a){a===ROW||a===COL||(a===X||a===Y)&&i.isOrdinalScale(r,!0)||(n*=e.cardinality(a,t))});else{n=t.count;var r=1;e.has(ROW)&&(r*=e.cardinality(ROW,t)),e.has(COL)&&(r*=e.cardinality(COL,t)),n/=r}var a=0;return a=20>n?1:200>n?.7:1e3>n||e.is("tick")?.6:.3}{var i=(e("../globals"),e("../util"),e("../field"));e("../Encoding")}t.exports=function(e,t){return{opacity:a(e,t),colorRange:r(e,t)}}},{"../Encoding":22,"../field":43,"../globals":44,"../util":47}],37:[function(e,t,n){"use strict";function r(e,t,n,r,i){var o=e.marks,s=a("subfacet",{marks:o});e.marks=[s],s.from=t.from,delete t.from;var u=s.from.transform||(s.from.transform=[]);u.unshift({type:"facet",keys:n}),r&&i.has(COLOR)&&u.unshift({type:"sort",by:i.field(COLOR)})}var a=(e("../globals"),e("./group").def);t.exports=r},{"../globals":44,"./group":29}],38:[function(e,t,n){"use strict";function r(e,t,n){var r={name:RAW,format:{type:e.data("formatType")}},o={name:TABLE,source:RAW},s=i.getUrl(e,n);s&&(r.url=s);var u=!!e.data("vegaServer");return e.forEach(function(e,t){var n;e.type==T?(r.format.parse=r.format.parse||{},r.format.parse[e.name]="date"):e.type==Q&&(r.format.parse=r.format.parse||{},n="count"===e.aggr?"count":u&&e.bin?"bin_"+e.name:u&&e.aggr?e.aggr+"_"+e.name:e.name,r.format.parse[n]="number")}),{width:t.width,height:t.height,padding:"auto",data:[r,o],marks:[a("cell",{width:t.cellWidth?{value:t.cellWidth}:void 0,height:t.cellHeight?{value:t.cellHeight}:void 0})]}}var a=(e("../globals"),e("./group").def),i=e("../data");t.exports=r},{"../data":41,"../globals":44,"./group":29}],39:[function(e,t,n){"use strict";function r(e,t,n){var a={},i={};t.forEach(function(e,n){e.type===T&&e.fn&&(a[t.field(n)]={field:e,encType:n},i[e.fn]=!0)});var o=e.data[1],s=o.transform=o.transform||[];for(var u in a){var l=a[u];r.transform(s,t,l.encType,l.field)}var c=e.scales=e.scales||[];for(var f in i)r.scale(c,f,t);return e}function a(e,t){return"utc"+e+"(d.data."+t.name+")"}var i=(e("../globals"),e("../util"));t.exports=r,r.cardinality=function(e,t,n,r){var a=e.fn;switch(a){case"seconds":return 60;case"minutes":return 60;case"hours":return 24;case"day":return 7;case"date":return 31;case"month":return 12;case"year":var i=t[e.name],o=t["year_"+e.name];return o?o.distinct-(i.nulls>0&&n[r]?1:0):null}return null},r.formula=function(e){return a(e.fn,e)},r.transform=function(e,t,n,a){e.push({type:"formula",field:t.field(n),expr:r.formula(a)})},r.scale=function(e,t,n){var r=n.config("timeScaleLabelLength");switch(t){case"day":e.push({name:"time-"+t,type:"ordinal",domain:i.range(0,7),range:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(function(e){return e.substr(0,r)})});break;case"month":e.push({name:"time-"+t,type:"ordinal",domain:i.range(0,12),range:["January","February","March","April","May","June","July","August","September","October","November","December"].map(function(e){return e.substr(0,r)})})}},r.isOrdinalFn=function(e){switch(e){case"seconds":case"minutes":case"hours":case"day":case"date":case"month":return!0}return!1},r.scale.type=function(e,t){return t===COLOR?"linear":r.isOrdinalFn(e)||t===COL||t===ROW?"ordinal":"linear"},r.scale.domain=function(e,t){var n=t===COLOR;switch(e){case"seconds":case"minutes":return n?[0,59]:i.range(0,60);case"hours":return n?[0,23]:i.range(0,24);case"day":return n?[0,6]:i.range(0,7);case"date":return n?[1,31]:i.range(1,32);case"month":return n?[0,11]:i.range(0,12)}return null},r.hasScale=function(e){switch(e){case"day":case"month":return!0}return!1}},{"../globals":44,"../util":47}],40:[function(e,t,n){"use strict";var r=(e("./globals"),t.exports={});r.encodingTypes=[X,Y,ROW,COL,SIZE,SHAPE,COLOR,ALPHA,TEXT,DETAIL],r.dataTypes={O:O,Q:Q,T:T},r.dataTypeNames=["O","Q","T"].reduce(function(e,t){return e[r.dataTypes[t]]=t,e},{}),r.shorthand={delim:"|",assign:"=",type:",",func:"_"}},{"./globals":44}],41:[function(e,t,n){"use strict";var r=e("datalib"),a=t.exports={},i=(e("./field"),e("./util"));a.getUrl=function(e,t){if(!e.data("vegaServer"))return e.data("url");if(0!==e.length()){var n=[];e.forEach(function(r,a){var o={name:e.field(a,!0),field:r.name};r.aggr&&(o.aggr=r.aggr),r.bin&&(o.binSize=i.getbins(t[r.name],e.bin(a).maxbins).step),n.push(o)});var r={table:e.data("vegaServer").table,fields:n};return e.data("vegaServer").url+"/query/?q="+JSON.stringify(r)}},a.types={"boolean":"O",number:"Q",integer:"Q",date:"T",string:"O"},a.getStats=function(e){var t={},n=i.keys(e[0]);return n.forEach(function(n){for(var a=r.profile(e,function(e){return e[n]}),i={};Object.keys(i).length<Math.min(a.distinct,10);){var o=e[Math.floor(Math.random()*e.length)][n];i[o]=!0}a.sample=Object.keys(i),t[n]=a}),t.count=e.length,t}},{"./field":43,"./util":47,datalib:17}],42:[function(e,t,n){"use strict";var r=e("./consts"),a=r.shorthand,i=(e("./compile/time"),e("./field")),o=e("./util"),s=e("./schema/schema"),u=s.encTypes,l=t.exports={};l.countRetinal=function(e){var t=0;return e.color&&t++,e.alpha&&t++,e.size&&t++,e.shape&&t++,t},l.has=function(e,t){var n=e&&e[t];return n&&n.name},l.isAggregate=function(e){for(var t in e)if(l.has(e,t)&&e[t].aggr)return!0;return!1},l.forEach=function(e,t){var n=0;u.forEach(function(r){l.has(e,r)&&t(e[r],r,n++)})},l.map=function(e,t){var n=[];return u.forEach(function(r){l.has(e,r)&&n.push(t(e[r],r,e))}),n},l.reduce=function(e,t,n){var r=n;return u.forEach(function(n){l.has(e,n)&&(r=t(r,e[n],n,e))}),r},l.fields=function(e){return l.reduce(e,function(e,t,n){var r=e[t.name]=e[t.name]||[],a=r.containsType=r.containsType||{};return-1===r.indexOf(t)&&(r.push(t),a[t.type]=!0),e},{})},l.shorthand=function(e){return l.map(e,function(e,t){return t+a.assign+i.shorthand(e)}).join(a.delim)},l.fromShorthand=function(e,t){var n=o.isArray(e)?e:e.split(a.delim);return n.reduce(function(e,n){var r=n.split(a.assign),o=r[0].trim(),s=r[1];return e[o]=i.fromShorthand(s,t),e},{})}},{"./compile/time":39,"./consts":40,"./field":43,"./schema/schema":45,"./util":47}],43:[function(e,t,n){"use strict";function r(e){return e?c.isType.byCode:c.isType.byName}function a(e,t){var n=r(t);return n(e,O)||!!e.bin||n(e,T)&&!!e.fn}var i=e("./consts"),o=i.shorthand,s=e("./compile/time"),u=e("./util"),l=e("./schema/schema"),c=t.exports={};c.shorthand=function(e){var t=i.shorthand;return(e.aggr?e.aggr+t.func:"")+(e.fn?e.fn+t.func:"")+(e.bin?"bin"+t.func:"")+(e.name||"")+t.type+(i.dataTypeNames[e.type]||e.type)},c.shorthands=function(e,t){return t=t||o.delim,e.map(c.shorthand).join(t)},c.fromShorthand=function(e,t){var n,r=e.split(o.type),a={name:r[0].trim(),type:t?i.dataTypes[r[1].trim()]:r[1].trim()};for(n in l.aggr["enum"]){var s=l.aggr["enum"][n];if(0===a.name.indexOf(s+"_")){a.name=a.name.substr(s.length+1),"count"==s&&0===a.name.length&&(a.name="*"),a.aggr=s;break}}for(n in l.timefns){var u=l.timefns[n];if(a.name&&0===a.name.indexOf(u+"_")){a.name=a.name.substr(a.length+1),a.fn=u;break}}return a.name&&0===a.name.indexOf("bin_")&&(a.name=a.name.substr(4),a.bin=!0),a};var f={O:0,G:1,T:2,Q:3};c.order={},c.order.type=function(e){return"count"===e.aggr?4:f[e.type]},c.order.typeThenName=function(e){return c.order.type(e)+"_"+e.name.toLowerCase()},c.order.original=function(){return 0},c.order.name=function(e){return e.name},c.order.typeThenCardinality=function(e,t){return t[e.name].distinct},c.isType=function(e,t){return(e.type&t)>0},c.isType.byCode=c.isType,c.isType.byName=function(e,t){return e.type===i.dataTypeNames[t]},c.isType.get=r,c.isOrdinalScale=function(e,t){var n=r(t);return n(e,O)||e.bin||n(e,T)&&e.fn&&s.isOrdinalFn(e.fn)},c.isDimension=function(e,t){return e&&a(e,t)},c.isMeasure=function(e,t){return e&&!a(e,t)},c.role=function(e){return a(e)?"dimension":"measure"},c.count=function(){return{name:"*",aggr:"count",type:"Q",displayName:c.count.displayName}},c.count.displayName="Number of Records",c.isCount=function(e){return"count"===e.aggr},c.cardinality=function(e,t,n,a){var o=t[e.name],c=r(a),f=a?i.dataTypeNames[e.type]:e.type;if(n=n||{},e.bin){var d=u.getbins(o,e.bin.maxbins||l.MAXBINS_DEFAULT);return(d.stop-d.start)/d.step}if(c(e,T)){var p=s.cardinality(e,t,n,f);if(null!==p)return p}return e.aggr?1:o.distinct-(o.nulls>0&&n[f]?1:0)}},{"./compile/time":39,"./consts":40,"./schema/schema":45,"./util":47}],44:[function(e,t,n){(function(e){"use strict";var t=e||window;t.TABLE="table",t.RAW="raw",t.STACKED="stacked",t.INDEX="index",t.X="x",t.Y="y",t.ROW="row",t.COL="col",t.SIZE="size",t.SHAPE="shape",t.COLOR="color",t.ALPHA="alpha",t.TEXT="text",t.DETAIL="detail",t.O=1,t.Q=2,t.T=4}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(e,t,n){"use strict";var r=t.exports={},a=e("../util");r.util=e("./schemautil"),r.marktype={type:"string","enum":["point","tick","bar","line","area","circle","square","text"]},r.aggr={type:"string","enum":["avg","sum","min","max","count"],supportedEnums:{Q:["avg","sum","min","max","count"],O:[],T:["avg","min","max"],"":["count"]},supportedTypes:{Q:!0,O:!0,T:!0,"":!0}},r.band={type:"object",properties:{size:{type:"integer",minimum:0},padding:{type:"integer",minimum:0,"default":1}}},r.getSupportedRole=function(e){return r.schema.properties.enc.properties[e].supportedRole},r.timefns=["year","month","day","date","hours","minutes","seconds"],r.defaultTimeFn="month",r.fn={type:"string","enum":r.timefns,supportedTypes:{T:!0}},r.scale_type={type:"string","enum":["linear","log","pow","sqrt","quantile"],"default":"linear",supportedTypes:{Q:!0}},r.field={type:"object",properties:{name:{type:"string"}}};var i=a.duplicate,o=r.util.merge;r.MAXBINS_DEFAULT=15;var s={type:["boolean","object"],"default":!1,properties:{maxbins:{type:"integer","default":r.MAXBINS_DEFAULT,minimum:2}},supportedTypes:{Q:!0}},u=o(i(r.field),{type:"object",properties:{type:{type:"string","enum":["O","Q","T"]},aggr:r.aggr,fn:r.fn,bin:s,scale:{type:"object",properties:{type:r.scale_type,reverse:{type:"boolean","default":!1,supportedTypes:{Q:!0,T:!0}},zero:{type:"boolean",description:"Include zero","default":!0,supportedTypes:{Q:!0,T:!0}},nice:{type:"string","enum":["second","minute","hour","day","week","month","year"],supportedTypes:{T:!0}}}}}}),l=o(i(r.field),{type:"object",supportedRole:{dimension:!0},properties:{type:{type:"string","enum":["O","Q","T"]},fn:r.fn,bin:s,aggr:{type:"string","enum":["count"],supportedTypes:{O:!0}}}}),c={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0},properties:{axis:{type:"object",properties:{grid:{type:"boolean","default":!0,description:"A flag indicate if gridlines should be created in addition to ticks."},title:{type:"boolean","default":!0,description:"A title for the axis."},titleOffset:{type:"integer","default":void 0,description:"A title offset value for the axis."},format:{type:"string","default":void 0,description:"The formatting pattern for axis labels."},maxLabelLength:{type:"integer","default":25,minimum:0,description:"Truncate labels that are too long."}}}}},f={type:"object",properties:{sort:{type:"array","default":[],items:{type:"object",supportedTypes:{O:!0},required:["name","aggr"],name:{type:"string"},aggr:{type:"string","enum":["avg","sum","min","max","count"]},reverse:{type:"boolean","default":!1}}}}},d={type:"object",properties:{band:r.band}},p={type:"object",properties:{legend:{type:"boolean","default":!0}}},m={type:"object",supportedMarktypes:{text:!0},properties:{text:{type:"object",properties:{align:{type:"string","default":"left"},baseline:{type:"string","default":"middle"},margin:{type:"integer","default":4,minimum:0}}},font:{type:"object",properties:{weight:{type:"string","enum":["normal","bold"],"default":"normal"},size:{type:"integer","default":10,minimum:0},family:{type:"string","default":"Helvetica Neue"},style:{type:"string","default":"normal","enum":["normal","italic"]}}}}},h={type:"object",supportedMarktypes:{point:!0,bar:!0,circle:!0,square:!0,text:!0},properties:{value:{type:"integer","default":30,minimum:0}}},g={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0,text:!0},properties:{value:{type:"string",role:"color","default":"steelblue"},scale:{type:"object",properties:{range:{type:["string","array"]}}}}},y={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0,text:!0},properties:{value:{type:"number","default":void 0,minimum:0,maximum:1}}},v={type:"object",supportedMarktypes:{point:!0,circle:!0,square:!0},properties:{value:{type:"string","enum":["circle","square","cross","diamond","triangle-up","triangle-down"],"default":"circle"}}},b={type:"object",supportedMarktypes:{point:!0,tick:!0,line:!0,circle:!0,square:!0}},x={properties:{height:{type:"number",minimum:0,"default":150},grid:{type:"boolean","default":!0,description:"A flag indicate if gridlines should be created in addition to ticks."}}},O={properties:{width:{type:"number",minimum:0,"default":150},axis:{properties:{maxLabelLength:{type:"integer","default":12,minimum:0,
description:"Truncate labels that are too long."}}}}},T={type:"object",supportedMarktypes:{point:!0,tick:!0,bar:!0,line:!0,area:!0,circle:!0,square:!0,text:!0},properties:{padding:{type:"number",minimum:0,maximum:1,"default":.1}}},S={required:["name","type"]},w=o(i(u),{supportedRole:{measure:!0,dimension:!0}}),k=o(i(u),{supportedRole:{measure:!0,dimension:"ordinal-only"}}),L=o(i(u),{supportedRole:{measure:!0}}),A=o(i(w),c,d,S,f),E=i(A),C=o(i(l),S,T,f),N=o(i(C),c,x),X=o(i(C),c,O),R=o(i(k),p,h,f),_=o(i(w),p,g,f),M=o(i(k),y,f),Y=o(i(l),p,v,f),j=o(i(l),b,f),D=o(i(L),m,f),H={type:"array",items:{type:"object",properties:{operands:{type:"array",items:{type:["string","boolean","integer","number"]}},operator:{type:"string","enum":[">",">=","=","!=","<","<=","notNull"]}}}},W={type:"object",properties:{formatType:{type:"string","enum":["json","csv"],"default":"json"},url:{type:"string","default":void 0},vegaServer:{type:"object","default":null,properties:{table:{type:"string","default":void 0},url:{type:"string","default":"http://localhost:3001"}}}}},z={type:"object",properties:{width:{type:"integer","default":void 0},height:{type:"integer","default":void 0},viewport:{type:"array",items:{type:"integer"},"default":void 0},gridColor:{type:"string",role:"color","default":"#eeeeee"},filterNull:{type:"object",properties:{O:{type:"boolean","default":!1},Q:{type:"boolean","default":!0},T:{type:"boolean","default":!0}}},toggleSort:{type:"string","default":"O"},singleHeight:{type:"integer","default":200,minimum:0},singleWidth:{type:"integer","default":200,minimum:0},largeBandSize:{type:"integer","default":21,minimum:0},smallBandSize:{type:"integer","default":12,minimum:0},largeBandMaxCardinality:{type:"integer","default":10},cellPadding:{type:"number","default":.1},cellGridColor:{type:"string",role:"color","default":"#aaaaaa"},cellBackgroundColor:{type:"string",role:"color","default":"transparent"},textCellWidth:{type:"integer","default":90,minimum:0},strokeWidth:{type:"integer","default":2,minimum:0},timeScaleLabelLength:{type:"integer","default":3,minimum:0},characterWidth:{type:"integer","default":6}}};r.schema={$schema:"http://json-schema.org/draft-04/schema#",description:"Schema for vegalite specification",type:"object",required:["marktype","enc","data","config"],properties:{data:W,marktype:r.marktype,enc:{type:"object",properties:{x:A,y:E,row:N,col:X,size:R,color:_,alpha:M,shape:Y,text:D,detail:j}},filter:H,config:z}},r.encTypes=a.keys(r.schema.properties.enc.properties),r.instantiate=function(){return r.util.instantiate(r.schema)}},{"../util":47,"./schemautil":46}],46:[function(e,t,n){"use strict";function r(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=r(t[n].constructor===Array?[]:{},t[n]):r(e[n],t[n]));return e}var a=t.exports={},i=e("../util"),o=function(e){return 0===Object.keys(e).length};a.extend=function(e,t){return a.merge(a.instantiate(t),e)},a.instantiate=function(e){var t;if(void 0===e)return void 0;if("default"in e)return t=e["default"],i.isObject(t)?i.duplicate(t):t;if("object"===e.type){var n={};for(var r in e.properties)t=a.instantiate(e.properties[r]),void 0!==t&&(n[r]=t);return n}return"array"===e.type?[]:void 0},a.subtract=function(e,t){var n={};for(var r in e){var s=t[r],u=e[r];if(!t||s!==u)if("object"==typeof u&&!i.isArray(u)&&s){var l=a.subtract(u,s);o(l)||(n[r]=l)}else(!i.isArray(u)||u.length>0)&&(n[r]=u)}return n},a.merge=function(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=r(e,arguments[t]);return e}},{"../util":47}],47:[function(e,t,n){"use strict";var r=t.exports=e("datalib/src/util");r.extend(r,e("datalib/src/generate")),r.bin=e("datalib/src/bin"),r.isin=function(e,t){return-1!==t.indexOf(e)},r.forEach=function(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(var r in e)t.call(n,e[r],r,e)},r.getbins=function(e,t){return r.bin({min:e.min,max:e.max,maxbins:t})},r.setter=function(e,t,n,r){for(var a=0;a<t.length-1;++a)e=r||t[a]in e?e[t[a]]:e[t[a]]={};e[t[a]]=n},r.getter=function(e,t,n){for(var r=0;r<t.length;++r)e=n||t[r]in e?e[t[r]]:e[t[r]]={};return e},r.error=function(e){console.error("[VL Error]",e)}},{"datalib/src/bin":4,"datalib/src/generate":6,"datalib/src/util":21}]},{},[1])(1)});
//# sourceMappingURL=vegalite.min.js.map