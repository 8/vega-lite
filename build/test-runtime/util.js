"use strict";
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
// import {assert} from 'chai';
var fs = require("fs");
var mkdirp_1 = require("mkdirp");
var vega_util_1 = require("vega-util");
exports.generate = process.env.VL_GENERATE_TESTS;
exports.output = 'test-runtime/resources';
exports.selectionTypes = ['single', 'multi', 'interval'];
exports.compositeTypes = ['repeat', 'facet'];
exports.resolutions = ['union', 'intersect'];
exports.bound = 'bound';
exports.unbound = 'unbound';
exports.tuples = [
    { a: 0, b: 28, c: 0 }, { a: 0, b: 55, c: 1 }, { a: 0, b: 23, c: 2 },
    { a: 1, b: 43, c: 0 }, { a: 1, b: 91, c: 1 }, { a: 1, b: 54, c: 2 },
    { a: 2, b: 81, c: 0 }, { a: 2, b: 53, c: 1 }, { a: 2, b: 76, c: 2 },
    { a: 3, b: 19, c: 0 }, { a: 3, b: 87, c: 1 }, { a: 3, b: 12, c: 2 },
    { a: 4, b: 52, c: 0 }, { a: 4, b: 48, c: 1 }, { a: 4, b: 35, c: 2 },
    { a: 5, b: 24, c: 0 }, { a: 5, b: 49, c: 1 }, { a: 5, b: 48, c: 2 },
    { a: 6, b: 87, c: 0 }, { a: 6, b: 66, c: 1 }, { a: 6, b: 23, c: 2 },
    { a: 7, b: 17, c: 0 }, { a: 7, b: 27, c: 1 }, { a: 7, b: 39, c: 2 },
    { a: 8, b: 68, c: 0 }, { a: 8, b: 16, c: 1 }, { a: 8, b: 67, c: 2 },
    { a: 9, b: 49, c: 0 }, { a: 9, b: 15, c: 1 }, { a: 9, b: 48, 'c': 2 }
];
var unitNames = {
    repeat: ['child_d', 'child_e', 'child_f'],
    facet: ['child_0', 'child_1', 'child_2']
};
exports.hits = {
    discrete: {
        qq: [8, 19],
        qq_clear: [5, 16],
        bins: [4, 29],
        bins_clear: [18, 7],
        repeat: [5, 10, 17],
        repeat_clear: [13, 14, 2],
        facet: [2, 6, 9],
        facet_clear: [3, 4, 8]
    },
    interval: {
        drag: [[5, 14], [18, 26]],
        drag_clear: [[5], [16]],
        translate: [[6, 16], [24, 8]],
        bins: [[4, 8], [2, 7]],
        bins_clear: [[5], [9]],
        bins_translate: [[5, 7], [1, 8]],
        repeat: [[8, 29], [11, 26], [7, 21]],
        repeat_clear: [[8], [11], [17]],
        facet: [[1, 9], [2, 8], [4, 10]],
        facet_clear: [[3], [5], [7]]
    }
};
function base(iter, sel, opts) {
    if (opts === void 0) { opts = {}; }
    var data = { values: opts.values || exports.tuples };
    var x = __assign({ field: 'a', type: 'quantitative' }, opts.x);
    var y = __assign({ field: 'b', type: 'quantitative' }, opts.y);
    var color = __assign({ field: 'c', type: 'nominal' }, opts.color);
    var size = __assign({ value: 100 }, opts.size);
    var selection = { sel: sel };
    var mark = 'circle';
    return iter % 2 === 0 ? {
        data: data, selection: selection, mark: mark,
        encoding: {
            x: x, y: y, size: size,
            color: {
                condition: __assign({ selection: 'sel' }, color),
                value: 'grey'
            }
        }
    } : {
        data: data,
        layer: [{
                selection: selection, mark: mark,
                encoding: {
                    x: x, y: y, size: size, color: color,
                    opacity: { value: 0.25 }
                }
            }, {
                transform: [{ filter: { selection: 'sel' } }],
                mark: mark,
                encoding: { x: x, y: y, size: size, color: color }
            }]
    };
}
function spec(compose, iter, sel, opts) {
    if (opts === void 0) { opts = {}; }
    var _a = base(iter, sel, opts), data = _a.data, specification = __rest(_a, ["data"]);
    var resolve = opts.resolve;
    switch (compose) {
        case 'unit':
            return __assign({ data: data }, specification);
        case 'facet':
            return {
                data: data,
                facet: { row: { field: 'c', type: 'nominal' } },
                spec: specification,
                resolve: resolve
            };
        case 'repeat':
            return {
                data: data,
                repeat: { row: ['d', 'e', 'f'] },
                spec: specification,
                resolve: resolve
            };
    }
    return null;
}
exports.spec = spec;
function unitNameRegex(specType, idx) {
    var name = unitNames[specType][idx].replace('child_', '');
    return new RegExp("child(.*?)_" + name);
}
exports.unitNameRegex = unitNameRegex;
function parentSelector(compositeType, index) {
    return compositeType === 'facet' ? "cell > g:nth-child(" + (index + 1) + ")" :
        unitNames.repeat[index] + '_group';
}
exports.parentSelector = parentSelector;
function brush(key, idx, parent, targetBrush) {
    var fn = key.match('_clear') ? 'clear' : 'brush';
    return "return " + fn + "(" + exports.hits.interval[key][idx].join(', ') + ", " + vega_util_1.stringValue(parent) + ", " + !!targetBrush + ")";
}
exports.brush = brush;
function pt(key, idx, parent) {
    var fn = key.match('_clear') ? 'clear' : 'pt';
    return "return " + fn + "(" + exports.hits.discrete[key][idx] + ", " + vega_util_1.stringValue(parent) + ")";
}
exports.pt = pt;
function embedFn(browser) {
    return function (specification) {
        browser.execute(function (_) { return window['embed'](_); }, specification);
    };
}
exports.embedFn = embedFn;
function svg(browser, path, filename) {
    var xml = browser.executeAsync(function (done) {
        window['view'].runAfter(function (view) { return view.toSVG().then(function (_) { return done(_); }); });
    });
    if (exports.generate) {
        mkdirp_1.sync(path = exports.output + "/" + path);
        fs.writeFileSync(path + "/" + filename + ".svg", xml.value);
    }
    return xml.value;
}
exports.svg = svg;
function testRenderFn(browser, path) {
    return function (filename) {
        // const render =
        svg(browser, path, filename);
        // const file = fs.readFileSync(`${output}/${path}/${filename}.svg`);
        // assert.equal(render, file);
    };
}
exports.testRenderFn = testRenderFn;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3Rlc3QtcnVudGltZS91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwrQkFBK0I7QUFDL0IsdUJBQXlCO0FBQ3pCLGlDQUFzQztBQUN0Qyx1Q0FBc0M7QUFJekIsUUFBQSxRQUFRLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQztBQUN6QyxRQUFBLE1BQU0sR0FBRyx3QkFBd0IsQ0FBQztBQUdsQyxRQUFBLGNBQWMsR0FBb0IsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQ2xFLFFBQUEsY0FBYyxHQUFrQixDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNwRCxRQUFBLFdBQVcsR0FBMEIsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFFNUQsUUFBQSxLQUFLLEdBQUcsT0FBTyxDQUFDO0FBQ2hCLFFBQUEsT0FBTyxHQUFHLFNBQVMsQ0FBQztBQUVwQixRQUFBLE1BQU0sR0FBRztJQUNwQixFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUM7SUFDN0QsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDO0lBQzdELEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQztJQUM3RCxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUM7SUFDN0QsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDO0lBQzdELEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQztJQUM3RCxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUM7SUFDN0QsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDO0lBQzdELEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQztJQUM3RCxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUM7Q0FDaEUsQ0FBQztBQUVGLElBQU0sU0FBUyxHQUFHO0lBQ2hCLE1BQU0sRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FB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Q0FBQyxDQUFDLEVBQVAsQ0FBTyxDQUFDLEVBQXpDLENBQXlDLENBQUMsQ0FBQztJQUNwRixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksZ0JBQVEsRUFBRTtRQUNaLGFBQU0sQ0FBQyxJQUFJLEdBQU0sY0FBTSxTQUFJLElBQU0sQ0FBQyxDQUFDO1FBQ25DLEVBQUUsQ0FBQyxhQUFhLENBQUksSUFBSSxTQUFJLFFBQVEsU0FBTSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUN4RDtJQUVELE9BQU8sR0FBRyxDQUFDLEtBQUssQ0FBQztBQUNuQixDQUFDO0FBWEQsa0JBV0M7QUFFRCxzQkFBNkIsT0FBaUMsRUFBRSxJQUFZO0lBQzFFLE9BQU8sVUFBUyxRQUFnQjtRQUM5QixpQkFBaUI7UUFDZixHQUFHLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztRQUMvQixxRUFBcUU7UUFDckUsOEJBQThCO0lBQ2hDLENBQUMsQ0FBQztBQUNKLENBQUM7QUFQRCxvQ0FPQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCB7YXNzZXJ0fSBmcm9tICdjaGFpJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCB7c3luYyBhcyBta2RpcnB9IGZyb20gJ21rZGlycCc7XG5pbXBvcnQge3N0cmluZ1ZhbHVlfSBmcm9tICd2ZWdhLXV0aWwnO1xuaW1wb3J0IHtTZWxlY3Rpb25SZXNvbHV0aW9uLCBTZWxlY3Rpb25UeXBlfSBmcm9tICcuLi9zcmMvc2VsZWN0aW9uJztcbmltcG9ydCB7Tm9ybWFsaXplZExheWVyU3BlYywgTm9ybWFsaXplZFVuaXRTcGVjLCBUb3BMZXZlbFNwZWN9IGZyb20gJy4uL3NyYy9zcGVjJztcblxuZXhwb3J0IGNvbnN0IGdlbmVyYXRlID0gcHJvY2Vzcy5lbnYuVkxfR0VORVJBVEVfVEVTVFM7XG5leHBvcnQgY29uc3Qgb3V0cHV0ID0gJ3Rlc3QtcnVudGltZS9yZXNvdXJjZXMnO1xuXG5leHBvcnQgdHlwZSBDb21wb3NlVHlwZSA9ICd1bml0JyB8ICdyZXBlYXQnIHwgJ2ZhY2V0JztcbmV4cG9ydCBjb25zdCBzZWxlY3Rpb25UeXBlczogU2VsZWN0aW9uVHlwZVtdID0gWydzaW5nbGUnLCAnbXVsdGknLCAnaW50ZXJ2YWwnXTtcbmV4cG9ydCBjb25zdCBjb21wb3NpdGVUeXBlczogQ29tcG9zZVR5cGVbXSA9IFsncmVwZWF0JywgJ2ZhY2V0J107XG5leHBvcnQgY29uc3QgcmVzb2x1dGlvbnM6IFNlbGVjdGlvblJlc29sdXRpb25bXSA9IFsndW5pb24nLCAnaW50ZXJzZWN0J107XG5cbmV4cG9ydCBjb25zdCBib3VuZCA9ICdib3VuZCc7XG5leHBvcnQgY29uc3QgdW5ib3VuZCA9ICd1bmJvdW5kJztcblxuZXhwb3J0IGNvbnN0IHR1cGxlcyA9IFtcbiAge2E6IDAsIGI6IDI4LCBjOiAwfSwge2E6IDAsIGI6IDU1LCBjOiAxfSwge2E6IDAsIGI6IDIzLCBjOiAyfSxcbiAge2E6IDEsIGI6IDQzLCBjOiAwfSwge2E6IDEsIGI6IDkxLCBjOiAxfSwge2E6IDEsIGI6IDU0LCBjOiAyfSxcbiAge2E6IDIsIGI6IDgxLCBjOiAwfSwge2E6IDIsIGI6IDUzLCBjOiAxfSwge2E6IDIsIGI6IDc2LCBjOiAyfSxcbiAge2E6IDMsIGI6IDE5LCBjOiAwfSwge2E6IDMsIGI6IDg3LCBjOiAxfSwge2E6IDMsIGI6IDEyLCBjOiAyfSxcbiAge2E6IDQsIGI6IDUyLCBjOiAwfSwge2E6IDQsIGI6IDQ4LCBjOiAxfSwge2E6IDQsIGI6IDM1LCBjOiAyfSxcbiAge2E6IDUsIGI6IDI0LCBjOiAwfSwge2E6IDUsIGI6IDQ5LCBjOiAxfSwge2E6IDUsIGI6IDQ4LCBjOiAyfSxcbiAge2E6IDYsIGI6IDg3LCBjOiAwfSwge2E6IDYsIGI6IDY2LCBjOiAxfSwge2E6IDYsIGI6IDIzLCBjOiAyfSxcbiAge2E6IDcsIGI6IDE3LCBjOiAwfSwge2E6IDcsIGI6IDI3LCBjOiAxfSwge2E6IDcsIGI6IDM5LCBjOiAyfSxcbiAge2E6IDgsIGI6IDY4LCBjOiAwfSwge2E6IDgsIGI6IDE2LCBjOiAxfSwge2E6IDgsIGI6IDY3LCBjOiAyfSxcbiAge2E6IDksIGI6IDQ5LCBjOiAwfSwge2E6IDksIGI6IDE1LCBjOiAxfSwge2E6IDksIGI6IDQ4LCAnYyc6IDJ9XG5dO1xuXG5jb25zdCB1bml0TmFtZXMgPSB7XG4gIHJlcGVhdDogWydjaGlsZF9kJywgJ2NoaWxkX2UnLCAnY2hpbGRfZiddLFxuICBmYWNldDogWydjaGlsZF8wJywgJ2NoaWxkXzEnLCAnY2hpbGRfMiddXG59O1xuXG5leHBvcnQgY29uc3QgaGl0cyA9IHtcbiAgZGlzY3JldGU6IHtcbiAgICBxcTogWzgsIDE5XSxcbiAgICBxcV9jbGVhcjogWzUsIDE2XSxcblxuICAgIGJpbnM6IFs0LCAyOV0sXG4gICAgYmluc19jbGVhcjogWzE4LCA3XSxcblxuICAgIHJlcGVhdDogWzUsIDEwLCAxN10sXG4gICAgcmVwZWF0X2NsZWFyOiBbMTMsIDE0LCAyXSxcblxuICAgIGZhY2V0OiBbMiwgNiwgOV0sXG4gICAgZmFjZXRfY2xlYXI6IFszLCA0LCA4XVxuICB9LFxuXG4gIGludGVydmFsOiB7XG4gICAgZHJhZzogW1s1LCAxNF0sIFsxOCwgMjZdXSxcbiAgICBkcmFnX2NsZWFyOiBbWzVdLCBbMTZdXSxcbiAgICB0cmFuc2xhdGU6IFtbNiwgMTZdLCBbMjQsIDhdXSxcblxuICAgIGJpbnM6IFtbNCwgOF0sIFsyLCA3XV0sXG4gICAgYmluc19jbGVhcjogW1s1XSwgWzldXSxcbiAgICBiaW5zX3RyYW5zbGF0ZTogW1s1LCA3XSwgWzEsIDhdXSxcblxuICAgIHJlcGVhdDogW1s4LCAyOV0sIFsxMSwgMjZdLCBbNywgMjFdXSxcbiAgICByZXBlYXRfY2xlYXI6IFtbOF0sIFsxMV0sIFsxN11dLFxuXG4gICAgZmFjZXQ6IFtbMSwgOV0sIFsyLCA4XSwgWzQsIDEwXV0sXG4gICAgZmFjZXRfY2xlYXI6IFtbM10sIFs1XSwgWzddXVxuICB9XG59O1xuXG5mdW5jdGlvbiBiYXNlKGl0ZXI6IG51bWJlciwgc2VsOiBhbnksIG9wdHM6IGFueSA9IHt9KTogTm9ybWFsaXplZFVuaXRTcGVjIHwgTm9ybWFsaXplZExheWVyU3BlYyB7XG4gIGNvbnN0IGRhdGEgPSB7dmFsdWVzOiBvcHRzLnZhbHVlcyB8fCB0dXBsZXN9O1xuICBjb25zdCB4ID0ge2ZpZWxkOiAnYScsIHR5cGU6ICdxdWFudGl0YXRpdmUnLCAuLi5vcHRzLnh9O1xuICBjb25zdCB5ID0ge2ZpZWxkOiAnYicsdHlwZTogJ3F1YW50aXRhdGl2ZScsIC4uLm9wdHMueX07XG4gIGNvbnN0IGNvbG9yID0ge2ZpZWxkOiAnYycsIHR5cGU6ICdub21pbmFsJywgLi4ub3B0cy5jb2xvcn07XG4gIGNvbnN0IHNpemUgPSB7dmFsdWU6IDEwMCwgLi4ub3B0cy5zaXplfTtcbiAgY29uc3Qgc2VsZWN0aW9uID0ge3NlbH07XG4gIGNvbnN0IG1hcmsgPSAnY2lyY2xlJztcblxuICByZXR1cm4gaXRlciAlIDIgPT09IDAgPyB7XG4gICAgZGF0YSwgc2VsZWN0aW9uLCBtYXJrLFxuICAgIGVuY29kaW5nOiB7XG4gICAgICB4LCB5LCBzaXplLFxuICAgICAgY29sb3I6IHtcbiAgICAgICAgY29uZGl0aW9uOiB7c2VsZWN0aW9uOiAnc2VsJywgLi4uY29sb3J9LFxuICAgICAgICB2YWx1ZTogJ2dyZXknXG4gICAgICB9XG4gICAgfVxuICB9IDoge1xuICAgIGRhdGEsXG4gICAgbGF5ZXI6IFt7XG4gICAgICBzZWxlY3Rpb24sIG1hcmssXG4gICAgICBlbmNvZGluZzoge1xuICAgICAgICB4LCB5LCBzaXplLCBjb2xvcixcbiAgICAgICAgb3BhY2l0eToge3ZhbHVlOiAwLjI1fVxuICAgICAgfVxuICAgIH0sIHtcbiAgICAgIHRyYW5zZm9ybTogW3tmaWx0ZXI6IHtzZWxlY3Rpb246ICdzZWwnfX1dLFxuICAgICAgbWFyayxcbiAgICAgIGVuY29kaW5nOiB7eCwgeSwgc2l6ZSwgY29sb3J9XG4gICAgfV1cbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNwZWMoY29tcG9zZTogQ29tcG9zZVR5cGUsIGl0ZXI6IG51bWJlciwgc2VsOiBhbnksIG9wdHM6IGFueSA9IHt9KTogVG9wTGV2ZWxTcGVjIHtcbiAgY29uc3Qge2RhdGEsIC4uLnNwZWNpZmljYXRpb259ID0gYmFzZShpdGVyLCBzZWwsIG9wdHMpO1xuICBjb25zdCByZXNvbHZlID0gb3B0cy5yZXNvbHZlO1xuICBzd2l0Y2ggKGNvbXBvc2UpIHtcbiAgICBjYXNlICd1bml0JzpcbiAgICAgIHJldHVybiB7ZGF0YSwgLi4uc3BlY2lmaWNhdGlvbn07XG4gICAgY2FzZSAnZmFjZXQnOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YSxcbiAgICAgICAgZmFjZXQ6IHtyb3c6IHtmaWVsZDogJ2MnLCB0eXBlOiAnbm9taW5hbCd9fSxcbiAgICAgICAgc3BlYzogc3BlY2lmaWNhdGlvbixcbiAgICAgICAgcmVzb2x2ZVxuICAgICAgfTtcbiAgICBjYXNlICdyZXBlYXQnOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YSxcbiAgICAgICAgcmVwZWF0OiB7cm93OiBbJ2QnLCAnZScsICdmJ119LFxuICAgICAgICBzcGVjOiBzcGVjaWZpY2F0aW9uLFxuICAgICAgICByZXNvbHZlXG4gICAgICB9O1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1bml0TmFtZVJlZ2V4KHNwZWNUeXBlOiBDb21wb3NlVHlwZSwgaWR4OiBudW1iZXIpIHtcbiAgY29uc3QgbmFtZSA9IHVuaXROYW1lc1tzcGVjVHlwZV1baWR4XS5yZXBsYWNlKCdjaGlsZF8nLCAnJyk7XG4gIHJldHVybiBuZXcgUmVnRXhwKGBjaGlsZCguKj8pXyR7bmFtZX1gKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcmVudFNlbGVjdG9yKGNvbXBvc2l0ZVR5cGU6IENvbXBvc2VUeXBlLCBpbmRleDogbnVtYmVyKSB7XG4gIHJldHVybiBjb21wb3NpdGVUeXBlID09PSAnZmFjZXQnID8gYGNlbGwgPiBnOm50aC1jaGlsZCgke2luZGV4ICsgMX0pYCA6XG4gICAgIHVuaXROYW1lcy5yZXBlYXRbaW5kZXhdICsgJ19ncm91cCc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBicnVzaChrZXk6IHN0cmluZywgaWR4OiBudW1iZXIsIHBhcmVudD86IHN0cmluZywgdGFyZ2V0QnJ1c2g/OiBib29sZWFuKSB7XG4gIGNvbnN0IGZuID0ga2V5Lm1hdGNoKCdfY2xlYXInKSA/ICdjbGVhcicgOiAnYnJ1c2gnO1xuICByZXR1cm4gYHJldHVybiAke2ZufSgke2hpdHMuaW50ZXJ2YWxba2V5XVtpZHhdLmpvaW4oJywgJyl9LCAke3N0cmluZ1ZhbHVlKHBhcmVudCl9LCAkeyEhdGFyZ2V0QnJ1c2h9KWA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwdChrZXk6IHN0cmluZywgaWR4OiBudW1iZXIsIHBhcmVudD86IHN0cmluZykge1xuICBjb25zdCBmbiA9IGtleS5tYXRjaCgnX2NsZWFyJykgPyAnY2xlYXInIDogJ3B0JztcbiAgcmV0dXJuIGByZXR1cm4gJHtmbn0oJHtoaXRzLmRpc2NyZXRlW2tleV1baWR4XX0sICR7c3RyaW5nVmFsdWUocGFyZW50KX0pYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVtYmVkRm4oYnJvd3NlcjogV2ViZHJpdmVySU8uQ2xpZW50PHZvaWQ+KSB7XG4gIHJldHVybiBmdW5jdGlvbihzcGVjaWZpY2F0aW9uOiBUb3BMZXZlbFNwZWMpIHtcbiAgICBicm93c2VyLmV4ZWN1dGUoKF8pID0+IHdpbmRvd1snZW1iZWQnXShfKSwgc3BlY2lmaWNhdGlvbik7XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdmcoYnJvd3NlcjogV2ViZHJpdmVySU8uQ2xpZW50PHZvaWQ+LCBwYXRoOiBzdHJpbmcsIGZpbGVuYW1lOiBzdHJpbmcpIHtcbiAgY29uc3QgeG1sID0gYnJvd3Nlci5leGVjdXRlQXN5bmMoKGRvbmUpID0+IHtcbiAgICB3aW5kb3dbJ3ZpZXcnXS5ydW5BZnRlcigodmlldzogYW55KSA9PiB2aWV3LnRvU1ZHKCkudGhlbigoXzogc3RyaW5nKSA9PiBkb25lKF8pKSk7XG4gIH0pO1xuXG4gIGlmIChnZW5lcmF0ZSkge1xuICAgIG1rZGlycChwYXRoID0gYCR7b3V0cHV0fS8ke3BhdGh9YCk7XG4gICAgZnMud3JpdGVGaWxlU3luYyhgJHtwYXRofS8ke2ZpbGVuYW1lfS5zdmdgLCB4bWwudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHhtbC52YWx1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRlc3RSZW5kZXJGbihicm93c2VyOiBXZWJkcml2ZXJJTy5DbGllbnQ8dm9pZD4sIHBhdGg6IHN0cmluZykge1xuICByZXR1cm4gZnVuY3Rpb24oZmlsZW5hbWU6IHN0cmluZykge1xuICAgIC8vIGNvbnN0IHJlbmRlciA9XG4gICAgICBzdmcoYnJvd3NlciwgcGF0aCwgZmlsZW5hbWUpO1xuICAgIC8vIGNvbnN0IGZpbGUgPSBmcy5yZWFkRmlsZVN5bmMoYCR7b3V0cHV0fS8ke3BhdGh9LyR7ZmlsZW5hbWV9LnN2Z2ApO1xuICAgIC8vIGFzc2VydC5lcXVhbChyZW5kZXIsIGZpbGUpO1xuICB9O1xufVxuIl19