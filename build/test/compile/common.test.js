"use strict";
/* tslint:disable:quotemark */
Object.defineProperty(exports, "__esModule", { value: true });
var chai_1 = require("chai");
var common_1 = require("../../src/compile/common");
var config_1 = require("../../src/config");
var fielddef_1 = require("../../src/fielddef");
var timeunit_1 = require("../../src/timeunit");
var type_1 = require("../../src/type");
describe('Common', function () {
    describe('timeFormat()', function () {
        it('should get the right time expression for month with shortTimeLabels=true', function () {
            var fieldDef = { timeUnit: timeunit_1.TimeUnit.MONTH, field: 'a', type: type_1.TEMPORAL };
            var expression = common_1.timeFormatExpression(fielddef_1.vgField(fieldDef, { expr: 'datum' }), timeunit_1.TimeUnit.MONTH, undefined, true, config_1.defaultConfig.timeFormat, false);
            chai_1.assert.equal(expression, "timeFormat(datum[\"month_a\"], '%b')");
        });
        it('should get the right time expression for month with shortTimeLabels=false', function () {
            var fieldDef = { timeUnit: timeunit_1.TimeUnit.MONTH, field: 'a', type: type_1.TEMPORAL };
            var expression = common_1.timeFormatExpression(fielddef_1.vgField(fieldDef, { expr: 'datum' }), timeunit_1.TimeUnit.MONTH, undefined, false, config_1.defaultConfig.timeFormat, false);
            chai_1.assert.equal(expression, "timeFormat(datum[\"month_a\"], '%B')");
        });
        it('should get the right time expression for yearmonth with custom format', function () {
            var fieldDef = { timeUnit: timeunit_1.TimeUnit.YEARMONTH, field: 'a', type: type_1.TEMPORAL };
            var expression = common_1.timeFormatExpression(fielddef_1.vgField(fieldDef, { expr: 'datum' }), timeunit_1.TimeUnit.MONTH, '%Y', true, config_1.defaultConfig.timeFormat, false);
            chai_1.assert.equal(expression, "timeFormat(datum[\"yearmonth_a\"], '%Y')");
        });
        it('should get the right time expression for quarter', function () {
            var fieldDef = { timeUnit: timeunit_1.TimeUnit.QUARTER, field: 'a', type: type_1.TEMPORAL };
            var expression = common_1.timeFormatExpression(fielddef_1.vgField(fieldDef, { expr: 'datum' }), timeunit_1.TimeUnit.QUARTER, undefined, true, config_1.defaultConfig.timeFormat, false);
            chai_1.assert.equal(expression, "'Q' + quarter(datum[\"quarter_a\"])");
        });
        it('should get the right time expression for yearquarter', function () {
            var expression = common_1.timeFormatExpression('datum["data"]', timeunit_1.TimeUnit.YEARQUARTER, undefined, true, config_1.defaultConfig.timeFormat, false);
            chai_1.assert.equal(expression, "'Q' + quarter(datum[\"data\"]) + ' ' + timeFormat(datum[\"data\"], '%y')");
        });
        it('should get the right time expression for yearmonth with custom format and utc scale type', function () {
            var fieldDef = { timeUnit: timeunit_1.TimeUnit.YEARMONTH, field: 'a', type: type_1.TEMPORAL };
            var expression = common_1.timeFormatExpression(fielddef_1.vgField(fieldDef, { expr: 'datum' }), timeunit_1.TimeUnit.MONTH, '%Y', true, config_1.defaultConfig.timeFormat, true);
            chai_1.assert.equal(expression, "utcFormat(datum[\"yearmonth_a\"], '%Y')");
        });
    });
    describe('numberFormat()', function () {
        it('should use number format for quantitative scale', function () {
            chai_1.assert.equal(common_1.numberFormat({ field: 'a', type: type_1.QUANTITATIVE }, undefined, { numberFormat: 'd' }), 'd');
        });
        it('should support empty number format', function () {
            chai_1.assert.equal(common_1.numberFormat({ field: 'a', type: type_1.QUANTITATIVE }, undefined, { numberFormat: '' }), '');
        });
        it('should use format if provided', function () {
            chai_1.assert.equal(common_1.numberFormat({ field: 'a', type: type_1.QUANTITATIVE }, 'a', {}), 'a');
        });
        it('should not use number format for binned quantitative scale', function () {
            chai_1.assert.equal(common_1.numberFormat({ bin: true, field: 'a', type: type_1.QUANTITATIVE }, undefined, {}), undefined);
        });
        it('should not use number format for non-quantitative scale', function () {
            for (var _i = 0, _a = [type_1.TEMPORAL, type_1.NOMINAL, type_1.ORDINAL]; _i < _a.length; _i++) {
                var type = _a[_i];
                chai_1.assert.equal(common_1.numberFormat({ bin: true, field: 'a', type: type }, undefined, {}), undefined);
            }
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi90ZXN0L2NvbXBpbGUvY29tbW9uLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDhCQUE4Qjs7QUFFOUIsNkJBQTRCO0FBQzVCLG1EQUE0RTtBQUM1RSwyQ0FBK0M7QUFDL0MsK0NBQTJDO0FBQzNDLCtDQUE0QztBQUM1Qyx1Q0FBd0U7QUFFeEUsUUFBUSxDQUFDLFFBQVEsRUFBRTtJQUNqQixRQUFRLENBQUMsY0FBYyxFQUFFO1FBQ3ZCLEVBQUUsQ0FBQywwRUFBMEUsRUFBRTtZQUM3RSxJQUFNLFFBQVEsR0FBRyxFQUFDLFFBQVEsRUFBRSxtQkFBUSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxlQUFRLEVBQUMsQ0FBQztZQUN4RSxJQUFNLFVBQVUsR0FBRyw2QkFBb0IsQ0FBQyxrQkFBTyxDQUFDLFFBQVEsRUFBRSxFQUFDLElBQUksRUFBRSxPQUFPLEVBQUMsQ0FBQyxFQUFFLG1CQUFRLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsc0JBQWEsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDOUksYUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsc0NBQW9DLENBQUMsQ0FBQztRQUNqRSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyRUFBMkUsRUFBRTtZQUM5RSxJQUFNLFFBQVEsR0FBRyxFQUFDLFFBQVEsRUFBRSxtQkFBUSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxlQUFRLEVBQUMsQ0FBQztZQUN4RSxJQUFNLFVBQVUsR0FBRyw2QkFBb0IsQ0FBQyxrQkFBTyxDQUFDLFFBQVEsRUFBRSxFQUFDLElBQUksRUFBRSxPQUFPLEVBQUMsQ0FBQyxFQUFFLG1CQUFRLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUs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UyxFQUFFLEVBQUMsWUFBWSxFQUFFLEVBQUUsRUFBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDbEcsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsK0JBQStCLEVBQUU7WUFDbEMsYUFBTSxDQUFDLEtBQUssQ0FBQyxxQkFBWSxDQUFDLEVBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsbUJBQVksRUFBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM3RSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0REFBNEQsRUFBRTtZQUMvRCxhQUFNLENBQUMsS0FBSyxDQUFDLHFCQUFZLENBQUMsRUFBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLG1CQUFZLEVBQUMsRUFBRSxTQUFTLEVBQUUsRUFBRSxDQUFDLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDcEcsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseURBQXlELEVBQUU7WUFDNUQsS0FBbUIsVUFBNEIsRUFBNUIsTUFBQyxlQUFRLEVBQUUsY0FBTyxFQUFFLGNBQU8sQ0FBQyxFQUE1QixjQUE0QixFQUE1QixJQUE0QjtnQkFBMUMsSUFBTSxJQUFJLFNBQUE7Z0JBQ2IsYUFBTSxDQUFDLEtBQUssQ0FBQyxxQkFBWSxDQUFDLEVBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUMsRUFBRSxTQUFTLEVBQUUsRUFBRSxDQUFDLEVBQUUsU0FBUyxDQUFDLENBQUM7YUFDM0Y7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiB0c2xpbnQ6ZGlzYWJsZTpxdW90ZW1hcmsgKi9cblxuaW1wb3J0IHthc3NlcnR9IGZyb20gJ2NoYWknO1xuaW1wb3J0IHtudW1iZXJGb3JtYXQsIHRpbWVGb3JtYXRFeHByZXNzaW9ufSBmcm9tICcuLi8uLi9zcmMvY29tcGlsZS9jb21tb24nO1xuaW1wb3J0IHtkZWZhdWx0Q29uZmlnfSBmcm9tICcuLi8uLi9zcmMvY29uZmlnJztcbmltcG9ydCB7dmdGaWVsZH0gZnJvbSAnLi4vLi4vc3JjL2ZpZWxkZGVmJztcbmltcG9ydCB7VGltZVVuaXR9IGZyb20gJy4uLy4uL3NyYy90aW1ldW5pdCc7XG5pbXBvcnQge05PTUlOQUwsIE9SRElOQUwsIFFVQU5USVRBVElWRSwgVEVNUE9SQUx9IGZyb20gJy4uLy4uL3NyYy90eXBlJztcblxuZGVzY3JpYmUoJ0NvbW1vbicsIGZ1bmN0aW9uKCkge1xuICBkZXNjcmliZSgndGltZUZvcm1hdCgpJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgdGhlIHJpZ2h0IHRpbWUgZXhwcmVzc2lvbiBmb3IgbW9udGggd2l0aCBzaG9ydFRpbWVMYWJlbHM9dHJ1ZScsIGZ1bmN0aW9uKCkge1xuICAgICAgY29uc3QgZmllbGREZWYgPSB7dGltZVVuaXQ6IFRpbWVVbml0Lk1PTlRILCBmaWVsZDogJ2EnLCB0eXBlOiBURU1QT1JBTH07XG4gICAgICBjb25zdCBleHByZXNzaW9uID0gdGltZUZvcm1hdEV4cHJlc3Npb24odmdGaWVsZChmaWVsZERlZiwge2V4cHI6ICdkYXR1bSd9KSwgVGltZVVuaXQuTU9OVEgsIHVuZGVmaW5lZCwgdHJ1ZSwgZGVmYXVsdENvbmZpZy50aW1lRm9ybWF0LCBmYWxzZSk7XG4gICAgICBhc3NlcnQuZXF1YWwoZXhwcmVzc2lvbiwgYHRpbWVGb3JtYXQoZGF0dW1bXCJtb250aF9hXCJdLCAnJWInKWApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdGhlIHJpZ2h0IHRpbWUgZXhwcmVzc2lvbiBmb3IgbW9udGggd2l0aCBzaG9ydFRpbWVMYWJlbHM9ZmFsc2UnLCBmdW5jdGlvbigpIHtcbiAgICAgIGNvbnN0IGZpZWxkRGVmID0ge3RpbWVVbml0OiBUaW1lVW5pdC5NT05USCwgZmllbGQ6ICdhJywgdHlwZTogVEVNUE9SQUx9O1xuICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IHRpbWVGb3JtYXRFeHByZXNzaW9uKHZnRmllbGQoZmllbGREZWYsIHtleHByOiAnZGF0dW0nfSksIFRpbWVVbml0Lk1PTlRILCB1bmRlZmluZWQsIGZhbHNlLCBkZWZhdWx0Q29uZmlnLnRpbWVGb3JtYXQsIGZhbHNlKTtcbiAgICAgIGFzc2VydC5lcXVhbChleHByZXNzaW9uLCBgdGltZUZvcm1hdChkYXR1bVtcIm1vbnRoX2FcIl0sICclQicpYCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgcmlnaHQgdGltZSBleHByZXNzaW9uIGZvciB5ZWFybW9udGggd2l0aCBjdXN0b20gZm9ybWF0JywgZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCBmaWVsZERlZiA9IHt0aW1lVW5pdDogVGltZVVuaXQuWUVBUk1PTlRILCBmaWVsZDogJ2EnLCB0eXBlOiBURU1QT1JBTH07XG4gICAgICBjb25zdCBleHByZXNzaW9uID0gdGltZUZvcm1hdEV4cHJlc3Npb24odmdGaWVsZChmaWVsZERlZiwge2V4cHI6ICdkYXR1bSd9KSwgVGltZVVuaXQuTU9OVEgsICclWScsIHRydWUsIGRlZmF1bHRDb25maWcudGltZUZvcm1hdCwgZmFsc2UpO1xuICAgICAgYXNzZXJ0LmVxdWFsKGV4cHJlc3Npb24sIGB0aW1lRm9ybWF0KGRhdHVtW1wieWVhcm1vbnRoX2FcIl0sICclWScpYCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgcmlnaHQgdGltZSBleHByZXNzaW9uIGZvciBxdWFydGVyJywgZnVuY3Rpb24oKSB7XG4gICAgICBjb25zdCBmaWVsZERlZiA9IHt0aW1lVW5pdDogVGltZVVuaXQuUVVBUlRFUiwgZmllbGQ6ICdhJywgdHlwZTogVEVNUE9SQUx9O1xuICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IHRpbWVGb3JtYXRFeHByZXNzaW9uKHZnRmllbGQoZmllbGREZWYsIHtleHByOiAnZGF0dW0nfSksIFRpbWVVbml0LlFVQVJURVIsIHVuZGVmaW5lZCwgdHJ1ZSwgZGVmYXVsdENvbmZpZy50aW1lRm9ybWF0LCBmYWxzZSk7XG4gICAgICBhc3NlcnQuZXF1YWwoZXhwcmVzc2lvbiwgYCdRJyArIHF1YXJ0ZXIoZGF0dW1bXCJxdWFydGVyX2FcIl0pYCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgcmlnaHQgdGltZSBleHByZXNzaW9uIGZvciB5ZWFycXVhcnRlcicsIGZ1bmN0aW9uKCkge1xuICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IHRpbWVGb3JtYXRFeHByZXNzaW9uKCdkYXR1bVtcImRhdGFcIl0nLCBUaW1lVW5pdC5ZRUFSUVVBUlRFUiwgdW5kZWZpbmVkLCB0cnVlLCBkZWZhdWx0Q29uZmlnLnRpbWVGb3JtYXQsIGZhbHNlKTtcbiAgICAgIGFzc2VydC5lcXVhbChleHByZXNzaW9uLCBgJ1EnICsgcXVhcnRlcihkYXR1bVtcImRhdGFcIl0pICsgJyAnICsgdGltZUZvcm1hdChkYXR1bVtcImRhdGFcIl0sICcleScpYCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgcmlnaHQgdGltZSBleHByZXNzaW9uIGZvciB5ZWFybW9udGggd2l0aCBjdXN0b20gZm9ybWF0IGFuZCB1dGMgc2NhbGUgdHlwZScsIGZ1bmN0aW9uKCkge1xuICAgICAgY29uc3QgZmllbGREZWYgPSB7dGltZVVuaXQ6IFRpbWVVbml0LllFQVJNT05USCwgZmllbGQ6ICdhJywgdHlwZTogVEVNUE9SQUx9O1xuICAgICAgY29uc3QgZXhwcmVzc2lvbiA9IHRpbWVGb3JtYXRFeHByZXNzaW9uKHZnRmllbGQoZmllbGREZWYsIHtleHByOiAnZGF0dW0nfSksIFRpbWVVbml0Lk1PTlRILCAnJVknLCB0cnVlLCBkZWZhdWx0Q29uZmlnLnRpbWVGb3JtYXQsIHRydWUpO1xuICAgICAgYXNzZXJ0LmVxdWFsKGV4cHJlc3Npb24sIGB1dGNGb3JtYXQoZGF0dW1bXCJ5ZWFybW9udGhfYVwiXSwgJyVZJylgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ251bWJlckZvcm1hdCgpJywgZnVuY3Rpb24oKSB7XG4gICAgaXQoJ3Nob3VsZCB1c2UgbnVtYmVyIGZvcm1hdCBmb3IgcXVhbnRpdGF0aXZlIHNjYWxlJywgZnVuY3Rpb24oKSB7XG4gICAgICBhc3NlcnQuZXF1YWwobnVtYmVyRm9ybWF0KHtmaWVsZDogJ2EnLCB0eXBlOiBRVUFOVElUQVRJVkV9LCB1bmRlZmluZWQsIHtudW1iZXJGb3JtYXQ6ICdkJ30pLCAnZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzdXBwb3J0IGVtcHR5IG51bWJlciBmb3JtYXQnLCBmdW5jdGlvbigpIHtcbiAgICAgIGFzc2VydC5lcXVhbChudW1iZXJGb3JtYXQoe2ZpZWxkOiAnYScsIHR5cGU6IFFVQU5USVRBVElWRX0sIHVuZGVmaW5lZCwge251bWJlckZvcm1hdDogJyd9KSwgJycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgZm9ybWF0IGlmIHByb3ZpZGVkJywgZnVuY3Rpb24oKSB7XG4gICAgICBhc3NlcnQuZXF1YWwobnVtYmVyRm9ybWF0KHtmaWVsZDogJ2EnLCB0eXBlOiBRVUFOVElUQVRJVkV9LCAnYScsIHt9KSwgJ2EnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHVzZSBudW1iZXIgZm9ybWF0IGZvciBiaW5uZWQgcXVhbnRpdGF0aXZlIHNjYWxlJywgZnVuY3Rpb24oKSB7XG4gICAgICBhc3NlcnQuZXF1YWwobnVtYmVyRm9ybWF0KHtiaW46IHRydWUsIGZpZWxkOiAnYScsIHR5cGU6IFFVQU5USVRBVElWRX0sIHVuZGVmaW5lZCwge30pLCB1bmRlZmluZWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgdXNlIG51bWJlciBmb3JtYXQgZm9yIG5vbi1xdWFudGl0YXRpdmUgc2NhbGUnLCBmdW5jdGlvbigpIHtcbiAgICAgIGZvciAoY29uc3QgdHlwZSBvZiBbVEVNUE9SQUwsIE5PTUlOQUwsIE9SRElOQUxdKSB7XG4gICAgICAgIGFzc2VydC5lcXVhbChudW1iZXJGb3JtYXQoe2JpbjogdHJ1ZSwgZmllbGQ6ICdhJywgdHlwZTogdHlwZX0sIHVuZGVmaW5lZCwge30pLCB1bmRlZmluZWQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19