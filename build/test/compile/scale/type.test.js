import { assert } from 'chai';
import { rangeType, SCALE_CHANNELS, X, Y } from '../../../src/channel';
import { scaleType } from '../../../src/compile/scale/type';
import { defaultConfig } from '../../../src/config';
import * as log from '../../../src/log';
import { PRIMITIVE_MARKS } from '../../../src/mark';
import { ScaleType } from '../../../src/scale';
import { TIMEUNITS } from '../../../src/timeunit';
import { NOMINAL, ORDINAL } from '../../../src/type';
import * as util from '../../../src/util';
var defaultScaleConfig = defaultConfig.scale;
describe('compile/scale', function () {
    describe('type()', function () {
        it('should return null for channel without scale', function () {
            assert.deepEqual(scaleType(undefined, 'detail', { type: 'temporal', timeUnit: 'yearmonth' }, 'point', defaultScaleConfig), null);
        });
        it('should show warning if users try to override the scale and use bin', log.wrap(function (localLogger) {
            assert.deepEqual(scaleType('point', 'color', { type: 'quantitative', bin: true }, 'point', defaultScaleConfig), ScaleType.BIN_ORDINAL);
            assert.equal(localLogger.warns[0], log.message.scaleTypeNotWorkWithFieldDef(ScaleType.POINT, ScaleType.BIN_ORDINAL));
        }));
        describe('nominal/ordinal', function () {
            describe('color', function () {
                it('should return ordinal scale for nominal data by default.', function () {
                    assert.equal(scaleType(undefined, 'color', { type: 'nominal' }, 'point', defaultScaleConfig), ScaleType.ORDINAL);
                });
                it('should return ordinal scale for ordinal data.', function () {
                    assert.equal(scaleType(undefined, 'color', { type: 'nominal' }, 'point', defaultScaleConfig), ScaleType.ORDINAL);
                });
            });
            describe('discrete channel (shape)', function () {
                it('should return ordinal for nominal field', function () {
                    assert.deepEqual(scaleType(undefined, 'shape', { type: 'nominal' }, 'point', defaultScaleConfig), ScaleType.ORDINAL);
                });
                it('should return ordinal even if other type is specified', log.wrap(function (localLogger) {
                    [ScaleType.LINEAR, ScaleType.BAND, ScaleType.POINT].forEach(function (badScaleType) {
                        assert.deepEqual(scaleType(badScaleType, 'shape', { type: 'nominal' }, 'point', defaultScaleConfig), ScaleType.ORDINAL);
                        var warns = localLogger.warns;
                        assert.equal(warns[warns.length - 1], log.message.scaleTypeNotWorkWithChannel('shape', badScaleType, 'ordinal'));
                    });
                }));
                it('should return ordinal for an ordinal field and throw a warning.', log.wrap(function (localLogger) {
                    assert.deepEqual(scaleType(undefined, 'shape', { type: 'ordinal' }, 'point', defaultScaleConfig), ScaleType.ORDINAL);
                    assert.equal(localLogger.warns[0], log.message.discreteChannelCannotEncode('shape', 'ordinal'));
                }));
            });
            describe('continuous', function () {
                it('should return point scale for ordinal X,Y for marks others than rect, rule, and bar', function () {
                    PRIMITIVE_MARKS.forEach(function (mark) {
                        if (util.contains(['bar', 'rule', 'rect'], mark)) {
                            return;
                        }
                        [ORDINAL, NOMINAL].forEach(function (t) {
                            [X, Y].forEach(function (channel) {
                                assert.equal(scaleType(undefined, channel, { type: t }, mark, defaultScaleConfig), ScaleType.POINT);
                            });
                        });
                    });
                });
                it('should return band scale for ordinal X,Y when mark is rect, rule, bar', function () {
                    [ORDINAL, NOMINAL].forEach(function (t) {
                        [X, Y].forEach(function (channel) {
                            ['bar', 'rule', 'rect'].forEach(function (mark) {
                                assert.equal(scaleType(undefined, channel, { type: t }, 'rect', defaultScaleConfig), ScaleType.BAND);
                            });
                        });
                    });
                });
                it('should return point scale for X,Y when mark is point', function () {
                    [ORDINAL, NOMINAL].forEach(function (t) {
                        [X, Y].forEach(function (channel) {
                            assert.equal(scaleType(undefined, channel, { type: t }, 'point', defaultScaleConfig), ScaleType.POINT);
                        });
                    });
                });
                it('should return point scale for X,Y when mark is point when ORDINAL SCALE TYPE is specified and throw warning', log.wrap(function (localLogger) {
                    [ORDINAL, NOMINAL].forEach(function (t) {
                        [X, Y].forEach(function (channel) {
                            assert.equal(scaleType('ordinal', channel, { type: t }, 'point', defaultScaleConfig), ScaleType.POINT);
                            var warns = localLogger.warns;
                            assert.equal(warns[warns.length - 1], log.message.scaleTypeNotWorkWithChannel(channel, 'ordinal', 'point'));
                        });
                    });
                }));
                it('should return point scale for ordinal/nominal fields for continuous channels other than x and y.', function () {
                    var OTHER_CONTINUOUS_CHANNELS = SCALE_CHANNELS.filter(function (c) { return rangeType(c) === 'continuous' && !util.contains([X, Y], c); });
                    PRIMITIVE_MARKS.forEach(function (mark) {
                        [ORDINAL, NOMINAL].forEach(function (t) {
                            OTHER_CONTINUOUS_CHANNELS.forEach(function (channel) {
                                assert.equal(scaleType(undefined, channel, { type: t }, mark, defaultScaleConfig), ScaleType.POINT, channel + ", " + mark + ", " + t + " " + scaleType(undefined, channel, { type: t }, mark, defaultScaleConfig));
                            });
                        });
                    });
                });
            });
        });
        describe('temporal', function () {
            it('should return sequential scale for temporal color field by default.', function () {
                assert.equal(scaleType(undefined, 'color', { type: 'temporal' }, 'point', defaultScaleConfig), ScaleType.SEQUENTIAL);
            });
            it('should return ordinal for temporal field and throw a warning.', log.wrap(function (localLogger) {
                assert.deepEqual(scaleType(undefined, 'shape', { type: 'temporal', timeUnit: 'yearmonth' }, 'point', defaultScaleConfig), ScaleType.ORDINAL);
                assert.equal(localLogger.warns[0], log.message.discreteChannelCannotEncode('shape', 'temporal'));
            }));
            it('should return time for all time units.', function () {
                for (var _i = 0, TIMEUNITS_1 = TIMEUNITS; _i < TIMEUNITS_1.length; _i++) {
                    var timeUnit = TIMEUNITS_1[_i];
                    assert.deepEqual(scaleType(undefined, Y, { type: 'temporal', timeUnit: timeUnit }, 'point', defaultScaleConfig), ScaleType.TIME);
                }
            });
        });
        describe('quantitative', function () {
            it('should return sequential scale for quantitative color field by default.', function () {
                assert.equal(scaleType(undefined, 'color', { type: 'quantitative' }, 'point', defaultScaleConfig), ScaleType.SEQUENTIAL);
            });
            it('should return ordinal bin scale for quantitative color field with binning.', function () {
                assert.equal(scaleType(undefined, 'color', { type: 'quantitative', bin: true }, 'point', defaultScaleConfig), ScaleType.BIN_ORDINAL);
            });
            it('should return ordinal for encoding quantitative field with a discrete channel and throw a warning.', log.wrap(function (localLogger) {
                assert.deepEqual(scaleType(undefined, 'shape', { type: 'quantitative' }, 'point', defaultScaleConfig), ScaleType.ORDINAL);
                assert.equal(localLogger.warns[0], log.message.discreteChannelCannotEncode('shape', 'quantitative'));
            }));
            it('should return linear scale for quantitative by default.', function () {
                assert.equal(scaleType(undefined, 'x', { type: 'quantitative' }, 'point', defaultScaleConfig), ScaleType.LINEAR);
            });
            it('should return bin linear scale for quantitative by default.', function () {
                assert.equal(scaleType(undefined, 'opacity', { type: 'quantitative', bin: true }, 'point', defaultScaleConfig), ScaleType.BIN_LINEAR);
            });
            it('should return linear scale for quantitative x and y.', function () {
                assert.equal(scaleType(undefined, 'x', { type: 'quantitative', bin: true }, 'point', defaultScaleConfig), ScaleType.LINEAR);
            });
        });
        describe('dataTypeMatchScaleType()', function () {
            it('should return specified value if datatype is ordinal or nominal and specified scale type is the ordinal or nominal', function () {
                assert.equal(scaleType(ScaleType.ORDINAL, 'shape', { type: 'ordinal' }, 'point', defaultScaleConfig), ScaleType.ORDINAL);
            });
            it('should return default scale type if data type is temporal but specified scale type is not time or utc', function () {
                assert.equal(scaleType(ScaleType.LINEAR, 'x', { type: 'temporal', timeUnit: 'year' }, 'point', defaultScaleConfig), ScaleType.TIME);
                assert.equal(scaleType(ScaleType.LINEAR, 'color', { type: 'temporal', timeUnit: 'year' }, 'point', defaultScaleConfig), ScaleType.SEQUENTIAL);
            });
            it('should return time if data type is temporal but specified scale type is discrete', function () {
                assert.equal(scaleType(ScaleType.POINT, 'x', { type: 'temporal', timeUnit: 'year' }, 'point', defaultScaleConfig), ScaleType.TIME);
            });
            it('should return default scale type if data type is temporal but specified scale type is time or utc or any discrete type', function () {
                assert.equal(scaleType(ScaleType.LINEAR, 'x', { type: 'temporal', timeUnit: 'year' }, 'point', defaultScaleConfig), ScaleType.TIME);
            });
            it('should return default scale type if data type is quantative but scale type do not support quantative', function () {
                assert.equal(scaleType(ScaleType.TIME, 'color', { type: 'quantitative' }, 'point', defaultScaleConfig), ScaleType.SEQUENTIAL);
            });
            it('should return default scale type if data type is quantative and scale type supports quantative', function () {
                assert.equal(scaleType(ScaleType.TIME, 'x', { type: 'quantitative' }, 'point', defaultScaleConfig), ScaleType.LINEAR);
            });
            it('should return default scale type if data type is quantative and scale type supports quantative', function () {
                assert.equal(scaleType(ScaleType.TIME, 'x', { type: 'temporal' }, 'point', defaultScaleConfig), ScaleType.TIME);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdGVzdC9jb21waWxlL3NjYWxlL3R5cGUudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsTUFBTSxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBQzVCLE9BQU8sRUFBQyxTQUFTLEVBQUUsY0FBYyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsTUFBTSxzQkFBc0IsQ0FBQztBQUNyRSxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0saUNBQWlDLENBQUM7QUFDMUQsT0FBTyxFQUFDLGFBQWEsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQ2xELE9BQU8sS0FBSyxHQUFHLE1BQU0sa0JBQWtCLENBQUM7QUFDeEMsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxvQkFBb0IsQ0FBQztBQUM3QyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sdUJBQXVCLENBQUM7QUFDaEQsT0FBTyxFQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUMsTUFBTSxtQkFBbUIsQ0FBQztBQUNuRCxPQUFPLEtBQUssSUFBSSxNQUFNLG1CQUFtQixDQUFDO0FBRTFDLElBQU0sa0JBQWtCLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQztBQUUvQyxRQUFRLENBQUMsZUFBZSxFQUFFO0lBQ3hCLFFBQVEsQ0FBQyxRQUFRLEVBQUU7UUFDakIsRUFBRSxDQUFDLDhDQUE4QyxFQUFFO1lBQ2pELE1BQU0sQ0FBQyxTQUFTLENBQ2QsU0FBUyxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUMsRUFBRSxPQUFPLEVBQUUsa0JBQWtCLENBQUMsRUFDdEcsSUFBSSxDQUNMLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvRUFB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Z0JBQ25HLE1BQU0sQ0FBQyxLQUFLLENBQ1YsU0FBUyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUMsSUFBSSxFQUFFLGNBQWMsRUFBQyxFQUFFLE9BQU8sRUFBRSxrQkFBa0IsQ0FBQyxFQUNuRixTQUFTLENBQUMsTUFBTSxDQUNqQixDQUFDO1lBQ0osQ0FBQyxDQUFDLENBQUM7WUFFSCxFQUFFLENBQUMsZ0dBQWdHLEVBQUU7Z0JBQ25HLE1BQU0sQ0FBQyxLQUFLLENBQ1YsU0FBUyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUMsSUFBSSxFQUFFLFVBQVUsRUFBQyxFQUFFLE9BQU8sRUFBRSxrQkFBa0IsQ0FBQyxFQUMvRSxTQUFTLENBQUMsSUFBSSxDQUNmLENBQUM7WUFDSixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7YXNzZXJ0fSBmcm9tICdjaGFpJztcbmltcG9ydCB7cmFuZ2VUeXBlLCBTQ0FMRV9DSEFOTkVMUywgWCwgWX0gZnJvbSAnLi4vLi4vLi4vc3JjL2NoYW5uZWwnO1xuaW1wb3J0IHtzY2FsZVR5cGV9IGZyb20gJy4uLy4uLy4uL3NyYy9jb21waWxlL3NjYWxlL3R5cGUnO1xuaW1wb3J0IHtkZWZhdWx0Q29uZmlnfSBmcm9tICcuLi8uLi8uLi9zcmMvY29uZmlnJztcbmltcG9ydCAqIGFzIGxvZyBmcm9tICcuLi8uLi8uLi9zcmMvbG9nJztcbmltcG9ydCB7UFJJTUlUSVZFX01BUktTfSBmcm9tICcuLi8uLi8uLi9zcmMvbWFyayc7XG5pbXBvcnQge1NjYWxlVHlwZX0gZnJvbSAnLi4vLi4vLi4vc3JjL3NjYWxlJztcbmltcG9ydCB7VElNRVVOSVRTfSBmcm9tICcuLi8uLi8uLi9zcmMvdGltZXVuaXQnO1xuaW1wb3J0IHtOT01JTkFMLCBPUkRJTkFMfSBmcm9tICcuLi8uLi8uLi9zcmMvdHlwZSc7XG5pbXBvcnQgKiBhcyB1dGlsIGZyb20gJy4uLy4uLy4uL3NyYy91dGlsJztcblxuY29uc3QgZGVmYXVsdFNjYWxlQ29uZmlnID0gZGVmYXVsdENvbmZpZy5zY2FsZTtcblxuZGVzY3JpYmUoJ2NvbXBpbGUvc2NhbGUnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCd0eXBlKCknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCBmb3IgY2hhbm5lbCB3aXRob3V0IHNjYWxlJywgZnVuY3Rpb24oKSB7XG4gICAgICBhc3NlcnQuZGVlcEVxdWFsKFxuICAgICAgICBzY2FsZVR5cGUodW5kZWZpbmVkLCAnZGV0YWlsJywge3R5cGU6ICd0ZW1wb3JhbCcsIHRpbWVVbml0OiAneWVhcm1vbnRoJ30sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksXG4gICAgICAgIG51bGxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNob3cgd2FybmluZyBpZiB1c2VycyB0cnkgdG8gb3ZlcnJpZGUgdGhlIHNjYWxlIGFuZCB1c2UgYmluJywgbG9nLndyYXAoKGxvY2FsTG9nZ2VyKSA9PiB7XG4gICAgICBhc3NlcnQuZGVlcEVxdWFsKFxuICAgICAgICBzY2FsZVR5cGUoJ3BvaW50JywgJ2NvbG9yJywge3R5cGU6ICdxdWFudGl0YXRpdmUnLCBiaW46IHRydWV9LCAncG9pbnQnLCBkZWZhdWx0U2NhbGVDb25maWcpLFxuICAgICAgICBTY2FsZVR5cGUuQklOX09SRElOQUxcbiAgICAgICk7XG4gICAgICBhc3NlcnQuZXF1YWwobG9jYWxMb2dnZXIud2FybnNbMF0sIGxvZy5tZXNzYWdlLnNjYWxlVHlwZU5vdFdvcmtXaXRoRmllbGREZWYoU2NhbGVUeXBlLlBPSU5ULCBTY2FsZVR5cGUuQklOX09SRElOQUwpKTtcbiAgICB9KSk7XG5cbiAgICBkZXNjcmliZSgnbm9taW5hbC9vcmRpbmFsJywgKCkgPT4ge1xuICAgICAgZGVzY3JpYmUoJ2NvbG9yJywgKCkgPT4ge1xuICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBvcmRpbmFsIHNjYWxlIGZvciBub21pbmFsIGRhdGEgYnkgZGVmYXVsdC4nLCAoKSA9PiB7XG4gICAgICAgICAgYXNzZXJ0LmVxdWFsKFxuICAgICAgICAgICAgc2NhbGVUeXBlKHVuZGVmaW5lZCwgJ2NvbG9yJywge3R5cGU6ICdub21pbmFsJ30sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksXG4gICAgICAgICAgICBTY2FsZVR5cGUuT1JESU5BTFxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG9yZGluYWwgc2NhbGUgZm9yIG9yZGluYWwgZGF0YS4nLCAoKSA9PiB7XG4gICAgICAgICAgYXNzZXJ0LmVxdWFsKFxuICAgICAgICAgICAgc2NhbGVUeXBlKHVuZGVmaW5lZCwgJ2NvbG9yJywge3R5cGU6ICdub21pbmFsJ30sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksXG4gICAgICAgICAgICBTY2FsZVR5cGUuT1JESU5BTFxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGRlc2NyaWJlKCdkaXNjcmV0ZSBjaGFubmVsIChzaGFwZSknLCAoKSA9PiB7XG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG9yZGluYWwgZm9yIG5vbWluYWwgZmllbGQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKFxuICAgICAgICAgICAgc2NhbGVUeXBlKHVuZGVmaW5lZCwgJ3NoYXBlJywge3R5cGU6ICdub21pbmFsJ30sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksXG4gICAgICAgICAgICBTY2FsZVR5cGUuT1JESU5BTFxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG9yZGluYWwgZXZlbiBpZiBvdGhlciB0eXBlIGlzIHNwZWNpZmllZCcsIGxvZy53cmFwKChsb2NhbExvZ2dlcikgPT4ge1xuICAgICAgICAgIFtTY2FsZVR5cGUuTElORUFSLCBTY2FsZVR5cGUuQkFORCwgU2NhbGVUeXBlLlBPSU5UXS5mb3JFYWNoKChiYWRTY2FsZVR5cGUpID0+IHtcbiAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwoXG4gICAgICAgICAgICAgIHNjYWxlVHlwZShiYWRTY2FsZVR5cGUsICdzaGFwZScsIHt0eXBlOiAnbm9taW5hbCd9LCAncG9pbnQnLCBkZWZhdWx0U2NhbGVDb25maWcpLFxuICAgICAgICAgICAgICBTY2FsZVR5cGUuT1JESU5BTFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IHdhcm5zID0gbG9jYWxMb2dnZXIud2FybnM7XG4gICAgICAgICAgICBhc3NlcnQuZXF1YWwod2FybnNbd2FybnMubGVuZ3RoLTFdLCBsb2cubWVzc2FnZS5zY2FsZVR5cGVOb3RXb3JrV2l0aENoYW5uZWwoJ3NoYXBlJywgYmFkU2NhbGVUeXBlLCAnb3JkaW5hbCcpKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG9yZGluYWwgZm9yIGFuIG9yZGluYWwgZmllbGQgYW5kIHRocm93IGEgd2FybmluZy4nLCBsb2cud3JhcCgobG9jYWxMb2dnZXIpID0+IHtcbiAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKFxuICAgICAgICAgICAgc2NhbGVUeXBlKHVuZGVmaW5lZCwgJ3NoYXBlJywge3R5cGU6ICdvcmRpbmFsJ30sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksXG4gICAgICAgICAgICBTY2FsZVR5cGUuT1JESU5BTFxuICAgICAgICAgICk7XG4gICAgICAgICAgYXNzZXJ0LmVxdWFsKGxvY2FsTG9nZ2VyLndhcm5zWzBdLCBsb2cubWVzc2FnZS5kaXNjcmV0ZUNoYW5uZWxDYW5ub3RFbmNvZGUoJ3NoYXBlJywgJ29yZGluYWwnKSk7XG4gICAgICAgIH0pKTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnY29udGludW91cycsICgpID0+IHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gcG9pbnQgc2NhbGUgZm9yIG9yZGluYWwgWCxZIGZvciBtYXJrcyBvdGhlcnMgdGhhbiByZWN0LCBydWxlLCBhbmQgYmFyJywgKCkgPT4ge1xuICAgICAgICAgIFBSSU1JVElWRV9NQVJLUy5mb3JFYWNoKChtYXJrKSA9PiB7XG4gICAgICAgICAgICBpZiAodXRpbC5jb250YWlucyhbJ2JhcicsICdydWxlJywgJ3JlY3QnXSwgbWFyaykpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBbT1JESU5BTCwgTk9NSU5BTF0uZm9yRWFjaCgodCkgPT4ge1xuICAgICAgICAgICAgICBbWCwgWV0uZm9yRWFjaCgoY2hhbm5lbCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzc2VydC5lcXVhbChcbiAgICAgICAgICAgICAgICAgIHNjYWxlVHlwZSh1bmRlZmluZWQsIGNoYW5uZWwsIHt0eXBlOiB0fSwgbWFyaywgZGVmYXVsdFNjYWxlQ29uZmlnKSxcbiAgICAgICAgICAgICAgICAgIFNjYWxlVHlwZS5QT0lOVFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGJhbmQgc2NhbGUgZm9yIG9yZGluYWwgWCxZIHdoZW4gbWFyayBpcyByZWN0LCBydWxlLCBiYXInLCAoKSA9PiB7XG4gICAgICAgICAgW09SRElOQUwsIE5PTUlOQUxdLmZvckVhY2goKHQpID0+IHtcbiAgICAgICAgICAgIFtYLCBZXS5mb3JFYWNoKChjaGFubmVsKSA9PiB7XG4gICAgICAgICAgICAgIFsnYmFyJywgJ3J1bGUnLCAncmVjdCddLmZvckVhY2goKG1hcmspID0+IHtcbiAgICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwoXG4gICAgICAgICAgICAgICAgICBzY2FsZVR5cGUodW5kZWZpbmVkLCBjaGFubmVsLCB7dHlwZTogdH0sICdyZWN0JywgZGVmYXVsdFNjYWxlQ29uZmlnKSxcbiAgICAgICAgICAgICAgICAgIFNjYWxlVHlwZS5CQU5EXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gcG9pbnQgc2NhbGUgZm9yIFgsWSB3aGVuIG1hcmsgaXMgcG9pbnQnLCAoKSA9PiB7XG4gICAgICAgICAgW09SRElOQUwsIE5PTUlOQUxdLmZvckVhY2goKHQpID0+IHtcbiAgICAgICAgICAgIFtYLCBZXS5mb3JFYWNoKChjaGFubmVsKSA9PiB7XG4gICAgICAgICAgICAgIGFzc2VydC5lcXVhbChzY2FsZVR5cGUodW5kZWZpbmVkLCBjaGFubmVsLCB7dHlwZTogdH0sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksIFNjYWxlVHlwZS5QT0lOVCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gcG9pbnQgc2NhbGUgZm9yIFgsWSB3aGVuIG1hcmsgaXMgcG9pbnQgd2hlbiBPUkRJTkFMIFNDQUxFIFRZUEUgaXMgc3BlY2lmaWVkIGFuZCB0aHJvdyB3YXJuaW5nJywgbG9nLndyYXAoKGxvY2FsTG9nZ2VyKSA9PiB7XG4gICAgICAgICAgW09SRElOQUwsIE5PTUlOQUxdLmZvckVhY2goKHQpID0+IHtcbiAgICAgICAgICAgIFtYLCBZXS5mb3JFYWNoKChjaGFubmVsKSA9PiB7XG4gICAgICAgICAgICAgIGFzc2VydC5lcXVhbChzY2FsZVR5cGUoJ29yZGluYWwnLCBjaGFubmVsLCB7dHlwZTogdH0sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksIFNjYWxlVHlwZS5QT0lOVCk7XG4gICAgICAgICAgICAgIGNvbnN0IHdhcm5zID0gbG9jYWxMb2dnZXIud2FybnM7XG4gICAgICAgICAgICAgIGFzc2VydC5lcXVhbCh3YXJuc1t3YXJucy5sZW5ndGgtMV0sIGxvZy5tZXNzYWdlLnNjYWxlVHlwZU5vdFdvcmtXaXRoQ2hhbm5lbChjaGFubmVsLCAnb3JkaW5hbCcsICdwb2ludCcpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gcG9pbnQgc2NhbGUgZm9yIG9yZGluYWwvbm9taW5hbCBmaWVsZHMgZm9yIGNvbnRpbnVvdXMgY2hhbm5lbHMgb3RoZXIgdGhhbiB4IGFuZCB5LicsICgpID0+IHtcbiAgICAgICAgICBjb25zdCBPVEhFUl9DT05USU5VT1VTX0NIQU5ORUxTID0gU0NBTEVfQ0hBTk5FTFMuZmlsdGVyKChjKSA9PiByYW5nZVR5cGUoYykgPT09ICdjb250aW51b3VzJyAmJiAhdXRpbC5jb250YWlucyhbWCwgWV0sIGMpKTtcbiAgICAgICAgICBQUklNSVRJVkVfTUFSS1MuZm9yRWFjaCgobWFyaykgPT4ge1xuICAgICAgICAgICAgW09SRElOQUwsIE5PTUlOQUxdLmZvckVhY2goKHQpID0+IHtcbiAgICAgICAgICAgICAgT1RIRVJfQ09OVElOVU9VU19DSEFOTkVMUy5mb3JFYWNoKChjaGFubmVsKSA9PiB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKFxuICAgICAgICAgICAgICAgICAgc2NhbGVUeXBlKHVuZGVmaW5lZCwgY2hhbm5lbCwge3R5cGU6IHR9LCBtYXJrLCBkZWZhdWx0U2NhbGVDb25maWcpLFxuICAgICAgICAgICAgICAgICAgU2NhbGVUeXBlLlBPSU5ULFxuICAgICAgICAgICAgICAgICAgYCR7Y2hhbm5lbH0sICR7bWFya30sICR7dH0gYCArIHNjYWxlVHlwZSh1bmRlZmluZWQsIGNoYW5uZWwsIHt0eXBlOiB0fSwgbWFyaywgZGVmYXVsdFNjYWxlQ29uZmlnKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndGVtcG9yYWwnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBzZXF1ZW50aWFsIHNjYWxlIGZvciB0ZW1wb3JhbCBjb2xvciBmaWVsZCBieSBkZWZhdWx0LicsICgpID0+IHtcbiAgICAgICAgYXNzZXJ0LmVxdWFsKFxuICAgICAgICAgIHNjYWxlVHlwZSh1bmRlZmluZWQsICdjb2xvcicsIHt0eXBlOiAndGVtcG9yYWwnfSwgJ3BvaW50JywgZGVmYXVsdFNjYWxlQ29uZmlnKSxcbiAgICAgICAgICBTY2FsZVR5cGUuU0VRVUVOVElBTFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG9yZGluYWwgZm9yIHRlbXBvcmFsIGZpZWxkIGFuZCB0aHJvdyBhIHdhcm5pbmcuJywgbG9nLndyYXAoKGxvY2FsTG9nZ2VyKSA9PiB7XG4gICAgICAgIGFzc2VydC5kZWVwRXF1YWwoXG4gICAgICAgICAgc2NhbGVUeXBlKHVuZGVmaW5lZCwgJ3NoYXBlJywge3R5cGU6ICd0ZW1wb3JhbCcsIHRpbWVVbml0OiAneWVhcm1vbnRoJ30sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksXG4gICAgICAgICAgU2NhbGVUeXBlLk9SRElOQUxcbiAgICAgICAgKTtcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGxvY2FsTG9nZ2VyLndhcm5zWzBdLCBsb2cubWVzc2FnZS5kaXNjcmV0ZUNoYW5uZWxDYW5ub3RFbmNvZGUoJ3NoYXBlJywgJ3RlbXBvcmFsJykpO1xuICAgICAgfSkpO1xuXG4gICAgICBpdCgnc2hvdWxkIHJldHVybiB0aW1lIGZvciBhbGwgdGltZSB1bml0cy4nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgZm9yIChjb25zdCB0aW1lVW5pdCBvZiBUSU1FVU5JVFMpIHtcbiAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKFxuICAgICAgICAgICAgc2NhbGVUeXBlKHVuZGVmaW5lZCwgWSwge3R5cGU6ICd0ZW1wb3JhbCcsIHRpbWVVbml0OiB0aW1lVW5pdH0sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksXG4gICAgICAgICAgICBTY2FsZVR5cGUuVElNRVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGRlc2NyaWJlKCdxdWFudGl0YXRpdmUnLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBzZXF1ZW50aWFsIHNjYWxlIGZvciBxdWFudGl0YXRpdmUgY29sb3IgZmllbGQgYnkgZGVmYXVsdC4nLCAoKSA9PiB7XG4gICAgICAgIGFzc2VydC5lcXVhbChcbiAgICAgICAgICBzY2FsZVR5cGUodW5kZWZpbmVkLCAnY29sb3InLCB7dHlwZTogJ3F1YW50aXRhdGl2ZSd9LCAncG9pbnQnLCBkZWZhdWx0U2NhbGVDb25maWcpLFxuICAgICAgICAgIFNjYWxlVHlwZS5TRVFVRU5USUFMXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gb3JkaW5hbCBiaW4gc2NhbGUgZm9yIHF1YW50aXRhdGl2ZSBjb2xvciBmaWVsZCB3aXRoIGJpbm5pbmcuJywgKCkgPT4ge1xuICAgICAgICBhc3NlcnQuZXF1YWwoXG4gICAgICAgICAgc2NhbGVUeXBlKHVuZGVmaW5lZCwgJ2NvbG9yJywge3R5cGU6ICdxdWFudGl0YXRpdmUnLCBiaW46IHRydWV9LCAncG9pbnQnLCBkZWZhdWx0U2NhbGVDb25maWcpLFxuICAgICAgICAgIFNjYWxlVHlwZS5CSU5fT1JESU5BTFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG9yZGluYWwgZm9yIGVuY29kaW5nIHF1YW50aXRhdGl2ZSBmaWVsZCB3aXRoIGEgZGlzY3JldGUgY2hhbm5lbCBhbmQgdGhyb3cgYSB3YXJuaW5nLicsIGxvZy53cmFwKChsb2NhbExvZ2dlcikgPT4ge1xuICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKFxuICAgICAgICAgIHNjYWxlVHlwZSh1bmRlZmluZWQsICdzaGFwZScsIHt0eXBlOiAncXVhbnRpdGF0aXZlJ30sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksXG4gICAgICAgICAgU2NhbGVUeXBlLk9SRElOQUxcbiAgICAgICAgKTtcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGxvY2FsTG9nZ2VyLndhcm5zWzBdLCBsb2cubWVzc2FnZS5kaXNjcmV0ZUNoYW5uZWxDYW5ub3RFbmNvZGUoJ3NoYXBlJywgJ3F1YW50aXRhdGl2ZScpKTtcbiAgICAgIH0pKTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gbGluZWFyIHNjYWxlIGZvciBxdWFudGl0YXRpdmUgYnkgZGVmYXVsdC4nLCAoKSA9PiB7XG4gICAgICAgIGFzc2VydC5lcXVhbChcbiAgICAgICAgICBzY2FsZVR5cGUodW5kZWZpbmVkLCAneCcsIHt0eXBlOiAncXVhbnRpdGF0aXZlJ30sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksXG4gICAgICAgICAgU2NhbGVUeXBlLkxJTkVBUlxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGJpbiBsaW5lYXIgc2NhbGUgZm9yIHF1YW50aXRhdGl2ZSBieSBkZWZhdWx0LicsICgpID0+IHtcbiAgICAgICAgYXNzZXJ0LmVxdWFsKFxuICAgICAgICAgIHNjYWxlVHlwZSh1bmRlZmluZWQsICdvcGFjaXR5Jywge3R5cGU6ICdxdWFudGl0YXRpdmUnLCBiaW46IHRydWV9LCAncG9pbnQnLCBkZWZhdWx0U2NhbGVDb25maWcpLFxuICAgICAgICAgIFNjYWxlVHlwZS5CSU5fTElORUFSXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gbGluZWFyIHNjYWxlIGZvciBxdWFudGl0YXRpdmUgeCBhbmQgeS4nLCAoKSA9PiB7XG4gICAgICAgIGFzc2VydC5lcXVhbChcbiAgICAgICAgICBzY2FsZVR5cGUodW5kZWZpbmVkLCAneCcsIHt0eXBlOiAncXVhbnRpdGF0aXZlJywgYmluOiB0cnVlfSwgJ3BvaW50JywgZGVmYXVsdFNjYWxlQ29uZmlnKSxcbiAgICAgICAgICBTY2FsZVR5cGUuTElORUFSXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdkYXRhVHlwZU1hdGNoU2NhbGVUeXBlKCknLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBzcGVjaWZpZWQgdmFsdWUgaWYgZGF0YXR5cGUgaXMgb3JkaW5hbCBvciBub21pbmFsIGFuZCBzcGVjaWZpZWQgc2NhbGUgdHlwZSBpcyB0aGUgb3JkaW5hbCBvciBub21pbmFsJywgKCkgPT4ge1xuICAgICAgICBhc3NlcnQuZXF1YWwoXG4gICAgICAgICAgc2NhbGVUeXBlKFNjYWxlVHlwZS5PUkRJTkFMLCAnc2hhcGUnLCB7dHlwZTogJ29yZGluYWwnfSwgJ3BvaW50JywgZGVmYXVsdFNjYWxlQ29uZmlnKSxcbiAgICAgICAgICBTY2FsZVR5cGUuT1JESU5BTFxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGRlZmF1bHQgc2NhbGUgdHlwZSBpZiBkYXRhIHR5cGUgaXMgdGVtcG9yYWwgYnV0IHNwZWNpZmllZCBzY2FsZSB0eXBlIGlzIG5vdCB0aW1lIG9yIHV0YycsICgpID0+IHtcbiAgICAgICAgYXNzZXJ0LmVxdWFsKFxuICAgICAgICAgIHNjYWxlVHlwZShTY2FsZVR5cGUuTElORUFSLCAneCcsIHt0eXBlOiAndGVtcG9yYWwnLCB0aW1lVW5pdDogJ3llYXInfSwgJ3BvaW50JywgZGVmYXVsdFNjYWxlQ29uZmlnKSxcbiAgICAgICAgICBTY2FsZVR5cGUuVElNRVxuICAgICAgICApO1xuXG4gICAgICAgIGFzc2VydC5lcXVhbChcbiAgICAgICAgICBzY2FsZVR5cGUoU2NhbGVUeXBlLkxJTkVBUiwgJ2NvbG9yJywge3R5cGU6ICd0ZW1wb3JhbCcsIHRpbWVVbml0OiAneWVhcid9LCAncG9pbnQnLCBkZWZhdWx0U2NhbGVDb25maWcpLFxuICAgICAgICAgIFNjYWxlVHlwZS5TRVFVRU5USUFMXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdGltZSBpZiBkYXRhIHR5cGUgaXMgdGVtcG9yYWwgYnV0IHNwZWNpZmllZCBzY2FsZSB0eXBlIGlzIGRpc2NyZXRlJywgKCkgPT4ge1xuICAgICAgICBhc3NlcnQuZXF1YWwoXG4gICAgICAgICAgc2NhbGVUeXBlKFNjYWxlVHlwZS5QT0lOVCwgJ3gnLCB7dHlwZTogJ3RlbXBvcmFsJywgdGltZVVuaXQ6ICd5ZWFyJ30sICdwb2ludCcsIGRlZmF1bHRTY2FsZUNvbmZpZyksXG4gICAgICAgICAgU2NhbGVUeXBlLlRJTUVcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBkZWZhdWx0IHNjYWxlIHR5cGUgaWYgZGF0YSB0eXBlIGlzIHRlbXBvcmFsIGJ1dCBzcGVjaWZpZWQgc2NhbGUgdHlwZSBpcyB0aW1lIG9yIHV0YyBvciBhbnkgZGlzY3JldGUgdHlwZScsICgpID0+IHtcbiAgICAgICAgYXNzZXJ0LmVxdWFsKFxuICAgICAgICAgIHNjYWxlVHlwZShTY2FsZVR5cGUuTElORUFSLCAneCcsIHt0eXBlOiAndGVtcG9yYWwnLCB0aW1lVW5pdDogJ3llYXInfSwgJ3BvaW50JywgZGVmYXVsdFNjYWxlQ29uZmlnKSxcbiAgICAgICAgICBTY2FsZVR5cGUuVElNRVxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGRlZmF1bHQgc2NhbGUgdHlwZSBpZiBkYXRhIHR5cGUgaXMgcXVhbnRhdGl2ZSBidXQgc2NhbGUgdHlwZSBkbyBub3Qgc3VwcG9ydCBxdWFudGF0aXZlJywgKCkgPT4ge1xuICAgICAgICBhc3NlcnQuZXF1YWwoXG4gICAgICAgICAgc2NhbGVUeXBlKFNjYWxlVHlwZS5USU1FLCAnY29sb3InLCB7dHlwZTogJ3F1YW50aXRhdGl2ZSd9LCAncG9pbnQnLCBkZWZhdWx0U2NhbGVDb25maWcpLFxuICAgICAgICAgIFNjYWxlVHlwZS5TRVFVRU5USUFMXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZGVmYXVsdCBzY2FsZSB0eXBlIGlmIGRhdGEgdHlwZSBpcyBxdWFudGF0aXZlIGFuZCBzY2FsZSB0eXBlIHN1cHBvcnRzIHF1YW50YXRpdmUnLCAoKSA9PiB7XG4gICAgICAgIGFzc2VydC5lcXVhbChcbiAgICAgICAgICBzY2FsZVR5cGUoU2NhbGVUeXBlLlRJTUUsICd4Jywge3R5cGU6ICdxdWFudGl0YXRpdmUnfSwgJ3BvaW50JywgZGVmYXVsdFNjYWxlQ29uZmlnKSxcbiAgICAgICAgICBTY2FsZVR5cGUuTElORUFSXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZGVmYXVsdCBzY2FsZSB0eXBlIGlmIGRhdGEgdHlwZSBpcyBxdWFudGF0aXZlIGFuZCBzY2FsZSB0eXBlIHN1cHBvcnRzIHF1YW50YXRpdmUnLCAoKSA9PiB7XG4gICAgICAgIGFzc2VydC5lcXVhbChcbiAgICAgICAgICBzY2FsZVR5cGUoU2NhbGVUeXBlLlRJTUUsICd4Jywge3R5cGU6ICd0ZW1wb3JhbCd9LCAncG9pbnQnLCBkZWZhdWx0U2NhbGVDb25maWcpLFxuICAgICAgICAgIFNjYWxlVHlwZS5USU1FXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==