"use strict";
/* tslint:disable quotemark */
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var chai_1 = require("chai");
var vega_event_selector_1 = require("vega-event-selector");
var selection = tslib_1.__importStar(require("../../../src/compile/selection/selection"));
var util_1 = require("../../../src/util");
var util_2 = require("../../util");
describe('Selection', function () {
    var model = util_2.parseUnitModel({
        "mark": "circle",
        "encoding": {
            "x": { "field": "Horsepower", "type": "quantitative" },
            "y": { "field": "Miles_per_Gallon", "type": "quantitative" },
            "color": { "field": "Origin", "type": "nominal" }
        }
    });
    it('parses default selection definitions', function () {
        var component = selection.parseUnitSelection(model, {
            "one": { "type": "single" },
            "two": { "type": "multi" },
            "three": { "type": "interval" }
        });
        chai_1.assert.sameMembers(util_1.keys(component), ['one', 'two', 'three']);
        chai_1.assert.equal(component.one.name, 'one');
        chai_1.assert.equal(component.one.type, 'single');
        chai_1.assert.sameDeepMembers(component['one'].project, [{ field: '_vgsid_', channel: null }]);
        chai_1.assert.sameDeepMembers(component['one'].events, vega_event_selector_1.selector('click', 'scope'));
        chai_1.assert.equal(component.two.name, 'two');
        chai_1.assert.equal(component.two.type, 'multi');
        chai_1.assert.equal(component.two.toggle, 'event.shiftKey');
        chai_1.assert.sameDeepMembers(component['two'].project, [{ field: '_vgsid_', channel: null }]);
        chai_1.assert.sameDeepMembers(component['two'].events, vega_event_selector_1.selector('click', 'scope'));
        chai_1.assert.equal(component.three.name, 'three');
        chai_1.assert.equal(component.three.type, 'interval');
        chai_1.assert.equal(component.three.translate, '[mousedown, window:mouseup] > window:mousemove!');
        chai_1.assert.equal(component.three.zoom, 'wheel!');
        chai_1.assert.sameDeepMembers(component['three'].project, [{ field: 'Horsepower', channel: 'x' }, { field: 'Miles_per_Gallon', channel: 'y' }]);
        chai_1.assert.sameDeepMembers(component['three'].events, vega_event_selector_1.selector('[mousedown, window:mouseup] > window:mousemove!', 'scope'));
    });
    it('supports inline default overrides', function () {
        var component = selection.parseUnitSelection(model, {
            "one": {
                "type": "single",
                "on": "dblclick", "fields": ["Cylinders"]
            },
            "two": {
                "type": "multi",
                "on": "mouseover", "toggle": "event.ctrlKey", "encodings": ["color"]
            },
            "three": {
                "type": "interval",
                "on": "[mousedown[!event.shiftKey], mouseup] > mousemove",
                "encodings": ["y"], "translate": false, "zoom": "wheel[event.altKey]"
            }
        });
        chai_1.assert.sameMembers(util_1.keys(component), ['one', 'two', 'three']);
        chai_1.assert.equal(component.one.name, 'one');
        chai_1.assert.equal(component.one.type, 'single');
        chai_1.assert.sameDeepMembers(component['one'].project, [{ field: 'Cylinders', channel: null }]);
        chai_1.assert.sameDeepMembers(component['one'].events, vega_event_selector_1.selector('dblclick', 'scope'));
        chai_1.assert.equal(component.two.name, 'two');
        chai_1.assert.equal(component.two.type, 'multi');
        chai_1.assert.equal(component.two.toggle, 'event.ctrlKey');
        chai_1.assert.sameDeepMembers(component['two'].project, [{ field: 'Origin', channel: 'color' }]);
        chai_1.assert.sameDeepMembers(component['two'].events, vega_event_selector_1.selector('mouseover', 'scope'));
        chai_1.assert.equal(component.three.name, 'three');
        chai_1.assert.equal(component.three.type, 'interval');
        chai_1.assert.equal(component.three.translate, false);
        chai_1.assert.equal(component.three.zoom, 'wheel[event.altKey]');
        chai_1.assert.sameDeepMembers(component['three'].project, [{ field: 'Miles_per_Gallon', channel: 'y' }]);
        chai_1.assert.sameDeepMembers(component['three'].events, vega_event_selector_1.selector('[mousedown[!event.shiftKey], mouseup] > mousemove', 'scope'));
    });
    it('respects selection configs', function () {
        model.config.selection = {
            single: { on: 'dblclick', fields: ['Cylinders'] },
            multi: { on: 'mouseover', encodings: ['color'], toggle: 'event.ctrlKey' },
            interval: {
                on: '[mousedown[!event.shiftKey], mouseup] > mousemove',
                encodings: ['y'],
                zoom: 'wheel[event.altKey]'
            }
        };
        var component = selection.parseUnitSelection(model, {
            "one": { "type": "single" },
            "two": { "type": "multi" },
            "three": { "type": "interval" }
        });
        chai_1.assert.sameMembers(util_1.keys(component), ['one', 'two', 'three']);
        chai_1.assert.equal(component.one.name, 'one');
        chai_1.assert.equal(component.one.type, 'single');
        chai_1.assert.sameDeepMembers(component['one'].project, [{ field: 'Cylinders', channel: null }]);
        chai_1.assert.sameDeepMembers(component['one'].events, vega_event_selector_1.selector('dblclick', 'scope'));
        chai_1.assert.equal(component.two.name, 'two');
        chai_1.assert.equal(component.two.type, 'multi');
        chai_1.assert.equal(component.two.toggle, 'event.ctrlKey');
        chai_1.assert.sameDeepMembers(component['two'].project, [{ field: 'Origin', channel: 'color' }]);
        chai_1.assert.sameDeepMembers(component['two'].events, vega_event_selector_1.selector('mouseover', 'scope'));
        chai_1.assert.equal(component.three.name, 'three');
        chai_1.assert.equal(component.three.type, 'interval');
        chai_1.assert(!component.three.translate);
        chai_1.assert.equal(component.three.zoom, 'wheel[event.altKey]');
        chai_1.assert.sameDeepMembers(component['three'].project, [{ field: 'Miles_per_Gallon', channel: 'y' }]);
        chai_1.assert.sameDeepMembers(component['three'].events, vega_event_selector_1.selector('[mousedown[!event.shiftKey], mouseup] > mousemove', 'scope'));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2UudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3QvY29tcGlsZS9zZWxlY3Rpb24vcGFyc2UudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsOEJBQThCOzs7QUFFOUIsNkJBQTRCO0FBQzVCLDJEQUE4RDtBQUM5RCwwRkFBc0U7QUFDdEUsMENBQXVDO0FBQ3ZDLG1DQUEwQztBQUUxQyxRQUFRLENBQUMsV0FBVyxFQUFFO0lBQ3BCLElBQU0sS0FBSyxHQUFHLHFCQUFjLENBQUM7UUFDM0IsTUFBTSxFQUFFLFFBQVE7UUFDaEIsVUFBVSxFQUFFO1lBQ1YsR0FBRyxFQUFFLEVBQUMsT0FBTyxFQUFFLFlBQVksRUFBQyxNQUFNLEVBQUUsY0FBYyxFQUFDO1lBQ25ELEdBQUcsRUFBRSxFQUFDLE9BQU8sRUFBRSxrQkFBa0IsRUFBQyxNQUFNLEVBQUUsY0FBYyxFQUFDO1lBQ3pELE9BQU8sRUFBRSxFQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBQztTQUNoRDtLQUNGLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxzQ0FBc0MsRUFBRTtRQUN6QyxJQUFNLFNBQVMsR0FBRyxTQUFTLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFO1lBQ3BELEtBQUssRUFBRSxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUM7WUFDekIsS0FBSyxFQUFFLEVBQUMsTUFBTSxFQUFFLE9BQU8sRUFBQztZQUN4QixPQUFPLEVBQUUsRUFBQyxNQUFNLEVBQUUsVUFBVSxFQUFDO1NBQzlCLENBQUMsQ0FBQztRQUVILGFBQU0sQ0FBQyxXQUFXLENBQUMsV0FBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBRTdELGFBQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENB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QyxLQUFLLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEgsYUFBTSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxFQUFFLDhCQUFhLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFFckYsYUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM1QyxhQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQy9DLGFBQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbkMsYUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO1FBQzFELGFBQU0sQ0FBQyxlQUFlLENBQTZCLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxFQUFDLEtBQUssRUFBRSxrQkFBa0IsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzVILGFBQU0sQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sRUFBRSw4QkFBYSxDQUFDLG1EQUFtRCxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDakksQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIHRzbGludDpkaXNhYmxlIHF1b3RlbWFyayAqL1xuXG5pbXBvcnQge2Fzc2VydH0gZnJvbSAnY2hhaSc7XG5pbXBvcnQge3NlbGVjdG9yIGFzIHBhcnNlU2VsZWN0b3J9IGZyb20gJ3ZlZ2EtZXZlbnQtc2VsZWN0b3InO1xuaW1wb3J0ICogYXMgc2VsZWN0aW9uIGZyb20gJy4uLy4uLy4uL3NyYy9jb21waWxlL3NlbGVjdGlvbi9zZWxlY3Rpb24nO1xuaW1wb3J0IHtrZXlzfSBmcm9tICcuLi8uLi8uLi9zcmMvdXRpbCc7XG5pbXBvcnQge3BhcnNlVW5pdE1vZGVsfSBmcm9tICcuLi8uLi91dGlsJztcblxuZGVzY3JpYmUoJ1NlbGVjdGlvbicsIGZ1bmN0aW9uKCkge1xuICBjb25zdCBtb2RlbCA9IHBhcnNlVW5pdE1vZGVsKHtcbiAgICBcIm1hcmtcIjogXCJjaXJjbGVcIixcbiAgICBcImVuY29kaW5nXCI6IHtcbiAgICAgIFwieFwiOiB7XCJmaWVsZFwiOiBcIkhvcnNlcG93ZXJcIixcInR5cGVcIjogXCJxdWFudGl0YXRpdmVcIn0sXG4gICAgICBcInlcIjoge1wiZmllbGRcIjogXCJNaWxlc19wZXJfR2FsbG9uXCIsXCJ0eXBlXCI6IFwicXVhbnRpdGF0aXZlXCJ9LFxuICAgICAgXCJjb2xvclwiOiB7XCJmaWVsZFwiOiBcIk9yaWdpblwiLCBcInR5cGVcIjogXCJub21pbmFsXCJ9XG4gICAgfVxuICB9KTtcblxuICBpdCgncGFyc2VzIGRlZmF1bHQgc2VsZWN0aW9uIGRlZmluaXRpb25zJywgZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgY29tcG9uZW50ID0gc2VsZWN0aW9uLnBhcnNlVW5pdFNlbGVjdGlvbihtb2RlbCwge1xuICAgICAgXCJvbmVcIjoge1widHlwZVwiOiBcInNpbmdsZVwifSxcbiAgICAgIFwidHdvXCI6IHtcInR5cGVcIjogXCJtdWx0aVwifSxcbiAgICAgIFwidGhyZWVcIjoge1widHlwZVwiOiBcImludGVydmFsXCJ9XG4gICAgfSk7XG5cbiAgICBhc3NlcnQuc2FtZU1lbWJlcnMoa2V5cyhjb21wb25lbnQpLCBbJ29uZScsICd0d28nLCAndGhyZWUnXSk7XG5cbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50Lm9uZS5uYW1lLCAnb25lJyk7XG4gICAgYXNzZXJ0LmVxdWFsKGNvbXBvbmVudC5vbmUudHlwZSwgJ3NpbmdsZScpO1xuICAgIGFzc2VydC5zYW1lRGVlcE1lbWJlcnMoY29tcG9uZW50WydvbmUnXS5wcm9qZWN0LCBbe2ZpZWxkOiAnX3Znc2lkXycsIGNoYW5uZWw6IG51bGx9XSk7XG4gICAgYXNzZXJ0LnNhbWVEZWVwTWVtYmVycyhjb21wb25lbnRbJ29uZSddLmV2ZW50cywgcGFyc2VTZWxlY3RvcignY2xpY2snLCAnc2NvcGUnKSk7XG5cbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnR3by5uYW1lLCAndHdvJyk7XG4gICAgYXNzZXJ0LmVxdWFsKGNvbXBvbmVudC50d28udHlwZSwgJ211bHRpJyk7XG4gICAgYXNzZXJ0LmVxdWFsKGNvbXBvbmVudC50d28udG9nZ2xlLCAnZXZlbnQuc2hpZnRLZXknKTtcbiAgICBhc3NlcnQuc2FtZURlZXBNZW1iZXJzKGNvbXBvbmVudFsndHdvJ10ucHJvamVjdCwgW3tmaWVsZDogJ192Z3NpZF8nLCBjaGFubmVsOiBudWxsfV0pO1xuICAgIGFzc2VydC5zYW1lRGVlcE1lbWJlcnMoY29tcG9uZW50Wyd0d28nXS5ldmVudHMsIHBhcnNlU2VsZWN0b3IoJ2NsaWNrJywgJ3Njb3BlJykpO1xuXG4gICAgYXNzZXJ0LmVxdWFsKGNvbXBvbmVudC50aHJlZS5uYW1lLCAndGhyZWUnKTtcbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnRocmVlLnR5cGUsICdpbnRlcnZhbCcpO1xuICAgIGFzc2VydC5lcXVhbChjb21wb25lbnQudGhyZWUudHJhbnNsYXRlLCAnW21vdXNlZG93biwgd2luZG93Om1vdXNldXBdID4gd2luZG93Om1vdXNlbW92ZSEnKTtcbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnRocmVlLnpvb20sICd3aGVlbCEnKTtcbiAgICBhc3NlcnQuc2FtZURlZXBNZW1iZXJzPHNlbGVjdGlvbi5Qcm9qZWN0Q29tcG9uZW50Pihjb21wb25lbnRbJ3RocmVlJ10ucHJvamVjdCwgW3tmaWVsZDogJ0hvcnNlcG93ZXInLCBjaGFubmVsOiAneCd9LCB7ZmllbGQ6ICdNaWxlc19wZXJfR2FsbG9uJywgY2hhbm5lbDogJ3knfV0pO1xuICAgIGFzc2VydC5zYW1lRGVlcE1lbWJlcnMoY29tcG9uZW50Wyd0aHJlZSddLmV2ZW50cywgcGFyc2VTZWxlY3RvcignW21vdXNlZG93biwgd2luZG93Om1vdXNldXBdID4gd2luZG93Om1vdXNlbW92ZSEnLCAnc2NvcGUnKSk7XG4gIH0pO1xuXG4gIGl0KCdzdXBwb3J0cyBpbmxpbmUgZGVmYXVsdCBvdmVycmlkZXMnLCBmdW5jdGlvbigpIHtcbiAgICBjb25zdCBjb21wb25lbnQgPSBzZWxlY3Rpb24ucGFyc2VVbml0U2VsZWN0aW9uKG1vZGVsLCB7XG4gICAgICBcIm9uZVwiOiB7XG4gICAgICAgIFwidHlwZVwiOiBcInNpbmdsZVwiLFxuICAgICAgICBcIm9uXCI6IFwiZGJsY2xpY2tcIiwgXCJmaWVsZHNcIjogW1wiQ3lsaW5kZXJzXCJdXG4gICAgICB9LFxuICAgICAgXCJ0d29cIjoge1xuICAgICAgICBcInR5cGVcIjogXCJtdWx0aVwiLFxuICAgICAgICBcIm9uXCI6IFwibW91c2VvdmVyXCIsIFwidG9nZ2xlXCI6IFwiZXZlbnQuY3RybEtleVwiLCBcImVuY29kaW5nc1wiOiBbXCJjb2xvclwiXVxuICAgICAgfSxcbiAgICAgIFwidGhyZWVcIjoge1xuICAgICAgICBcInR5cGVcIjogXCJpbnRlcnZhbFwiLFxuICAgICAgICBcIm9uXCI6IFwiW21vdXNlZG93blshZXZlbnQuc2hpZnRLZXldLCBtb3VzZXVwXSA+IG1vdXNlbW92ZVwiLFxuICAgICAgICBcImVuY29kaW5nc1wiOiBbXCJ5XCJdLCBcInRyYW5zbGF0ZVwiOiBmYWxzZSwgXCJ6b29tXCI6IFwid2hlZWxbZXZlbnQuYWx0S2V5XVwiXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBhc3NlcnQuc2FtZU1lbWJlcnMoa2V5cyhjb21wb25lbnQpLCBbJ29uZScsICd0d28nLCAndGhyZWUnXSk7XG5cbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50Lm9uZS5uYW1lLCAnb25lJyk7XG4gICAgYXNzZXJ0LmVxdWFsKGNvbXBvbmVudC5vbmUudHlwZSwgJ3NpbmdsZScpO1xuICAgIGFzc2VydC5zYW1lRGVlcE1lbWJlcnMoY29tcG9uZW50WydvbmUnXS5wcm9qZWN0LCBbe2ZpZWxkOiAnQ3lsaW5kZXJzJywgY2hhbm5lbDogbnVsbH1dKTtcbiAgICBhc3NlcnQuc2FtZURlZXBNZW1iZXJzKGNvbXBvbmVudFsnb25lJ10uZXZlbnRzLCBwYXJzZVNlbGVjdG9yKCdkYmxjbGljaycsICdzY29wZScpKTtcblxuICAgIGFzc2VydC5lcXVhbChjb21wb25lbnQudHdvLm5hbWUsICd0d28nKTtcbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnR3by50eXBlLCAnbXVsdGknKTtcbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnR3by50b2dnbGUsICdldmVudC5jdHJsS2V5Jyk7XG4gICAgYXNzZXJ0LnNhbWVEZWVwTWVtYmVyczxzZWxlY3Rpb24uUHJvamVjdENvbXBvbmVudD4oY29tcG9uZW50Wyd0d28nXS5wcm9qZWN0LCBbe2ZpZWxkOiAnT3JpZ2luJywgY2hhbm5lbDogJ2NvbG9yJ31dKTtcbiAgICBhc3NlcnQuc2FtZURlZXBNZW1iZXJzKGNvbXBvbmVudFsndHdvJ10uZXZlbnRzLCBwYXJzZVNlbGVjdG9yKCdtb3VzZW92ZXInLCAnc2NvcGUnKSk7XG5cbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnRocmVlLm5hbWUsICd0aHJlZScpO1xuICAgIGFzc2VydC5lcXVhbChjb21wb25lbnQudGhyZWUudHlwZSwgJ2ludGVydmFsJyk7XG4gICAgYXNzZXJ0LmVxdWFsKGNvbXBvbmVudC50aHJlZS50cmFuc2xhdGUsIGZhbHNlKTtcbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnRocmVlLnpvb20sICd3aGVlbFtldmVudC5hbHRLZXldJyk7XG4gICAgYXNzZXJ0LnNhbWVEZWVwTWVtYmVyczxzZWxlY3Rpb24uUHJvamVjdENvbXBvbmVudD4oY29tcG9uZW50Wyd0aHJlZSddLnByb2plY3QsIFt7ZmllbGQ6ICdNaWxlc19wZXJfR2FsbG9uJywgY2hhbm5lbDogJ3knfV0pO1xuICAgIGFzc2VydC5zYW1lRGVlcE1lbWJlcnMoY29tcG9uZW50Wyd0aHJlZSddLmV2ZW50cywgcGFyc2VTZWxlY3RvcignW21vdXNlZG93blshZXZlbnQuc2hpZnRLZXldLCBtb3VzZXVwXSA+IG1vdXNlbW92ZScsICdzY29wZScpKTtcbiAgfSk7XG5cbiAgaXQoJ3Jlc3BlY3RzIHNlbGVjdGlvbiBjb25maWdzJywgZnVuY3Rpb24oKSB7XG4gICAgbW9kZWwuY29uZmlnLnNlbGVjdGlvbiA9IHtcbiAgICAgIHNpbmdsZToge29uOiAnZGJsY2xpY2snLCBmaWVsZHM6IFsnQ3lsaW5kZXJzJ119LFxuICAgICAgbXVsdGk6IHtvbjogJ21vdXNlb3ZlcicsIGVuY29kaW5nczogWydjb2xvciddLCB0b2dnbGU6ICdldmVudC5jdHJsS2V5J30sXG4gICAgICBpbnRlcnZhbDoge1xuICAgICAgICBvbjogJ1ttb3VzZWRvd25bIWV2ZW50LnNoaWZ0S2V5XSwgbW91c2V1cF0gPiBtb3VzZW1vdmUnLFxuICAgICAgICBlbmNvZGluZ3M6IFsneSddLFxuICAgICAgICB6b29tOiAnd2hlZWxbZXZlbnQuYWx0S2V5XSdcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgY29tcG9uZW50ID0gc2VsZWN0aW9uLnBhcnNlVW5pdFNlbGVjdGlvbihtb2RlbCwge1xuICAgICAgXCJvbmVcIjoge1widHlwZVwiOiBcInNpbmdsZVwifSxcbiAgICAgIFwidHdvXCI6IHtcInR5cGVcIjogXCJtdWx0aVwifSxcbiAgICAgIFwidGhyZWVcIjoge1widHlwZVwiOiBcImludGVydmFsXCJ9XG4gICAgfSk7XG5cbiAgICBhc3NlcnQuc2FtZU1lbWJlcnMoa2V5cyhjb21wb25lbnQpLCBbJ29uZScsICd0d28nLCAndGhyZWUnXSk7XG5cbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50Lm9uZS5uYW1lLCAnb25lJyk7XG4gICAgYXNzZXJ0LmVxdWFsKGNvbXBvbmVudC5vbmUudHlwZSwgJ3NpbmdsZScpO1xuICAgIGFzc2VydC5zYW1lRGVlcE1lbWJlcnMoY29tcG9uZW50WydvbmUnXS5wcm9qZWN0LCBbe2ZpZWxkOiAnQ3lsaW5kZXJzJywgY2hhbm5lbDogbnVsbH1dKTtcbiAgICBhc3NlcnQuc2FtZURlZXBNZW1iZXJzKGNvbXBvbmVudFsnb25lJ10uZXZlbnRzLCBwYXJzZVNlbGVjdG9yKCdkYmxjbGljaycsICdzY29wZScpKTtcblxuICAgIGFzc2VydC5lcXVhbChjb21wb25lbnQudHdvLm5hbWUsICd0d28nKTtcbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnR3by50eXBlLCAnbXVsdGknKTtcbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnR3by50b2dnbGUsICdldmVudC5jdHJsS2V5Jyk7XG4gICAgYXNzZXJ0LnNhbWVEZWVwTWVtYmVyczxzZWxlY3Rpb24uUHJvamVjdENvbXBvbmVudD4oY29tcG9uZW50Wyd0d28nXS5wcm9qZWN0LCBbe2ZpZWxkOiAnT3JpZ2luJywgY2hhbm5lbDogJ2NvbG9yJ31dKTtcbiAgICBhc3NlcnQuc2FtZURlZXBNZW1iZXJzKGNvbXBvbmVudFsndHdvJ10uZXZlbnRzLCBwYXJzZVNlbGVjdG9yKCdtb3VzZW92ZXInLCAnc2NvcGUnKSk7XG5cbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnRocmVlLm5hbWUsICd0aHJlZScpO1xuICAgIGFzc2VydC5lcXVhbChjb21wb25lbnQudGhyZWUudHlwZSwgJ2ludGVydmFsJyk7XG4gICAgYXNzZXJ0KCFjb21wb25lbnQudGhyZWUudHJhbnNsYXRlKTtcbiAgICBhc3NlcnQuZXF1YWwoY29tcG9uZW50LnRocmVlLnpvb20sICd3aGVlbFtldmVudC5hbHRLZXldJyk7XG4gICAgYXNzZXJ0LnNhbWVEZWVwTWVtYmVyczxzZWxlY3Rpb24uUHJvamVjdENvbXBvbmVudD4oY29tcG9uZW50Wyd0aHJlZSddLnByb2plY3QsIFt7ZmllbGQ6ICdNaWxlc19wZXJfR2FsbG9uJywgY2hhbm5lbDogJ3knfV0pO1xuICAgIGFzc2VydC5zYW1lRGVlcE1lbWJlcnMoY29tcG9uZW50Wyd0aHJlZSddLmV2ZW50cywgcGFyc2VTZWxlY3RvcignW21vdXNlZG93blshZXZlbnQuc2hpZnRLZXldLCBtb3VzZXVwXSA+IG1vdXNlbW92ZScsICdzY29wZScpKTtcbiAgfSk7XG59KTtcbiJdfQ==