"use strict";
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var compositemark_1 = require("./compositemark");
var index_1 = require("./compositemark/index");
var guide_1 = require("./guide");
var legend_1 = require("./legend");
var mark_1 = require("./mark");
var mark = require("./mark");
var scale_1 = require("./scale");
var selection_1 = require("./selection");
var title_1 = require("./title");
var util_1 = require("./util");
exports.defaultViewConfig = {
    width: 200,
    height: 200
};
exports.defaultConfig = {
    padding: 5,
    timeFormat: '%b %d, %Y',
    countTitle: 'Number of Records',
    invalidValues: 'filter',
    view: exports.defaultViewConfig,
    mark: mark.defaultMarkConfig,
    area: {},
    bar: mark.defaultBarConfig,
    circle: {},
    line: {},
    point: {},
    rect: {},
    rule: { color: 'black' },
    square: {},
    text: { color: 'black' },
    tick: mark.defaultTickConfig,
    box: { size: 14 },
    boxWhisker: {},
    boxMid: { color: 'white' },
    scale: scale_1.defaultScaleConfig,
    axis: {},
    axisX: {},
    axisY: { minExtent: 30 },
    axisLeft: {},
    axisRight: {},
    axisTop: {},
    axisBottom: {},
    axisBand: {},
    legend: legend_1.defaultLegendConfig,
    selection: selection_1.defaultConfig,
    style: {},
    title: {},
};
function initConfig(config) {
    return util_1.mergeDeep(util_1.duplicate(exports.defaultConfig), config);
}
exports.initConfig = initConfig;
var MARK_STYLES = ['view'].concat(mark_1.PRIMITIVE_MARKS, compositemark_1.COMPOSITE_MARK_STYLES);
var VL_ONLY_CONFIG_PROPERTIES = [
    'padding', 'numberFormat', 'timeFormat', 'countTitle',
    'stack', 'scale', 'selection', 'invalidValues',
    'overlay' // FIXME: Redesign and unhide this
];
var VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX = __assign({ view: ['width', 'height'] }, mark_1.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX, index_1.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX);
function stripAndRedirectConfig(config) {
    config = util_1.duplicate(config);
    for (var _i = 0, VL_ONLY_CONFIG_PROPERTIES_1 = VL_ONLY_CONFIG_PROPERTIES; _i < VL_ONLY_CONFIG_PROPERTIES_1.length; _i++) {
        var prop = VL_ONLY_CONFIG_PROPERTIES_1[_i];
        delete config[prop];
    }
    // Remove Vega-Lite only axis/legend config
    if (config.axis) {
        for (var _a = 0, VL_ONLY_GUIDE_CONFIG_1 = guide_1.VL_ONLY_GUIDE_CONFIG; _a < VL_ONLY_GUIDE_CONFIG_1.length; _a++) {
            var prop = VL_ONLY_GUIDE_CONFIG_1[_a];
            delete config.axis[prop];
        }
    }
    if (config.legend) {
        for (var _b = 0, VL_ONLY_GUIDE_CONFIG_2 = guide_1.VL_ONLY_GUIDE_CONFIG; _b < VL_ONLY_GUIDE_CONFIG_2.length; _b++) {
            var prop = VL_ONLY_GUIDE_CONFIG_2[_b];
            delete config.legend[prop];
        }
    }
    // Remove Vega-Lite only generic mark config
    if (config.mark) {
        for (var _c = 0, VL_ONLY_MARK_CONFIG_PROPERTIES_1 = mark_1.VL_ONLY_MARK_CONFIG_PROPERTIES; _c < VL_ONLY_MARK_CONFIG_PROPERTIES_1.length; _c++) {
            var prop = VL_ONLY_MARK_CONFIG_PROPERTIES_1[_c];
            delete config.mark[prop];
        }
    }
    for (var _d = 0, MARK_STYLES_1 = MARK_STYLES; _d < MARK_STYLES_1.length; _d++) {
        var mark_2 = MARK_STYLES_1[_d];
        // Remove Vega-Lite-only mark config
        for (var _e = 0, VL_ONLY_MARK_CONFIG_PROPERTIES_2 = mark_1.VL_ONLY_MARK_CONFIG_PROPERTIES; _e < VL_ONLY_MARK_CONFIG_PROPERTIES_2.length; _e++) {
            var prop = VL_ONLY_MARK_CONFIG_PROPERTIES_2[_e];
            delete config[mark_2][prop];
        }
        // Remove Vega-Lite only mark-specific config
        var vlOnlyMarkSpecificConfigs = VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX[mark_2];
        if (vlOnlyMarkSpecificConfigs) {
            for (var _f = 0, vlOnlyMarkSpecificConfigs_1 = vlOnlyMarkSpecificConfigs; _f < vlOnlyMarkSpecificConfigs_1.length; _f++) {
                var prop = vlOnlyMarkSpecificConfigs_1[_f];
                delete config[mark_2][prop];
            }
        }
        // Redirect mark config to config.style so that mark config only affect its own mark type
        // without affecting other marks that share the same underlying Vega marks.
        // For example, config.rect should not affect bar marks.
        redirectConfig(config, mark_2);
    }
    // Redirect config.title -- so that title config do not
    // affect header labels, which also uses `title` directive to implement.
    redirectConfig(config, 'title', 'group-title');
    // Remove empty config objects
    for (var prop in config) {
        if (util_1.isObject(config[prop]) && util_1.keys(config[prop]).length === 0) {
            delete config[prop];
        }
    }
    return util_1.keys(config).length > 0 ? config : undefined;
}
exports.stripAndRedirectConfig = stripAndRedirectConfig;
function redirectConfig(config, prop, toProp) {
    var propConfig = prop === 'title' ? title_1.extractTitleConfig(config.title).mark : config[prop];
    if (prop === 'view') {
        toProp = 'cell'; // View's default style is "cell"
    }
    var style = __assign({}, propConfig, config.style[prop]);
    // set config.style if it is not an empty object
    if (util_1.keys(style).length > 0) {
        config.style[toProp || prop] = style;
    }
    delete config[prop];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQ0EsaURBQXNEO0FBQ3RELCtDQUEySTtBQUMzSSxpQ0FBNkM7QUFDN0MsbUNBQTJEO0FBQzNELCtCQUE0STtBQUM1SSw2QkFBK0I7QUFDL0IsaUNBQXdEO0FBQ3hELHlDQUFxRjtBQUVyRixpQ0FBMkM7QUFFM0MsK0JBQTREO0FBb0YvQyxRQUFBLGlCQUFpQixHQUFlO0lBQzNDLEtBQUssRUFBRSxHQUFHO0lBQ1YsTUFBTSxFQUFFLEdBQUc7Q0FDWixDQUFDO0FBeUlXLFFBQUEsYUFBYSxHQUFXO0lBQ25DLE9BQU8sRUFBRSxDQUFDO0lBQ1YsVUFBVSxFQUFFLFdBQVc7SUFDdkIsVUFBVSxFQUFFLG1CQUFtQjtJQUUvQixhQUFhLEVBQUUsUUFBUTtJQUV2QixJQUFJLEVBQUUseUJBQWlCO0lBRXZCLElBQUksRUFBRSxJQUFJLENBQUMsaUJBQWlCO0lBQzVCLElBQUksRUFBRSxFQUFFO0lBQ1IsR0FBRyxFQUFFLElBQUksQ0FBQyxnQkFBZ0I7SUFDMUIsTUFBTSxFQUFFLEVBQUU7SUFDVixJQUFJLEVBQUUsRUFBRTtJQUNSLEtBQUssRUFBRSxFQUFFO0lBQ1QsSUFBSSxFQUFFLEVBQUU7SUFDUixJQUFJLEVBQUUsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFDO0lBQ3RCLE1BQU0sRUFBRSxFQUFFO0lBQ1YsSUFBSSxFQUFFLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBQztJQUN0QixJQUFJLEVBQUUsSUFBSSxDQUFDLGlCQUFpQjtJQUU1QixHQUFHLEVBQUUsRUFBQyxJQUFJLEVBQUUsRUFBRSxFQUFDO0lBQ2YsVUFBVSxFQUFFLEVBQUU7SUFDZCxNQUFNLEVBQUUsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFDO0lBRXhCLEtBQUssRUFBRSwwQkFBa0I7SUFDekIsSUFBSSxFQUFFLEVBQUU7SUFDUixL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QUksQ0FBQyxDQUFDO0lBRXpHLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLE1BQU0sR0FBRyxNQUFNLENBQUMsQ0FBQyxpQ0FBaUM7SUFDcEQsQ0FBQztJQUVELElBQU0sS0FBSyxnQkFDTixVQUFVLEVBQ1YsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FDdEIsQ0FBQztJQUNGLGdEQUFnRDtJQUNoRCxFQUFFLENBQUMsQ0FBQyxXQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQ3ZDLENBQUM7SUFDRCxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN0QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtBeGlzQ29uZmlnTWl4aW5zfSBmcm9tICcuL2F4aXMnO1xuaW1wb3J0IHtDT01QT1NJVEVfTUFSS19TVFlMRVN9IGZyb20gJy4vY29tcG9zaXRlbWFyayc7XG5pbXBvcnQge0NvbXBvc2l0ZU1hcmtDb25maWdNaXhpbnMsIENvbXBvc2l0ZU1hcmtTdHlsZSwgVkxfT05MWV9DT01QT1NJVEVfTUFSS19TUEVDSUZJQ19DT05GSUdfUFJPUEVSVFlfSU5ERVh9IGZyb20gJy4vY29tcG9zaXRlbWFyay9pbmRleCc7XG5pbXBvcnQge1ZMX09OTFlfR1VJREVfQ09ORklHfSBmcm9tICcuL2d1aWRlJztcbmltcG9ydCB7ZGVmYXVsdExlZ2VuZENvbmZpZywgTGVnZW5kQ29uZmlnfSBmcm9tICcuL2xlZ2VuZCc7XG5pbXBvcnQge01hcmssIE1hcmtDb25maWdNaXhpbnMsIFBSSU1JVElWRV9NQVJLUywgVkxfT05MWV9NQVJLX0NPTkZJR19QUk9QRVJUSUVTLCBWTF9PTkxZX01BUktfU1BFQ0lGSUNfQ09ORklHX1BST1BFUlRZX0lOREVYfSBmcm9tICcuL21hcmsnO1xuaW1wb3J0ICogYXMgbWFyayBmcm9tICcuL21hcmsnO1xuaW1wb3J0IHtkZWZhdWx0U2NhbGVDb25maWcsIFNjYWxlQ29uZmlnfSBmcm9tICcuL3NjYWxlJztcbmltcG9ydCB7ZGVmYXVsdENvbmZpZyBhcyBkZWZhdWx0U2VsZWN0aW9uQ29uZmlnLCBTZWxlY3Rpb25Db25maWd9IGZyb20gJy4vc2VsZWN0aW9uJztcbmltcG9ydCB7U3RhY2tPZmZzZXR9IGZyb20gJy4vc3RhY2snO1xuaW1wb3J0IHtleHRyYWN0VGl0bGVDb25maWd9IGZyb20gJy4vdGl0bGUnO1xuaW1wb3J0IHtUb3BMZXZlbFByb3BlcnRpZXN9IGZyb20gJy4vdG9wbGV2ZWxwcm9wcyc7XG5pbXBvcnQge2R1cGxpY2F0ZSwgaXNPYmplY3QsIGtleXMsIG1lcmdlRGVlcH0gZnJvbSAnLi91dGlsJztcbmltcG9ydCB7VmdNYXJrQ29uZmlnLCBWZ1NjaGVtZSwgVmdUaXRsZUNvbmZpZ30gZnJvbSAnLi92ZWdhLnNjaGVtYSc7XG5cblxuZXhwb3J0IGludGVyZmFjZSBWaWV3Q29uZmlnIHtcbiAgLyoqXG4gICAqIFRoZSBkZWZhdWx0IHdpZHRoIG9mIHRoZSBzaW5nbGUgcGxvdCBvciBlYWNoIHBsb3QgaW4gYSB0cmVsbGlzIHBsb3Qgd2hlbiB0aGUgdmlzdWFsaXphdGlvbiBoYXMgYSBjb250aW51b3VzIChub24tb3JkaW5hbCkgeC1zY2FsZSBvciBvcmRpbmFsIHgtc2NhbGUgd2l0aCBgcmFuZ2VTdGVwYCA9IGBudWxsYC5cbiAgICpcbiAgICogX19EZWZhdWx0IHZhbHVlOl9fIGAyMDBgXG4gICAqXG4gICAqL1xuICB3aWR0aD86IG51bWJlcjtcblxuICAvKipcbiAgICogVGhlIGRlZmF1bHQgaGVpZ2h0IG9mIHRoZSBzaW5nbGUgcGxvdCBvciBlYWNoIHBsb3QgaW4gYSB0cmVsbGlzIHBsb3Qgd2hlbiB0aGUgdmlzdWFsaXphdGlvbiBoYXMgYSBjb250aW51b3VzIChub24tb3JkaW5hbCkgeS1zY2FsZSB3aXRoIGByYW5nZVN0ZXBgID0gYG51bGxgLlxuICAgKlxuICAgKiBfX0RlZmF1bHQgdmFsdWU6X18gYDIwMGBcbiAgICpcbiAgICovXG4gIGhlaWdodD86IG51bWJlcjtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgdmlldyBzaG91bGQgYmUgY2xpcHBlZC5cbiAgICovXG4gIGNsaXA/OiBib29sZWFuO1xuXG4gIC8vIEZJTExfU1RST0tFX0NPTkZJR1xuICAvKipcbiAgICogVGhlIGZpbGwgY29sb3IuXG4gICAqXG4gICAqIF9fRGVmYXVsdCB2YWx1ZTpfXyAobm9uZSlcbiAgICpcbiAgICovXG4gIGZpbGw/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWxsIG9wYWNpdHkgKHZhbHVlIGJldHdlZW4gWzAsMV0pLlxuICAgKlxuICAgKiBfX0RlZmF1bHQgdmFsdWU6X18gKG5vbmUpXG4gICAqXG4gICAqL1xuICBmaWxsT3BhY2l0eT86IG51bWJlcjtcblxuICAvKipcbiAgICogVGhlIHN0cm9rZSBjb2xvci5cbiAgICpcbiAgICogX19EZWZhdWx0IHZhbHVlOl9fIChub25lKVxuICAgKlxuICAgKi9cbiAgc3Ryb2tlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgc3Ryb2tlIG9wYWNpdHkgKHZhbHVlIGJldHdlZW4gWzAsMV0pLlxuICAgKlxuICAgKiBfX0RlZmF1bHQgdmFsdWU6X18gKG5vbmUpXG4gICAqXG4gICAqL1xuICBzdHJva2VPcGFjaXR5PzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgc3Ryb2tlIHdpZHRoLCBpbiBwaXhlbHMuXG4gICAqXG4gICAqIF9fRGVmYXVsdCB2YWx1ZTpfXyAobm9uZSlcbiAgICpcbiAgICovXG4gIHN0cm9rZVdpZHRoPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBBbiBhcnJheSBvZiBhbHRlcm5hdGluZyBzdHJva2UsIHNwYWNlIGxlbmd0aHMgZm9yIGNyZWF0aW5nIGRhc2hlZCBvciBkb3R0ZWQgbGluZXMuXG4gICAqXG4gICAqIF9fRGVmYXVsdCB2YWx1ZTpfXyAobm9uZSlcbiAgICpcbiAgICovXG4gIHN0cm9rZURhc2g/OiBudW1iZXJbXTtcblxuICAvKipcbiAgICogVGhlIG9mZnNldCAoaW4gcGl4ZWxzKSBpbnRvIHdoaWNoIHRvIGJlZ2luIGRyYXdpbmcgd2l0aCB0aGUgc3Ryb2tlIGRhc2ggYXJyYXkuXG4gICAqXG4gICAqIF9fRGVmYXVsdCB2YWx1ZTpfXyAobm9uZSlcbiAgICpcbiAgICovXG4gIHN0cm9rZURhc2hPZmZzZXQ/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0Vmlld0NvbmZpZzogVmlld0NvbmZpZyA9IHtcbiAgd2lkdGg6IDIwMCxcbiAgaGVpZ2h0OiAyMDBcbn07XG5cbmV4cG9ydCB0eXBlIFJhbmdlQ29uZmlnVmFsdWUgPSAobnVtYmVyfHN0cmluZylbXSB8IFZnU2NoZW1lIHwge3N0ZXA6IG51bWJlcn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmFuZ2VDb25maWcge1xuICAvKipcbiAgICogRGVmYXVsdCByYW5nZSBmb3IgX25vbWluYWxfIChjYXRlZ29yaWNhbCkgZmllbGRzLlxuICAgKi9cbiAgY2F0ZWdvcnk/OiBzdHJpbmdbXSB8IFZnU2NoZW1lO1xuXG4gIC8qKlxuICAgKiBEZWZhdWx0IHJhbmdlIGZvciBkaXZlcmdpbmcgX3F1YW50aXRhdGl2ZV8gZmllbGRzLlxuICAgKi9cbiAgZGl2ZXJnaW5nPzogc3RyaW5nW10gfCBWZ1NjaGVtZTtcblxuICAvKipcbiAgICogRGVmYXVsdCByYW5nZSBmb3IgX3F1YW50aXRhdGl2ZV8gaGVhdG1hcHMuXG4gICAqL1xuICBoZWF0bWFwPzogc3RyaW5nW10gfCBWZ1NjaGVtZTtcblxuICAvKipcbiAgICogRGVmYXVsdCByYW5nZSBmb3IgX29yZGluYWxfIGZpZWxkcy5cbiAgICovXG4gIG9yZGluYWw/OiBzdHJpbmdbXSB8IFZnU2NoZW1lO1xuXG4gIC8qKlxuICAgKiBEZWZhdWx0IHJhbmdlIGZvciBfcXVhbnRpdGF0aXZlXyBhbmQgX3RlbXBvcmFsXyBmaWVsZHMuXG4gICAqL1xuICByYW1wPzogc3RyaW5nW10gfCBWZ1NjaGVtZTtcblxuICAvKipcbiAgICogRGVmYXVsdCByYW5nZSBwYWxldHRlIGZvciB0aGUgYHNoYXBlYCBjaGFubmVsLlxuICAgKi9cbiAgc3ltYm9sPzogc3RyaW5nW107XG5cbiAgW25hbWU6IHN0cmluZ106IFJhbmdlQ29uZmlnVmFsdWU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVkxPbmx5Q29uZmlnIHtcbiAgLyoqXG4gICAqIERlZmF1bHQgYXhpcyBhbmQgbGVnZW5kIHRpdGxlIGZvciBjb3VudCBmaWVsZHMuXG4gICAqXG4gICAqIF9fRGVmYXVsdCB2YWx1ZTpfXyBgJ051bWJlciBvZiBSZWNvcmRzJ2AuXG4gICAqXG4gICAqIEB0eXBlIHtzdHJpbmd9XG4gICAqL1xuICBjb3VudFRpdGxlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBEZWZpbmVzIGhvdyBWZWdhLUxpdGUgc2hvdWxkIGhhbmRsZSBpbnZhbGlkIHZhbHVlcyAoYG51bGxgIGFuZCBgTmFOYCkuXG4gICAqIC0gSWYgc2V0IHRvIGBcImZpbHRlclwiYCAoZGVmYXVsdCksIGFsbCBkYXRhIGl0ZW1zIHdpdGggbnVsbCB2YWx1ZXMgYXJlIGZpbHRlcmVkLlxuICAgKiAtIElmIGBudWxsYCwgYWxsIGRhdGEgaXRlbXMgYXJlIGluY2x1ZGVkLiBJbiB0aGlzIGNhc2UsIGludmFsaWQgdmFsdWVzIHdpbGwgYmUgaW50ZXJwcmV0ZWQgYXMgemVyb2VzLlxuICAgKi9cbiAgaW52YWxpZFZhbHVlcz86ICdmaWx0ZXInIHwgbnVsbDtcblxuICAvKipcbiAgICogRGVmaW5lcyBob3cgVmVnYS1MaXRlIGdlbmVyYXRlcyB0aXRsZSBmb3IgZmllbGRzLiAgVGhlcmUgYXJlIHRocmVlIHBvc3NpYmxlIHN0eWxlczpcbiAgICogLSBgXCJ2ZXJiYWxcImAgKERlZmF1bHQpIC0gZGlzcGxheXMgZnVuY3Rpb24gaW4gYSB2ZXJiYWwgc3R5bGUgKGUuZy4sIFwiU3VtIG9mIGZpZWxkXCIsIFwiWWVhci1tb250aCBvZiBkYXRlXCIsIFwiZmllbGQgKGJpbm5lZClcIikuXG4gICAqIC0gYFwiZnVuY3Rpb25cImAgLSBkaXNwbGF5cyBmdW5jdGlvbiB1c2luZyBwYXJlbnRoZXNlcyBhbmQgY2FwaXRhbGl6ZWQgdGV4dHMgKGUuZy4sIFwiU1VNKGZpZWxkKVwiLCBcIllFQVJNT05USChkYXRlKVwiLCBcIkJJTihmaWVsZClcIikuXG4gICAqIC0gYFwicGxhaW5cImAgLSBkaXNwbGF5cyBvbmx5IHRoZSBmaWVsZCBuYW1lIHdpdGhvdXQgZnVuY3Rpb25zIChlLmcuLCBcImZpZWxkXCIsIFwiZGF0ZVwiLCBcImZpZWxkXCIpLlxuICAgKi9cbiAgZmllbGRUaXRsZT86ICd2ZXJiYWwnIHwgJ2Z1bmN0aW9uYWwnIHwgJ3BsYWluJztcblxuICAvKipcbiAgICogRDMgTnVtYmVyIGZvcm1hdCBmb3IgYXhpcyBsYWJlbHMgYW5kIHRleHQgdGFibGVzLiBGb3IgZXhhbXBsZSBcInNcIiBmb3IgU0kgdW5pdHMuIFVzZSBbRDMncyBudW1iZXIgZm9ybWF0IHBhdHRlcm5dKGh0dHBzOi8vZ2l0aHViLmNvbS9kMy9kMy1mb3JtYXQjbG9jYWxlX2Zvcm1hdCkuXG4gICAqL1xuICBudW1iZXJGb3JtYXQ/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIERlZmF1bHQgZGF0ZXRpbWUgZm9ybWF0IGZvciBheGlzIGFuZCBsZWdlbmQgbGFiZWxzLiBUaGUgZm9ybWF0IGNhbiBiZSBzZXQgZGlyZWN0bHkgb24gZWFjaCBheGlzIGFuZCBsZWdlbmQuIFVzZSBbRDMncyB0aW1lIGZvcm1hdCBwYXR0ZXJuXShodHRwczovL2dpdGh1Yi5jb20vZDMvZDMtdGltZS1mb3JtYXQjbG9jYWxlX2Zvcm1hdCkuXG4gICAqXG4gICAqIF9fRGVmYXVsdCB2YWx1ZTpfXyBgJyViICVkLCAlWSdgLlxuICAgKlxuICAgKi9cbiAgdGltZUZvcm1hdD86IHN0cmluZztcblxuXG4gIC8qKiBEZWZhdWx0IHByb3BlcnRpZXMgZm9yIFtzaW5nbGUgdmlldyBwbG90c10oc3BlYy5odG1sI3NpbmdsZSkuICovXG4gIHZpZXc/OiBWaWV3Q29uZmlnO1xuXG4gIC8qKlxuICAgKiBTY2FsZSBjb25maWd1cmF0aW9uIGRldGVybWluZXMgZGVmYXVsdCBwcm9wZXJ0aWVzIGZvciBhbGwgW3NjYWxlc10oc2NhbGUuaHRtbCkuIEZvciBhIGZ1bGwgbGlzdCBvZiBzY2FsZSBjb25maWd1cmF0aW9uIG9wdGlvbnMsIHBsZWFzZSBzZWUgdGhlIFtjb3JyZXNwb25kaW5nIHNlY3Rpb24gb2YgdGhlIHNjYWxlIGRvY3VtZW50YXRpb25dKHNjYWxlLmh0bWwjY29uZmlnKS5cbiAgICovXG4gIHNjYWxlPzogU2NhbGVDb25maWc7XG5cbiAgLyoqIEFuIG9iamVjdCBoYXNoIGZvciBkZWZpbmluZyBkZWZhdWx0IHByb3BlcnRpZXMgZm9yIGVhY2ggdHlwZSBvZiBzZWxlY3Rpb25zLiAqL1xuICBzZWxlY3Rpb24/OiBTZWxlY3Rpb25Db25maWc7XG5cbiAgLyoqIERlZmF1bHQgc3RhY2sgb2Zmc2V0IGZvciBzdGFja2FibGUgbWFyay4gKi9cbiAgc3RhY2s/OiBTdGFja09mZnNldDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdHlsZUNvbmZpZ0luZGV4IHtcbiAgW3N0eWxlOiBzdHJpbmddOiBWZ01hcmtDb25maWc7XG59XG5cbmV4cG9ydCB0eXBlIEFyZWFPdmVybGF5ID0gJ2xpbmUnIHwgJ2xpbmVwb2ludCcgfCAnbm9uZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3ZlcmxheUNvbmZpZyB7XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIG92ZXJsYXkgbGluZSB3aXRoIHBvaW50LlxuICAgKi9cbiAgbGluZT86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFR5cGUgb2Ygb3ZlcmxheSBmb3IgYXJlYSBtYXJrIChsaW5lIG9yIGxpbmVwb2ludClcbiAgICovXG4gIGFyZWE/OiBBcmVhT3ZlcmxheTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb25maWcgZXh0ZW5kcyBUb3BMZXZlbFByb3BlcnRpZXMsIFZMT25seUNvbmZpZywgTWFya0NvbmZpZ01peGlucywgQ29tcG9zaXRlTWFya0NvbmZpZ01peGlucywgQXhpc0NvbmZpZ01peGlucyB7XG5cbiAgLyoqXG4gICAqIEFuIG9iamVjdCBoYXNoIHRoYXQgZGVmaW5lcyBkZWZhdWx0IHJhbmdlIGFycmF5cyBvciBzY2hlbWVzIGZvciB1c2luZyB3aXRoIHNjYWxlcy5cbiAgICogRm9yIGEgZnVsbCBsaXN0IG9mIHNjYWxlIHJhbmdlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucywgcGxlYXNlIHNlZSB0aGUgW2NvcnJlc3BvbmRpbmcgc2VjdGlvbiBvZiB0aGUgc2NhbGUgZG9jdW1lbnRhdGlvbl0oc2NhbGUuaHRtbCNjb25maWcpLlxuICAgKi9cbiAgcmFuZ2U/OiBSYW5nZUNvbmZpZztcblxuICAvKipcbiAgICogTGVnZW5kIGNvbmZpZ3VyYXRpb24sIHdoaWNoIGRldGVybWluZXMgZGVmYXVsdCBwcm9wZXJ0aWVzIGZvciBhbGwgW2xlZ2VuZHNdKGxlZ2VuZC5odG1sKS4gRm9yIGEgZnVsbCBsaXN0IG9mIGxlZ2VuZCBjb25maWd1cmF0aW9uIG9wdGlvbnMsIHBsZWFzZSBzZWUgdGhlIFtjb3JyZXNwb25kaW5nIHNlY3Rpb24gb2YgaW4gdGhlIGxlZ2VuZCBkb2N1bWVudGF0aW9uXShsZWdlbmQuaHRtbCNjb25maWcpLlxuICAgKi9cbiAgbGVnZW5kPzogTGVnZW5kQ29uZmlnO1xuXG4gIC8qKlxuICAgKiBUaXRsZSBjb25maWd1cmF0aW9uLCB3aGljaCBkZXRlcm1pbmVzIGRlZmF1bHQgcHJvcGVydGllcyBmb3IgYWxsIFt0aXRsZXNdKHRpdGxlLmh0bWwpLiBGb3IgYSBmdWxsIGxpc3Qgb2YgdGl0bGUgY29uZmlndXJhdGlvbiBvcHRpb25zLCBwbGVhc2Ugc2VlIHRoZSBbY29ycmVzcG9uZGluZyBzZWN0aW9uIG9mIHRoZSB0aXRsZSBkb2N1bWVudGF0aW9uXSh0aXRsZS5odG1sI2NvbmZpZykuXG4gICAqL1xuICB0aXRsZT86IFZnVGl0bGVDb25maWc7XG5cbiAgLyoqIEFuIG9iamVjdCBoYXNoIHRoYXQgZGVmaW5lcyBrZXktdmFsdWUgbWFwcGluZ3MgdG8gZGV0ZXJtaW5lIGRlZmF1bHQgcHJvcGVydGllcyBmb3IgbWFya3Mgd2l0aCBhIGdpdmVuIFtzdHlsZV0obWFyay5odG1sI21hcmstZGVmKS4gIFRoZSBrZXlzIHJlcHJlc2VudCBzdHlsZXMgbmFtZXM7IHRoZSB2YWx1ZSBhcmUgdmFsaWQgW21hcmsgY29uZmlndXJhdGlvbiBvYmplY3RzXShtYXJrLmh0bWwjY29uZmlnKS4gICovXG4gIHN0eWxlPzogU3R5bGVDb25maWdJbmRleDtcblxuICAvKipcbiAgICogQGhpZGVcbiAgICovXG4gIG92ZXJsYXk/OiBPdmVybGF5Q29uZmlnO1xufVxuXG5leHBvcnQgY29uc3QgZGVmYXVsdENvbmZpZzogQ29uZmlnID0ge1xuICBwYWRkaW5nOiA1LFxuICB0aW1lRm9ybWF0OiAnJWIgJWQsICVZJyxcbiAgY291bnRUaXRsZTogJ051bWJlciBvZiBSZWNvcmRzJyxcblxuICBpbnZhbGlkVmFsdWVzOiAnZmlsdGVyJyxcblxuICB2aWV3OiBkZWZhdWx0Vmlld0NvbmZpZyxcblxuICBtYXJrOiBtYXJrLmRlZmF1bHRNYXJrQ29uZmlnLFxuICBhcmVhOiB7fSxcbiAgYmFyOiBtYXJrLmRlZmF1bHRCYXJDb25maWcsXG4gIGNpcmNsZToge30sXG4gIGxpbmU6IHt9LFxuICBwb2ludDoge30sXG4gIHJlY3Q6IHt9LFxuICBydWxlOiB7Y29sb3I6ICdibGFjayd9LCAvLyBOZWVkIHRoaXMgdG8gb3ZlcnJpZGUgZGVmYXVsdCBjb2xvciBpbiBtYXJrIGNvbmZpZ1xuICBzcXVhcmU6IHt9LFxuICB0ZXh0OiB7Y29sb3I6ICdibGFjayd9LCAvLyBOZWVkIHRoaXMgdG8gb3ZlcnJpZGUgZGVmYXVsdCBjb2xvciBpbiBtYXJrIGNvbmZpZ1xuICB0aWNrOiBtYXJrLmRlZmF1bHRUaWNrQ29uZmlnLFxuXG4gIGJveDoge3NpemU6IDE0fSxcbiAgYm94V2hpc2tlcjoge30sXG4gIGJveE1pZDoge2NvbG9yOiAnd2hpdGUnfSxcblxuICBzY2FsZTogZGVmYXVsdFNjYWxlQ29uZmlnLFxuICBheGlzOiB7fSxcbiAgYXhpc1g6IHt9LFxuICBheGlzWToge21pbkV4dGVudDogMzB9LFxuICBheGlzTGVmdDoge30sXG4gIGF4aXNSaWdodDoge30sXG4gIGF4aXNUb3A6IHt9LFxuICBheGlzQm90dG9tOiB7fSxcbiAgYXhpc0JhbmQ6IHt9LFxuICBsZWdlbmQ6IGRlZmF1bHRMZWdlbmRDb25maWcsXG5cbiAgc2VsZWN0aW9uOiBkZWZhdWx0U2VsZWN0aW9uQ29uZmlnLFxuICBzdHlsZToge30sXG5cbiAgdGl0bGU6IHt9LFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGluaXRDb25maWcoY29uZmlnOiBDb25maWcpIHtcbiAgcmV0dXJuIG1lcmdlRGVlcChkdXBsaWNhdGUoZGVmYXVsdENvbmZpZyksIGNvbmZpZyk7XG59XG5cbmNvbnN0IE1BUktfU1RZTEVTID0gWyd2aWV3J10uY29uY2F0KFBSSU1JVElWRV9NQVJLUywgQ09NUE9TSVRFX01BUktfU1RZTEVTKSBhcyAoJ3ZpZXcnIHwgTWFyayB8IENvbXBvc2l0ZU1hcmtTdHlsZSlbXTtcblxuXG5jb25zdCBWTF9PTkxZX0NPTkZJR19QUk9QRVJUSUVTOiAoa2V5b2YgQ29uZmlnKVtdID0gW1xuICAncGFkZGluZycsICdudW1iZXJGb3JtYXQnLCAndGltZUZvcm1hdCcsICdjb3VudFRpdGxlJyxcbiAgJ3N0YWNrJywgJ3NjYWxlJywgJ3NlbGVjdGlvbicsICdpbnZhbGlkVmFsdWVzJyxcbiAgJ292ZXJsYXknIGFzIGtleW9mIENvbmZpZyAvLyBGSVhNRTogUmVkZXNpZ24gYW5kIHVuaGlkZSB0aGlzXG5dO1xuXG5jb25zdCBWTF9PTkxZX0FMTF9NQVJLX1NQRUNJRklDX0NPTkZJR19QUk9QRVJUWV9JTkRFWCA9IHtcbiAgdmlldzogWyd3aWR0aCcsICdoZWlnaHQnXSxcbiAgLi4uVkxfT05MWV9NQVJLX1NQRUNJRklDX0NPTkZJR19QUk9QRVJUWV9JTkRFWCxcbiAgLi4uVkxfT05MWV9DT01QT1NJVEVfTUFSS19TUEVDSUZJQ19DT05GSUdfUFJPUEVSVFlfSU5ERVhcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBzdHJpcEFuZFJlZGlyZWN0Q29uZmlnKGNvbmZpZzogQ29uZmlnKSB7XG4gIGNvbmZpZyA9IGR1cGxpY2F0ZShjb25maWcpO1xuXG4gIGZvciAoY29uc3QgcHJvcCBvZiBWTF9PTkxZX0NPTkZJR19QUk9QRVJUSUVTKSB7XG4gICAgZGVsZXRlIGNvbmZpZ1twcm9wXTtcbiAgfVxuXG4gIC8vIFJlbW92ZSBWZWdhLUxpdGUgb25seSBheGlzL2xlZ2VuZCBjb25maWdcbiAgaWYgKGNvbmZpZy5heGlzKSB7XG4gICAgZm9yIChjb25zdCBwcm9wIG9mIFZMX09OTFlfR1VJREVfQ09ORklHKSB7XG4gICAgICBkZWxldGUgY29uZmlnLmF4aXNbcHJvcF07XG4gICAgfVxuICB9XG4gIGlmIChjb25maWcubGVnZW5kKSB7XG4gICAgZm9yIChjb25zdCBwcm9wIG9mIFZMX09OTFlfR1VJREVfQ09ORklHKSB7XG4gICAgICBkZWxldGUgY29uZmlnLmxlZ2VuZFtwcm9wXTtcbiAgICB9XG4gIH1cblxuICAvLyBSZW1vdmUgVmVnYS1MaXRlIG9ubHkgZ2VuZXJpYyBtYXJrIGNvbmZpZ1xuICBpZiAoY29uZmlnLm1hcmspIHtcbiAgICBmb3IgKGNvbnN0IHByb3Agb2YgVkxfT05MWV9NQVJLX0NPTkZJR19QUk9QRVJUSUVTKSB7XG4gICAgICBkZWxldGUgY29uZmlnLm1hcmtbcHJvcF07XG4gICAgfVxuICB9XG5cbiAgZm9yIChjb25zdCBtYXJrIG9mIE1BUktfU1RZTEVTKSB7XG4gICAgLy8gUmVtb3ZlIFZlZ2EtTGl0ZS1vbmx5IG1hcmsgY29uZmlnXG4gICAgZm9yIChjb25zdCBwcm9wIG9mIFZMX09OTFlfTUFSS19DT05GSUdfUFJPUEVSVElFUykge1xuICAgICAgZGVsZXRlIGNvbmZpZ1ttYXJrXVtwcm9wXTtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgVmVnYS1MaXRlIG9ubHkgbWFyay1zcGVjaWZpYyBjb25maWdcbiAgICBjb25zdCB2bE9ubHlNYXJrU3BlY2lmaWNDb25maWdzID0gVkxfT05MWV9BTExfTUFSS19TUEVDSUZJQ19DT05GSUdfUFJPUEVSVFlfSU5ERVhbbWFya107XG4gICAgaWYgKHZsT25seU1hcmtTcGVjaWZpY0NvbmZpZ3MpIHtcbiAgICAgIGZvciAoY29uc3QgcHJvcCBvZiB2bE9ubHlNYXJrU3BlY2lmaWNDb25maWdzKSB7XG4gICAgICAgIGRlbGV0ZSBjb25maWdbbWFya11bcHJvcF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmVkaXJlY3QgbWFyayBjb25maWcgdG8gY29uZmlnLnN0eWxlIHNvIHRoYXQgbWFyayBjb25maWcgb25seSBhZmZlY3QgaXRzIG93biBtYXJrIHR5cGVcbiAgICAvLyB3aXRob3V0IGFmZmVjdGluZyBvdGhlciBtYXJrcyB0aGF0IHNoYXJlIHRoZSBzYW1lIHVuZGVybHlpbmcgVmVnYSBtYXJrcy5cbiAgICAvLyBGb3IgZXhhbXBsZSwgY29uZmlnLnJlY3Qgc2hvdWxkIG5vdCBhZmZlY3QgYmFyIG1hcmtzLlxuICAgIHJlZGlyZWN0Q29uZmlnKGNvbmZpZywgbWFyayk7XG4gIH1cblxuICAvLyBSZWRpcmVjdCBjb25maWcudGl0bGUgLS0gc28gdGhhdCB0aXRsZSBjb25maWcgZG8gbm90XG4gIC8vIGFmZmVjdCBoZWFkZXIgbGFiZWxzLCB3aGljaCBhbHNvIHVzZXMgYHRpdGxlYCBkaXJlY3RpdmUgdG8gaW1wbGVtZW50LlxuICByZWRpcmVjdENvbmZpZyhjb25maWcsICd0aXRsZScsICdncm91cC10aXRsZScpO1xuXG4gIC8vIFJlbW92ZSBlbXB0eSBjb25maWcgb2JqZWN0c1xuICBmb3IgKGNvbnN0IHByb3AgaW4gY29uZmlnKSB7XG4gICAgaWYgKGlzT2JqZWN0KGNvbmZpZ1twcm9wXSkgJiYga2V5cyhjb25maWdbcHJvcF0pLmxlbmd0aCA9PT0gMCkge1xuICAgICAgZGVsZXRlIGNvbmZpZ1twcm9wXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ga2V5cyhjb25maWcpLmxlbmd0aCA+IDAgPyBjb25maWcgOiB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIHJlZGlyZWN0Q29uZmlnKGNvbmZpZzogQ29uZmlnLCBwcm9wOiBNYXJrIHwgQ29tcG9zaXRlTWFya1N0eWxlIHwgJ3RpdGxlJyB8ICd2aWV3JywgdG9Qcm9wPzogc3RyaW5nKSB7XG4gIGNvbnN0IHByb3BDb25maWc6IFZnTWFya0NvbmZpZyA9IHByb3AgPT09ICd0aXRsZScgPyBleHRyYWN0VGl0bGVDb25maWcoY29uZmlnLnRpdGxlKS5tYXJrIDogY29uZmlnW3Byb3BdO1xuXG4gIGlmIChwcm9wID09PSAndmlldycpIHtcbiAgICB0b1Byb3AgPSAnY2VsbCc7IC8vIFZpZXcncyBkZWZhdWx0IHN0eWxlIGlzIFwiY2VsbFwiXG4gIH1cblxuICBjb25zdCBzdHlsZTogVmdNYXJrQ29uZmlnID0ge1xuICAgIC4uLnByb3BDb25maWcsXG4gICAgLi4uY29uZmlnLnN0eWxlW3Byb3BdXG4gIH07XG4gIC8vIHNldCBjb25maWcuc3R5bGUgaWYgaXQgaXMgbm90IGFuIGVtcHR5IG9iamVjdFxuICBpZiAoa2V5cyhzdHlsZSkubGVuZ3RoID4gMCkge1xuICAgIGNvbmZpZy5zdHlsZVt0b1Byb3AgfHwgcHJvcF0gPSBzdHlsZTtcbiAgfVxuICBkZWxldGUgY29uZmlnW3Byb3BdO1xufVxuIl19