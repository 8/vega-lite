import * as tslib_1 from "tslib";
import { isObject } from 'vega-util';
import { COLUMN, ROW, X, X2, Y, Y2 } from './channel';
import * as compositeMark from './compositemark';
import { channelHasField, isRanged } from './encoding';
import * as vlEncoding from './encoding';
import * as log from './log';
import { isMarkDef, isPathMark, isPrimitiveMark } from './mark';
import { stack } from './stack';
import { duplicate, hash, keys, vals } from './util';
/* Custom type guards */
export function isFacetSpec(spec) {
    return spec['facet'] !== undefined;
}
export function isUnitSpec(spec) {
    return !!spec['mark'];
}
export function isLayerSpec(spec) {
    return spec['layer'] !== undefined;
}
export function isRepeatSpec(spec) {
    return spec['repeat'] !== undefined;
}
export function isConcatSpec(spec) {
    return isVConcatSpec(spec) || isHConcatSpec(spec);
}
export function isVConcatSpec(spec) {
    return spec['vconcat'] !== undefined;
}
export function isHConcatSpec(spec) {
    return spec['hconcat'] !== undefined;
}
/**
 * Decompose extended unit specs into composition of pure unit specs.
 */
// TODO: consider moving this to another file.  Maybe vl.spec.normalize or vl.normalize
export function normalize(spec, config) {
    if (isFacetSpec(spec)) {
        return normalizeFacet(spec, config);
    }
    if (isLayerSpec(spec)) {
        return normalizeLayer(spec, config);
    }
    if (isRepeatSpec(spec)) {
        return normalizeRepeat(spec, config);
    }
    if (isVConcatSpec(spec)) {
        return normalizeVConcat(spec, config);
    }
    if (isHConcatSpec(spec)) {
        return normalizeHConcat(spec, config);
    }
    if (isUnitSpec(spec)) {
        var hasRow = channelHasField(spec.encoding, ROW);
        var hasColumn = channelHasField(spec.encoding, COLUMN);
        if (hasRow || hasColumn) {
            return normalizeFacetedUnit(spec, config);
        }
        return normalizeNonFacetUnit(spec, config);
    }
    throw new Error(log.message.INVALID_SPEC);
}
function normalizeFacet(spec, config) {
    var subspec = spec.spec, rest = tslib_1.__rest(spec, ["spec"]);
    return tslib_1.__assign({}, rest, { 
        // TODO: remove "any" once we support all facet listed in https://github.com/vega/vega-lite/issues/2760
        spec: normalize(subspec, config) });
}
function mergeEncoding(opt) {
    var parentEncoding = opt.parentEncoding, encoding = opt.encoding;
    if (parentEncoding && encoding) {
        var overriden = keys(parentEncoding).reduce(function (o, key) {
            if (encoding[key]) {
                o.push(key);
            }
            return o;
        }, []);
        if (overriden.length > 0) {
            log.warn(log.message.encodingOverridden(overriden));
        }
    }
    var merged = tslib_1.__assign({}, (parentEncoding || {}), (encoding || {}));
    return keys(merged).length > 0 ? merged : undefined;
}
function mergeProjection(opt) {
    var parentProjection = opt.parentProjection, projection = opt.projection;
    if (parentProjection && projection) {
        log.warn(log.message.projectionOverridden({ parentProjection: parentProjection, projection: projection }));
    }
    return projection || parentProjection;
}
function normalizeLayer(spec, config, parentEncoding, parentProjection) {
    var layer = spec.layer, encoding = spec.encoding, projection = spec.projection, rest = tslib_1.__rest(spec, ["layer", "encoding", "projection"]);
    var mergedEncoding = mergeEncoding({ parentEncoding: parentEncoding, encoding: encoding });
    var mergedProjection = mergeProjection({ parentProjection: parentProjection, projection: projection });
    return tslib_1.__assign({}, rest, { layer: layer.map(function (subspec) {
            if (isLayerSpec(subspec)) {
                return normalizeLayer(subspec, config, mergedEncoding, mergedProjection);
            }
            return normalizeNonFacetUnit(subspec, config, mergedEncoding, mergedProjection);
        }) });
}
function normalizeRepeat(spec, config) {
    var subspec = spec.spec, rest = tslib_1.__rest(spec, ["spec"]);
    return tslib_1.__assign({}, rest, { spec: normalize(subspec, config) });
}
function normalizeVConcat(spec, config) {
    var vconcat = spec.vconcat, rest = tslib_1.__rest(spec, ["vconcat"]);
    return tslib_1.__assign({}, rest, { vconcat: vconcat.map(function (subspec) { return normalize(subspec, config); }) });
}
function normalizeHConcat(spec, config) {
    var hconcat = spec.hconcat, rest = tslib_1.__rest(spec, ["hconcat"]);
    return tslib_1.__assign({}, rest, { hconcat: hconcat.map(function (subspec) { return normalize(subspec, config); }) });
}
function normalizeFacetedUnit(spec, config) {
    // New encoding in the inside spec should not contain row / column
    // as row/column should be moved to facet
    var _a = spec.encoding, row = _a.row, column = _a.column, encoding = tslib_1.__rest(_a, ["row", "column"]);
    // Mark and encoding should be moved into the inner spec
    var mark = spec.mark, width = spec.width, projection = spec.projection, height = spec.height, selection = spec.selection, _ = spec.encoding, outerSpec = tslib_1.__rest(spec, ["mark", "width", "projection", "height", "selection", "encoding"]);
    return tslib_1.__assign({}, outerSpec, { facet: tslib_1.__assign({}, (row ? { row: row } : {}), (column ? { column: column } : {})), spec: normalizeNonFacetUnit(tslib_1.__assign({}, (projection ? { projection: projection } : {}), { mark: mark }, (width ? { width: width } : {}), (height ? { height: height } : {}), { encoding: encoding }, (selection ? { selection: selection } : {})), config) });
}
function isNonFacetUnitSpecWithPrimitiveMark(spec) {
    return isPrimitiveMark(spec.mark);
}
function getPointOverlay(markDef, markConfig, encoding) {
    if (markDef.point === 'transparent') {
        return { opacity: 0 };
    }
    else if (markDef.point) { // truthy : true or object
        return isObject(markDef.point) ? markDef.point : {};
    }
    else if (markDef.point !== undefined) { // false or null
        return null;
    }
    else { // undefined (not disabled)
        if (markConfig.point || encoding.shape) {
            // enable point overlay if config[mark].point is truthy or if encoding.shape is provided
            return isObject(markConfig.point) ? markConfig.point : {};
        }
        // markDef.point is defined as falsy
        return null;
    }
}
function getLineOverlay(markDef, markConfig) {
    if (markDef.line) { // true or object
        return markDef.line === true ? {} : markDef.line;
    }
    else if (markDef.line !== undefined) { // false or null
        return null;
    }
    else { // undefined (not disabled)
        if (markConfig.line) {
            // enable line overlay if config[mark].line is truthy
            return markConfig.line === true ? {} : markConfig.line;
        }
        // markDef.point is defined as falsy
        return null;
    }
}
function normalizeNonFacetUnit(spec, config, parentEncoding, parentProjection) {
    var encoding = spec.encoding, projection = spec.projection;
    var mark = isMarkDef(spec.mark) ? spec.mark.type : spec.mark;
    // merge parent encoding / projection first
    if (parentEncoding || parentProjection) {
        var mergedProjection = mergeProjection({ parentProjection: parentProjection, projection: projection });
        var mergedEncoding = mergeEncoding({ parentEncoding: parentEncoding, encoding: encoding });
        return normalizeNonFacetUnit(tslib_1.__assign({}, spec, (mergedProjection ? { projection: mergedProjection } : {}), (mergedEncoding ? { encoding: mergedEncoding } : {})), config);
    }
    if (isNonFacetUnitSpecWithPrimitiveMark(spec)) {
        // TODO: thoroughly test
        if (isRanged(encoding)) {
            return normalizeRangedUnit(spec);
        }
        if (mark === 'line' && (encoding.x2 || encoding.y2)) {
            log.warn(log.message.lineWithRange(!!encoding.x2, !!encoding.y2));
            return normalizeNonFacetUnit(tslib_1.__assign({ mark: 'rule' }, spec), config, parentEncoding, parentProjection);
        }
        if (isPathMark(mark)) {
            return normalizePathOverlay(spec, config);
        }
        return spec; // Nothing to normalize
    }
    else {
        return compositeMark.normalize(spec, config);
    }
}
function normalizeRangedUnit(spec) {
    var hasX = channelHasField(spec.encoding, X);
    var hasY = channelHasField(spec.encoding, Y);
    var hasX2 = channelHasField(spec.encoding, X2);
    var hasY2 = channelHasField(spec.encoding, Y2);
    if ((hasX2 && !hasX) || (hasY2 && !hasY)) {
        var normalizedSpec = duplicate(spec);
        if (hasX2 && !hasX) {
            normalizedSpec.encoding.x = normalizedSpec.encoding.x2;
            delete normalizedSpec.encoding.x2;
        }
        if (hasY2 && !hasY) {
            normalizedSpec.encoding.y = normalizedSpec.encoding.y2;
            delete normalizedSpec.encoding.y2;
        }
        return normalizedSpec;
    }
    return spec;
}
function dropLineAndPoint(markDef) {
    var _point = markDef.point, _line = markDef.line, mark = tslib_1.__rest(markDef, ["point", "line"]);
    return keys(mark).length > 1 ? mark : mark.type;
}
function normalizePathOverlay(spec, config) {
    if (config === void 0) { config = {}; }
    // _ is used to denote a dropped property of the unit spec
    // which should not be carried over to the layer spec
    var selection = spec.selection, projection = spec.projection, encoding = spec.encoding, mark = spec.mark, outerSpec = tslib_1.__rest(spec, ["selection", "projection", "encoding", "mark"]);
    var markDef = isMarkDef(mark) ? mark : { type: mark };
    var pointOverlay = getPointOverlay(markDef, config[markDef.type], encoding);
    var lineOverlay = markDef.type === 'area' && getLineOverlay(markDef, config[markDef.type]);
    if (!pointOverlay && !lineOverlay) {
        return tslib_1.__assign({}, spec, { 
            // Do not include point / line overlay in the normalize spec
            mark: dropLineAndPoint(markDef) });
    }
    var layer = [{
            // Do not include point / line overlay in the normalize spec
            mark: dropLineAndPoint(tslib_1.__assign({}, markDef, (markDef.type === 'area' ? { opacity: 0.7 } : {}))),
            encoding: encoding
        }];
    // FIXME: disable tooltip for the line layer if tooltip is not group-by field.
    // FIXME: determine rules for applying selections.
    // Need to copy stack config to overlayed layer
    var stackProps = stack(markDef, encoding, config ? config.stack : undefined);
    var overlayEncoding = encoding;
    if (stackProps) {
        var stackFieldChannel = stackProps.fieldChannel, offset = stackProps.offset;
        overlayEncoding = tslib_1.__assign({}, encoding, (_a = {}, _a[stackFieldChannel] = tslib_1.__assign({}, encoding[stackFieldChannel], (offset ? { stack: offset } : {})), _a));
    }
    if (lineOverlay) {
        layer.push(tslib_1.__assign({}, (projection ? { projection: projection } : {}), { mark: tslib_1.__assign({ type: 'line' }, lineOverlay) }, (selection ? { selection: selection } : {}), { encoding: overlayEncoding }));
    }
    if (pointOverlay) {
        layer.push(tslib_1.__assign({}, (projection ? { projection: projection } : {}), { mark: tslib_1.__assign({ type: 'point', opacity: 1, filled: true }, pointOverlay) }, (selection ? { selection: selection } : {}), { encoding: overlayEncoding }));
    }
    return tslib_1.__assign({}, outerSpec, { layer: layer });
    var _a;
}
// TODO: add vl.spec.validate & move stuff from vl.validate to here
/* Accumulate non-duplicate fieldDefs in a dictionary */
function accumulate(dict, defs) {
    defs.forEach(function (fieldDef) {
        // Consider only pure fieldDef properties (ignoring scale, axis, legend)
        var pureFieldDef = ['field', 'type', 'value', 'timeUnit', 'bin', 'aggregate'].reduce(function (f, key) {
            if (fieldDef[key] !== undefined) {
                f[key] = fieldDef[key];
            }
            return f;
        }, {});
        var key = hash(pureFieldDef);
        dict[key] = dict[key] || fieldDef;
    });
    return dict;
}
/* Recursively get fieldDefs from a spec, returns a dictionary of fieldDefs */
function fieldDefIndex(spec, dict) {
    if (dict === void 0) { dict = {}; }
    // FIXME(https://github.com/vega/vega-lite/issues/2207): Support fieldDefIndex for repeat
    if (isLayerSpec(spec)) {
        spec.layer.forEach(function (layer) {
            if (isUnitSpec(layer)) {
                accumulate(dict, vlEncoding.fieldDefs(layer.encoding));
            }
            else {
                fieldDefIndex(layer, dict);
            }
        });
    }
    else if (isFacetSpec(spec)) {
        accumulate(dict, vlEncoding.fieldDefs(spec.facet));
        fieldDefIndex(spec.spec, dict);
    }
    else if (isRepeatSpec(spec)) {
        fieldDefIndex(spec.spec, dict);
    }
    else if (isConcatSpec(spec)) {
        var childSpec = isVConcatSpec(spec) ? spec.vconcat : spec.hconcat;
        childSpec.forEach(function (child) { return fieldDefIndex(child, dict); });
    }
    else { // Unit Spec
        accumulate(dict, vlEncoding.fieldDefs(spec.encoding));
    }
    return dict;
}
/* Returns all non-duplicate fieldDefs in a spec in a flat array */
export function fieldDefs(spec) {
    return vals(fieldDefIndex(spec));
}
export function isStacked(spec, config) {
    config = config || spec.config;
    if (isPrimitiveMark(spec.mark)) {
        return stack(spec.mark, spec.encoding, config ? config.stack : undefined) !== null;
    }
    return false;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBQ25DLE9BQU8sRUFBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUNwRCxPQUFPLEtBQUssYUFBYSxNQUFNLGlCQUFpQixDQUFDO0FBR2pELE9BQU8sRUFBQyxlQUFlLEVBQStCLFFBQVEsRUFBQyxNQUFNLFlBQVksQ0FBQztBQUNsRixPQUFPLEtBQUssVUFBVSxNQUFNLFlBQVksQ0FBQztBQUd6QyxPQUFPLEtBQUssR0FBRyxNQUFNLE9BQU8sQ0FBQztBQUM3QixPQUFPLEVBQXNCLFNBQVMsRUFBRSxVQUFVLEVBQUUsZUFBZSxFQUE0QyxNQUFNLFFBQVEsQ0FBQztBQUs5SCxPQUFPLEVBQUMsS0FBSyxFQUFDLE1BQU0sU0FBUyxDQUFDO0FBSTlCLE9BQU8sRUFBTyxTQUFTLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUMsTUFBTSxRQUFRLENBQUM7QUFtUHpELHdCQUF3QjtBQUd4QixNQUFNLHNCQUFzQixJQUFjO0lBQ3hDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLFNBQVMsQ0FBQztBQUNyQyxDQUFDO0FBRUQsTUFBTSxxQkFBcUIsSUFBYztJQUN2QyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDeEIsQ0FBQztBQUVELE1BQU0sc0JBQXNCLElBQWM7SUFDeEMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssU0FBUyxDQUFDO0FBQ3JDLENBQUM7QUFFRCxNQUFNLHVCQUF1QixJQUFjO0lBQ3pDLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLFNBQVMsQ0FBQztBQUN0QyxDQUFD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QU0sSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQy9CLElBQUksZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUM5QixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQzdCLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUNsQyxLQUFLLElBQUksQ0FBQztLQUNsQjtJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7aXNPYmplY3R9IGZyb20gJ3ZlZ2EtdXRpbCc7XG5pbXBvcnQge0NPTFVNTiwgUk9XLCBYLCBYMiwgWSwgWTJ9IGZyb20gJy4vY2hhbm5lbCc7XG5pbXBvcnQgKiBhcyBjb21wb3NpdGVNYXJrIGZyb20gJy4vY29tcG9zaXRlbWFyayc7XG5pbXBvcnQge0NvbmZpZ30gZnJvbSAnLi9jb25maWcnO1xuaW1wb3J0IHtEYXRhfSBmcm9tICcuL2RhdGEnO1xuaW1wb3J0IHtjaGFubmVsSGFzRmllbGQsIEVuY29kaW5nLCBFbmNvZGluZ1dpdGhGYWNldCwgaXNSYW5nZWR9IGZyb20gJy4vZW5jb2RpbmcnO1xuaW1wb3J0ICogYXMgdmxFbmNvZGluZyBmcm9tICcuL2VuY29kaW5nJztcbmltcG9ydCB7RmFjZXRNYXBwaW5nfSBmcm9tICcuL2ZhY2V0JztcbmltcG9ydCB7RmllbGQsIEZpZWxkRGVmLCBSZXBlYXRSZWZ9IGZyb20gJy4vZmllbGRkZWYnO1xuaW1wb3J0ICogYXMgbG9nIGZyb20gJy4vbG9nJztcbmltcG9ydCB7QW55TWFyaywgQXJlYUNvbmZpZywgaXNNYXJrRGVmLCBpc1BhdGhNYXJrLCBpc1ByaW1pdGl2ZU1hcmssIExpbmVDb25maWcsIE1hcmssIE1hcmtEZWYsIE1hcmtQcm9wZXJ0aWVzfSBmcm9tICcuL21hcmsnO1xuaW1wb3J0IHtQcm9qZWN0aW9ufSBmcm9tICcuL3Byb2plY3Rpb24nO1xuaW1wb3J0IHtSZXBlYXR9IGZyb20gJy4vcmVwZWF0JztcbmltcG9ydCB7UmVzb2x2ZX0gZnJvbSAnLi9yZXNvbHZlJztcbmltcG9ydCB7U2VsZWN0aW9uRGVmfSBmcm9tICcuL3NlbGVjdGlvbic7XG5pbXBvcnQge3N0YWNrfSBmcm9tICcuL3N0YWNrJztcbmltcG9ydCB7VGl0bGVQYXJhbXN9IGZyb20gJy4vdGl0bGUnO1xuaW1wb3J0IHtUb3BMZXZlbFByb3BlcnRpZXN9IGZyb20gJy4vdG9wbGV2ZWxwcm9wcyc7XG5pbXBvcnQge1RyYW5zZm9ybX0gZnJvbSAnLi90cmFuc2Zvcm0nO1xuaW1wb3J0IHtEaWN0LCBkdXBsaWNhdGUsIGhhc2gsIGtleXMsIHZhbHN9IGZyb20gJy4vdXRpbCc7XG5cblxuZXhwb3J0IHR5cGUgVG9wTGV2ZWw8UyBleHRlbmRzIEJhc2VTcGVjPiA9IFMgJiBUb3BMZXZlbFByb3BlcnRpZXMgJiB7XG4gIC8qKlxuICAgKiBVUkwgdG8gW0pTT04gc2NoZW1hXShodHRwOi8vanNvbi1zY2hlbWEub3JnLykgZm9yIGEgVmVnYS1MaXRlIHNwZWNpZmljYXRpb24uIFVubGVzcyB5b3UgaGF2ZSBhIHJlYXNvbiB0byBjaGFuZ2UgdGhpcywgdXNlIGBodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3NjaGVtYS92ZWdhLWxpdGUvdjIuanNvbmAuIFNldHRpbmcgdGhlIGAkc2NoZW1hYCBwcm9wZXJ0eSBhbGxvd3MgYXV0b21hdGljIHZhbGlkYXRpb24gYW5kIGF1dG9jb21wbGV0ZSBpbiBlZGl0b3JzIHRoYXQgc3VwcG9ydCBKU09OIHNjaGVtYS5cbiAgICogQGZvcm1hdCB1cmlcbiAgICovXG4gICRzY2hlbWE/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFZlZ2EtTGl0ZSBjb25maWd1cmF0aW9uIG9iamVjdC4gIFRoaXMgcHJvcGVydHkgY2FuIG9ubHkgYmUgZGVmaW5lZCBhdCB0aGUgdG9wLWxldmVsIG9mIGEgc3BlY2lmaWNhdGlvbi5cbiAgICovXG4gIGNvbmZpZz86IENvbmZpZztcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgQmFzZVNwZWMge1xuICAvKipcbiAgICogVGl0bGUgZm9yIHRoZSBwbG90LlxuICAgKi9cbiAgdGl0bGU/OiBzdHJpbmcgfCBUaXRsZVBhcmFtcztcblxuICAvKipcbiAgICogTmFtZSBvZiB0aGUgdmlzdWFsaXphdGlvbiBmb3IgbGF0ZXIgcmVmZXJlbmNlLlxuICAgKi9cbiAgbmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogRGVzY3JpcHRpb24gb2YgdGhpcyBtYXJrIGZvciBjb21tZW50aW5nIHB1cnBvc2UuXG4gICAqL1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogQW4gb2JqZWN0IGRlc2NyaWJpbmcgdGhlIGRhdGEgc291cmNlXG4gICAqL1xuICBkYXRhPzogRGF0YTtcblxuICAvKipcbiAgICogQW4gYXJyYXkgb2YgZGF0YSB0cmFuc2Zvcm1hdGlvbnMgc3VjaCBhcyBmaWx0ZXIgYW5kIG5ldyBmaWVsZCBjYWxjdWxhdGlvbi5cbiAgICovXG4gIHRyYW5zZm9ybT86IFRyYW5zZm9ybVtdO1xufVxuXG5leHBvcnQgdHlwZSBEYXRhUmVxdWlyZWQgPSB7XG4gIC8qKlxuICAgKiBBbiBvYmplY3QgZGVzY3JpYmluZyB0aGUgZGF0YSBzb3VyY2VcbiAgICovXG4gIGRhdGE6IERhdGE7XG59O1xuXG5cbi8vIFRPRE8oaHR0cHM6Ly9naXRodWIuY29tL3ZlZ2EvdmVnYS1saXRlL2lzc3Vlcy8yNTAzKTogTWFrZSB0aGlzIGdlbmVyaWMgc28gd2UgY2FuIHN1cHBvcnQgc29tZSBmb3JtIG9mIHRvcC1kb3duIHNpemluZy5cbmV4cG9ydCBpbnRlcmZhY2UgTGF5b3V0U2l6ZU1peGlucyB7XG4gIC8qKlxuICAgKiBUaGUgd2lkdGggb2YgYSB2aXN1YWxpemF0aW9uLlxuICAgKlxuICAgKiBfX0RlZmF1bHQgdmFsdWU6X18gVGhpcyB3aWxsIGJlIGRldGVybWluZWQgYnkgdGhlIGZvbGxvd2luZyBydWxlczpcbiAgICpcbiAgICogLSBJZiBhIHZpZXcncyBbYGF1dG9zaXplYF0oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9zaXplLmh0bWwjYXV0b3NpemUpIHR5cGUgaXMgYFwiZml0XCJgIG9yIGl0cyB4LWNoYW5uZWwgaGFzIGEgW2NvbnRpbnVvdXMgc2NhbGVdKGh0dHBzOi8vdmVnYS5naXRodWIuaW8vdmVnYS1saXRlL2RvY3Mvc2NhbGUuaHRtbCNjb250aW51b3VzKSwgdGhlIHdpZHRoIHdpbGwgYmUgdGhlIHZhbHVlIG9mIFtgY29uZmlnLnZpZXcud2lkdGhgXShodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EtbGl0ZS9kb2NzL3NwZWMuaHRtbCNjb25maWcpLlxuICAgKiAtIEZvciB4LWF4aXMgd2l0aCBhIGJhbmQgb3IgcG9pbnQgc2NhbGU6IGlmIFtgcmFuZ2VTdGVwYF0oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9zY2FsZS5odG1sI2JhbmQpIGlzIGEgbnVtZXJpYyB2YWx1ZSBvciB1bnNwZWNpZmllZCwgdGhlIHdpZHRoIGlzIFtkZXRlcm1pbmVkIGJ5IHRoZSByYW5nZSBzdGVwLCBwYWRkaW5ncywgYW5kIHRoZSBjYXJkaW5hbGl0eSBvZiB0aGUgZmllbGQgbWFwcGVkIHRvIHgtY2hhbm5lbF0oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9zY2FsZS5odG1sI2JhbmQpLiAgIE90aGVyd2lzZSwgaWYgdGhlIGByYW5nZVN0ZXBgIGlzIGBudWxsYCwgdGhlIHdpZHRoIHdpbGwgYmUgdGhlIHZhbHVlIG9mIFtgY29uZmlnLnZpZXcud2lkdGhgXShodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EtbGl0ZS9kb2NzL3NwZWMuaHRtbCNjb25maWcpLlxuICAgKiAtIElmIG5vIGZpZWxkIGlzIG1hcHBlZCB0byBgeGAgY2hhbm5lbCwgdGhlIGB3aWR0aGAgd2lsbCBiZSB0aGUgdmFsdWUgb2YgW2Bjb25maWcuc2NhbGUudGV4dFhSYW5nZVN0ZXBgXShodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EtbGl0ZS9kb2NzL3NpemUuaHRtbCNkZWZhdWx0LXdpZHRoLWFuZC1oZWlnaHQpIGZvciBgdGV4dGAgbWFyayBhbmQgdGhlIHZhbHVlIG9mIGByYW5nZVN0ZXBgIGZvciBvdGhlciBtYXJrcy5cbiAgICpcbiAgICogX19Ob3RlOl9fIEZvciBwbG90cyB3aXRoIFtgcm93YCBhbmQgYGNvbHVtbmAgY2hhbm5lbHNdKGh0dHBzOi8vdmVnYS5naXRodWIuaW8vdmVnYS1saXRlL2RvY3MvZW5jb2RpbmcuaHRtbCNmYWNldCksIHRoaXMgcmVwcmVzZW50cyB0aGUgd2lkdGggb2YgYSBzaW5nbGUgdmlldy5cbiAgICpcbiAgICogX19TZWUgYWxzbzpfXyBUaGUgZG9jdW1lbnRhdGlvbiBmb3IgW3dpZHRoIGFuZCBoZWlnaHRdKGh0dHBzOi8vdmVnYS5naXRodWIuaW8vdmVnYS1saXRlL2RvY3Mvc2l6ZS5odG1sKSBjb250YWlucyBtb3JlIGV4YW1wbGVzLlxuICAgKi9cbiAgd2lkdGg/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBoZWlnaHQgb2YgYSB2aXN1YWxpemF0aW9uLlxuICAgKlxuICAgKiBfX0RlZmF1bHQgdmFsdWU6X19cbiAgICogLSBJZiBhIHZpZXcncyBbYGF1dG9zaXplYF0oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9zaXplLmh0bWwjYXV0b3NpemUpIHR5cGUgaXMgYFwiZml0XCJgIG9yIGl0cyB5LWNoYW5uZWwgaGFzIGEgW2NvbnRpbnVvdXMgc2NhbGVdKGh0dHBzOi8vdmVnYS5naXRodWIuaW8vdmVnYS1saXRlL2RvY3Mvc2NhbGUuaHRtbCNjb250aW51b3VzKSwgdGhlIGhlaWdodCB3aWxsIGJlIHRoZSB2YWx1ZSBvZiBbYGNvbmZpZy52aWV3LmhlaWdodGBdKGh0dHBzOi8vdmVnYS5naXRodWIuaW8vdmVnYS1saXRlL2RvY3Mvc3BlYy5odG1sI2NvbmZpZykuXG4gICAqIC0gRm9yIHktYXhpcyB3aXRoIGEgYmFuZCBvciBwb2ludCBzY2FsZTogaWYgW2ByYW5nZVN0ZXBgXShodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EtbGl0ZS9kb2NzL3NjYWxlLmh0bWwjYmFuZCkgaXMgYSBudW1lcmljIHZhbHVlIG9yIHVuc3BlY2lmaWVkLCB0aGUgaGVpZ2h0IGlzIFtkZXRlcm1pbmVkIGJ5IHRoZSByYW5nZSBzdGVwLCBwYWRkaW5ncywgYW5kIHRoZSBjYXJkaW5hbGl0eSBvZiB0aGUgZmllbGQgbWFwcGVkIHRvIHktY2hhbm5lbF0oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9zY2FsZS5odG1sI2JhbmQpLiBPdGhlcndpc2UsIGlmIHRoZSBgcmFuZ2VTdGVwYCBpcyBgbnVsbGAsIHRoZSBoZWlnaHQgd2lsbCBiZSB0aGUgdmFsdWUgb2YgW2Bjb25maWcudmlldy5oZWlnaHRgXShodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EtbGl0ZS9kb2NzL3NwZWMuaHRtbCNjb25maWcpLlxuICAgKiAtIElmIG5vIGZpZWxkIGlzIG1hcHBlZCB0byBgeWAgY2hhbm5lbCwgdGhlIGBoZWlnaHRgIHdpbGwgYmUgdGhlIHZhbHVlIG9mIGByYW5nZVN0ZXBgLlxuICAgKlxuICAgKiBfX05vdGVfXzogRm9yIHBsb3RzIHdpdGggW2Byb3dgIGFuZCBgY29sdW1uYCBjaGFubmVsc10oaHR0cHM6Ly92ZWdhLmdpdGh1Yi5pby92ZWdhLWxpdGUvZG9jcy9lbmNvZGluZy5odG1sI2ZhY2V0KSwgdGhpcyByZXByZXNlbnRzIHRoZSBoZWlnaHQgb2YgYSBzaW5nbGUgdmlldy5cbiAgICpcbiAgICogX19TZWUgYWxzbzpfXyBUaGUgZG9jdW1lbnRhdGlvbiBmb3IgW3dpZHRoIGFuZCBoZWlnaHRdKGh0dHBzOi8vdmVnYS5naXRodWIuaW8vdmVnYS1saXRlL2RvY3Mvc2l6ZS5odG1sKSBjb250YWlucyBtb3JlIGV4YW1wbGVzLlxuICAgKi9cbiAgaGVpZ2h0PzogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyaWNVbml0U3BlYzxFIGV4dGVuZHMgRW5jb2Rpbmc8YW55PiwgTT4gZXh0ZW5kcyBCYXNlU3BlYywgTGF5b3V0U2l6ZU1peGlucyB7XG5cbiAgLyoqXG4gICAqIEEgc3RyaW5nIGRlc2NyaWJpbmcgdGhlIG1hcmsgdHlwZSAob25lIG9mIGBcImJhclwiYCwgYFwiY2lyY2xlXCJgLCBgXCJzcXVhcmVcImAsIGBcInRpY2tcImAsIGBcImxpbmVcImAsXG4gICAqIGBcImFyZWFcImAsIGBcInBvaW50XCJgLCBgXCJydWxlXCJgLCBgXCJnZW9zaGFwZVwiYCwgYW5kIGBcInRleHRcImApIG9yIGEgW21hcmsgZGVmaW5pdGlvbiBvYmplY3RdKGh0dHBzOi8vdmVnYS5naXRodWIuaW8vdmVnYS1saXRlL2RvY3MvbWFyay5odG1sI21hcmstZGVmKS5cbiAgICovXG4gIG1hcms6IE07XG5cbiAgLyoqXG4gICAqIEEga2V5LXZhbHVlIG1hcHBpbmcgYmV0d2VlbiBlbmNvZGluZyBjaGFubmVscyBhbmQgZGVmaW5pdGlvbiBvZiBmaWVsZHMuXG4gICAqL1xuICBlbmNvZGluZz86IEU7XG5cblxuICAvKipcbiAgICogQW4gb2JqZWN0IGRlZmluaW5nIHByb3BlcnRpZXMgb2YgZ2VvZ3JhcGhpYyBwcm9qZWN0aW9uLCB3aGljaCB3aWxsIGJlIGFwcGxpZWQgdG8gYHNoYXBlYCBwYXRoIGZvciBgXCJnZW9zaGFwZVwiYCBtYXJrc1xuICAgKiBhbmQgdG8gYGxhdGl0dWRlYCBhbmQgYFwibG9uZ2l0dWRlXCJgIGNoYW5uZWxzIGZvciBvdGhlciBtYXJrcy5cbiAgICovXG4gIHByb2plY3Rpb24/OiBQcm9qZWN0aW9uO1xuXG4gIC8qKlxuICAgKiBBIGtleS12YWx1ZSBtYXBwaW5nIGJldHdlZW4gc2VsZWN0aW9uIG5hbWVzIGFuZCBkZWZpbml0aW9ucy5cbiAgICovXG4gIHNlbGVjdGlvbj86IHtbbmFtZTogc3RyaW5nXTogU2VsZWN0aW9uRGVmfTtcbn1cblxuZXhwb3J0IHR5cGUgTm9ybWFsaXplZFVuaXRTcGVjID0gR2VuZXJpY1VuaXRTcGVjPEVuY29kaW5nPHN0cmluZyB8IFJlcGVhdFJlZj4sIE1hcmsgfCBNYXJrRGVmPjtcblxuLyoqXG4gKiBVbml0IHNwZWMgdGhhdCBjYW4gaGF2ZSBhIGNvbXBvc2l0ZSBtYXJrLlxuICovXG5leHBvcnQgdHlwZSBDb21wb3NpdGVVbml0U3BlYyA9IEdlbmVyaWNVbml0U3BlYzxFbmNvZGluZzxzdHJpbmcgfCBSZXBlYXRSZWY+LCBBbnlNYXJrPjtcblxuLyoqXG4gKiBVbml0IHNwZWMgdGhhdCBjYW4gaGF2ZSBhIGNvbXBvc2l0ZSBtYXJrIGFuZCByb3cgb3IgY29sdW1uIGNoYW5uZWxzLlxuICovXG5leHBvcnQgdHlwZSBGYWNldGVkQ29tcG9zaXRlVW5pdFNwZWMgPSBHZW5lcmljVW5pdFNwZWM8RW5jb2RpbmdXaXRoRmFjZXQ8c3RyaW5nIHwgUmVwZWF0UmVmPiwgQW55TWFyaz47XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2VuZXJpY0xheWVyU3BlYzxVIGV4dGVuZHMgR2VuZXJpY1VuaXRTcGVjPGFueSwgYW55Pj4gZXh0ZW5kcyBCYXNlU3BlYywgTGF5b3V0U2l6ZU1peGlucyB7XG4gIC8qKlxuICAgKiBMYXllciBvciBzaW5nbGUgdmlldyBzcGVjaWZpY2F0aW9ucyB0byBiZSBsYXllcmVkLlxuICAgKlxuICAgKiBfX05vdGVfXzogU3BlY2lmaWNhdGlvbnMgaW5zaWRlIGBsYXllcmAgY2Fubm90IHVzZSBgcm93YCBhbmQgYGNvbHVtbmAgY2hhbm5lbHMgYXMgbGF5ZXJpbmcgZmFjZXQgc3BlY2lmaWNhdGlvbnMgaXMgbm90IGFsbG93ZWQuXG4gICAqL1xuICBsYXllcjogKEdlbmVyaWNMYXllclNwZWM8VT4gfCBVKVtdO1xuXG4gIC8qKlxuICAgKiBTY2FsZSwgYXhpcywgYW5kIGxlZ2VuZCByZXNvbHV0aW9ucyBmb3IgbGF5ZXJzLlxuICAgKi9cbiAgcmVzb2x2ZT86IFJlc29sdmU7XG59XG5cbi8qKlxuICogTGF5ZXIgU3BlYyB3aXRoIGVuY29kaW5nIGFuZCBwcm9qZWN0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRXh0ZW5kZWRMYXllclNwZWMgZXh0ZW5kcyBHZW5lcmljTGF5ZXJTcGVjPENvbXBvc2l0ZVVuaXRTcGVjPiB7XG4gIC8qKlxuICAgKiBBIHNoYXJlZCBrZXktdmFsdWUgbWFwcGluZyBiZXR3ZWVuIGVuY29kaW5nIGNoYW5uZWxzIGFuZCBkZWZpbml0aW9uIG9mIGZpZWxkcyBpbiB0aGUgdW5kZXJseWluZyBsYXllcnMuXG4gICAqL1xuICBlbmNvZGluZz86IEVuY29kaW5nPHN0cmluZyB8IFJlcGVhdFJlZj47XG5cblxuICAvKipcbiAgICogQW4gb2JqZWN0IGRlZmluaW5nIHByb3BlcnRpZXMgb2YgdGhlIGdlb2dyYXBoaWMgcHJvamVjdGlvbiBzaGFyZWQgYnkgdW5kZXJseWluZyBsYXllcnMuXG4gICAqL1xuICBwcm9qZWN0aW9uPzogUHJvamVjdGlvbjtcbn1cblxuZXhwb3J0IHR5cGUgTm9ybWFsaXplZExheWVyU3BlYyA9IEdlbmVyaWNMYXllclNwZWM8Tm9ybWFsaXplZFVuaXRTcGVjPjtcblxuXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyaWNGYWNldFNwZWM8XG4gIFUgZXh0ZW5kcyBHZW5lcmljVW5pdFNwZWM8YW55LCBhbnk+LFxuICBMIGV4dGVuZHMgR2VuZXJpY0xheWVyU3BlYzxhbnk+XG4gID4gZXh0ZW5kcyBCYXNlU3BlYyB7XG4gIC8qKlxuICAgKiBBbiBvYmplY3QgdGhhdCBkZXNjcmliZXMgbWFwcGluZ3MgYmV0d2VlbiBgcm93YCBhbmQgYGNvbHVtbmAgY2hhbm5lbHMgYW5kIHRoZWlyIGZpZWxkIGRlZmluaXRpb25zLlxuICAgKi9cbiAgZmFjZXQ6IEZhY2V0TWFwcGluZzxzdHJpbmcgfCBSZXBlYXRSZWY+O1xuXG4gIC8qKlxuICAgKiBBIHNwZWNpZmljYXRpb24gb2YgdGhlIHZpZXcgdGhhdCBnZXRzIGZhY2V0ZWQuXG4gICAqL1xuICBzcGVjOiBMIHwgVTtcbiAgLy8gVE9ETzogcmVwbGFjZSB0aGlzIHdpdGggR2VuZXJpY1NwZWM8VT4gb25jZSB3ZSBzdXBwb3J0IGFsbCBjYXNlcztcblxuICAvKipcbiAgICogU2NhbGUsIGF4aXMsIGFuZCBsZWdlbmQgcmVzb2x1dGlvbnMgZm9yIGZhY2V0cy5cbiAgICovXG4gIHJlc29sdmU/OiBSZXNvbHZlO1xufVxuXG5leHBvcnQgdHlwZSBOb3JtYWxpemVkRmFjZXRTcGVjID0gR2VuZXJpY0ZhY2V0U3BlYzxOb3JtYWxpemVkVW5pdFNwZWMsIE5vcm1hbGl6ZWRMYXllclNwZWM+O1xuXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyaWNSZXBlYXRTcGVjPFxuICBVIGV4dGVuZHMgR2VuZXJpY1VuaXRTcGVjPGFueSwgYW55PixcbiAgTCBleHRlbmRzIEdlbmVyaWNMYXllclNwZWM8YW55PlxuPiBleHRlbmRzIEJhc2VTcGVjIHtcbiAgLyoqXG4gICAqIEFuIG9iamVjdCB0aGF0IGRlc2NyaWJlcyB3aGF0IGZpZWxkcyBzaG91bGQgYmUgcmVwZWF0ZWQgaW50byB2aWV3cyB0aGF0IGFyZSBsYWlkIG91dCBhcyBhIGByb3dgIG9yIGBjb2x1bW5gLlxuICAgKi9cbiAgcmVwZWF0OiBSZXBlYXQ7XG5cbiAgc3BlYzogR2VuZXJpY1NwZWM8VSwgTD47XG5cbiAgLyoqXG4gICAqIFNjYWxlIGFuZCBsZWdlbmQgcmVzb2x1dGlvbnMgZm9yIHJlcGVhdGVkIGNoYXJ0cy5cbiAgICovXG4gIHJlc29sdmU/OiBSZXNvbHZlO1xufVxuXG5leHBvcnQgdHlwZSBOb3JtYWxpemVkUmVwZWF0U3BlYyA9IEdlbmVyaWNSZXBlYXRTcGVjPE5vcm1hbGl6ZWRVbml0U3BlYywgTm9ybWFsaXplZExheWVyU3BlYz47XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2VuZXJpY1ZDb25jYXRTcGVjPFxuICBVIGV4dGVuZHMgR2VuZXJpY1VuaXRTcGVjPGFueSwgYW55PixcbiAgTCBleHRlbmRzIEdlbmVyaWNMYXllclNwZWM8YW55PlxuPiBleHRlbmRzIEJhc2VTcGVjIHtcbiAgLyoqXG4gICAqIEEgbGlzdCBvZiB2aWV3cyB0aGF0IHNob3VsZCBiZSBjb25jYXRlbmF0ZWQgYW5kIHB1dCBpbnRvIGEgY29sdW1uLlxuICAgKi9cbiAgdmNvbmNhdDogKEdlbmVyaWNTcGVjPFUsIEw+KVtdO1xuXG4gIC8qKlxuICAgKiBTY2FsZSwgYXhpcywgYW5kIGxlZ2VuZCByZXNvbHV0aW9ucyBmb3IgdmVydGljYWxseSBjb25jYXRlbmF0ZWQgY2hhcnRzLlxuICAgKi9cbiAgcmVzb2x2ZT86IFJlc29sdmU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2VuZXJpY0hDb25jYXRTcGVjPFxuICBVIGV4dGVuZHMgR2VuZXJpY1VuaXRTcGVjPGFueSwgYW55PixcbiAgTCBleHRlbmRzIEdlbmVyaWNMYXllclNwZWM8YW55PlxuPiBleHRlbmRzIEJhc2VTcGVjIHtcbiAgLyoqXG4gICAqIEEgbGlzdCBvZiB2aWV3cyB0aGF0IHNob3VsZCBiZSBjb25jYXRlbmF0ZWQgYW5kIHB1dCBpbnRvIGEgcm93LlxuICAgKi9cbiAgaGNvbmNhdDogKEdlbmVyaWNTcGVjPFUsIEw+KVtdO1xuXG4gIC8qKlxuICAgKiBTY2FsZSwgYXhpcywgYW5kIGxlZ2VuZCByZXNvbHV0aW9ucyBmb3IgaG9yaXpvbnRhbGx5IGNvbmNhdGVuYXRlZCBjaGFydHMuXG4gICAqL1xuICByZXNvbHZlPzogUmVzb2x2ZTtcbn1cblxuZXhwb3J0IHR5cGUgTm9ybWFsaXplZENvbmNhdFNwZWMgPVxuICBHZW5lcmljVkNvbmNhdFNwZWM8Tm9ybWFsaXplZFVuaXRTcGVjLCBOb3JtYWxpemVkTGF5ZXJTcGVjPiB8IEdlbmVyaWNIQ29uY2F0U3BlYzxOb3JtYWxpemVkVW5pdFNwZWMsIE5vcm1hbGl6ZWRMYXllclNwZWM+O1xuXG5leHBvcnQgdHlwZSBHZW5lcmljU3BlYzxcbiAgVSBleHRlbmRzIEdlbmVyaWNVbml0U3BlYzxhbnksIGFueT4sXG4gIEwgZXh0ZW5kcyBHZW5lcmljTGF5ZXJTcGVjPGFueT5cbj4gPSBVIHwgTCB8IEdlbmVyaWNGYWNldFNwZWM8VSwgTD4gfCBHZW5lcmljUmVwZWF0U3BlYzxVLCBMPiB8XG4gIEdlbmVyaWNWQ29uY2F0U3BlYzxVLCBMPiB8R2VuZXJpY0hDb25jYXRTcGVjPFUsIEw+O1xuXG5leHBvcnQgdHlwZSBOb3JtYWxpemVkU3BlYyA9IEdlbmVyaWNTcGVjPE5vcm1hbGl6ZWRVbml0U3BlYywgTm9ybWFsaXplZExheWVyU3BlYz47XG5cbmV4cG9ydCB0eXBlIFRvcExldmVsRmFjZXRlZFVuaXRTcGVjID0gVG9wTGV2ZWw8RmFjZXRlZENvbXBvc2l0ZVVuaXRTcGVjPiAmIERhdGFSZXF1aXJlZDtcbmV4cG9ydCB0eXBlIFRvcExldmVsRmFjZXRTcGVjID0gVG9wTGV2ZWw8R2VuZXJpY0ZhY2V0U3BlYzxDb21wb3NpdGVVbml0U3BlYywgRXh0ZW5kZWRMYXllclNwZWM+PiAmIERhdGFSZXF1aXJlZDtcblxuZXhwb3J0IHR5cGUgVG9wTGV2ZWxTcGVjID0gVG9wTGV2ZWxGYWNldGVkVW5pdFNwZWMgfCBUb3BMZXZlbEZhY2V0U3BlYyB8IFRvcExldmVsPEV4dGVuZGVkTGF5ZXJTcGVjPiB8XG5Ub3BMZXZlbDxHZW5lcmljUmVwZWF0U3BlYzxDb21wb3NpdGVVbml0U3BlYywgRXh0ZW5kZWRMYXllclNwZWM+PiB8IFRvcExldmVsPEdlbmVyaWNWQ29uY2F0U3BlYzxDb21wb3NpdGVVbml0U3BlYywgRXh0ZW5kZWRMYXllclNwZWM+PiB8IFRvcExldmVsPEdlbmVyaWNIQ29uY2F0U3BlYzxDb21wb3NpdGVVbml0U3BlYywgRXh0ZW5kZWRMYXllclNwZWM+PjtcblxuLyogQ3VzdG9tIHR5cGUgZ3VhcmRzICovXG5cblxuZXhwb3J0IGZ1bmN0aW9uIGlzRmFjZXRTcGVjKHNwZWM6IEJhc2VTcGVjKTogc3BlYyBpcyBHZW5lcmljRmFjZXRTcGVjPGFueSwgYW55PiB7XG4gIHJldHVybiBzcGVjWydmYWNldCddICE9PSB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1VuaXRTcGVjKHNwZWM6IEJhc2VTcGVjKTogc3BlYyBpcyBGYWNldGVkQ29tcG9zaXRlVW5pdFNwZWMgfCBOb3JtYWxpemVkVW5pdFNwZWMge1xuICByZXR1cm4gISFzcGVjWydtYXJrJ107XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0xheWVyU3BlYyhzcGVjOiBCYXNlU3BlYyk6IHNwZWMgaXMgR2VuZXJpY0xheWVyU3BlYzxhbnk+IHtcbiAgcmV0dXJuIHNwZWNbJ2xheWVyJ10gIT09IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzUmVwZWF0U3BlYyhzcGVjOiBCYXNlU3BlYyk6IHNwZWMgaXMgR2VuZXJpY1JlcGVhdFNwZWM8YW55LCBhbnk+IHtcbiAgcmV0dXJuIHNwZWNbJ3JlcGVhdCddICE9PSB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0NvbmNhdFNwZWMoc3BlYzogQmFzZVNwZWMpOlxuICBzcGVjIGlzIEdlbmVyaWNWQ29uY2F0U3BlYzxhbnksIGFueT4gfFxuICAgIEdlbmVyaWNIQ29uY2F0U3BlYzxhbnksIGFueT4ge1xuICByZXR1cm4gaXNWQ29uY2F0U3BlYyhzcGVjKSB8fCBpc0hDb25jYXRTcGVjKHNwZWMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNWQ29uY2F0U3BlYyhzcGVjOiBCYXNlU3BlYyk6IHNwZWMgaXMgR2VuZXJpY1ZDb25jYXRTcGVjPGFueSwgYW55PiB7XG4gIHJldHVybiBzcGVjWyd2Y29uY2F0J10gIT09IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzSENvbmNhdFNwZWMoc3BlYzogQmFzZVNwZWMpOiBzcGVjIGlzIEdlbmVyaWNIQ29uY2F0U3BlYzxhbnksIGFueT4ge1xuICByZXR1cm4gc3BlY1snaGNvbmNhdCddICE9PSB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogRGVjb21wb3NlIGV4dGVuZGVkIHVuaXQgc3BlY3MgaW50byBjb21wb3NpdGlvbiBvZiBwdXJlIHVuaXQgc3BlY3MuXG4gKi9cbi8vIFRPRE86IGNvbnNpZGVyIG1vdmluZyB0aGlzIHRvIGFub3RoZXIgZmlsZS4gIE1heWJlIHZsLnNwZWMubm9ybWFsaXplIG9yIHZsLm5vcm1hbGl6ZVxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZShzcGVjOiBUb3BMZXZlbFNwZWMgfCBHZW5lcmljU3BlYzxDb21wb3NpdGVVbml0U3BlYywgRXh0ZW5kZWRMYXllclNwZWM+IHwgRmFjZXRlZENvbXBvc2l0ZVVuaXRTcGVjLCBjb25maWc6IENvbmZpZyk6IE5vcm1hbGl6ZWRTcGVjIHtcbiAgaWYgKGlzRmFjZXRTcGVjKHNwZWMpKSB7XG4gICAgcmV0dXJuIG5vcm1hbGl6ZUZhY2V0KHNwZWMsIGNvbmZpZyk7XG4gIH1cbiAgaWYgKGlzTGF5ZXJTcGVjKHNwZWMpKSB7XG4gICAgcmV0dXJuIG5vcm1hbGl6ZUxheWVyKHNwZWMsIGNvbmZpZyk7XG4gIH1cbiAgaWYgKGlzUmVwZWF0U3BlYyhzcGVjKSkge1xuICAgIHJldHVybiBub3JtYWxpemVSZXBlYXQoc3BlYywgY29uZmlnKTtcbiAgfVxuICBpZiAoaXNWQ29uY2F0U3BlYyhzcGVjKSkge1xuICAgIHJldHVybiBub3JtYWxpemVWQ29uY2F0KHNwZWMsIGNvbmZpZyk7XG4gIH1cbiAgaWYgKGlzSENvbmNhdFNwZWMoc3BlYykpIHtcbiAgICByZXR1cm4gbm9ybWFsaXplSENvbmNhdChzcGVjLCBjb25maWcpO1xuICB9XG4gIGlmIChpc1VuaXRTcGVjKHNwZWMpKSB7XG4gICAgY29uc3QgaGFzUm93ID0gY2hhbm5lbEhhc0ZpZWxkKHNwZWMuZW5jb2RpbmcsIFJPVyk7XG4gICAgY29uc3QgaGFzQ29sdW1uID0gY2hhbm5lbEhhc0ZpZWxkKHNwZWMuZW5jb2RpbmcsIENPTFVNTik7XG5cbiAgICBpZiAoaGFzUm93IHx8IGhhc0NvbHVtbikge1xuICAgICAgcmV0dXJuIG5vcm1hbGl6ZUZhY2V0ZWRVbml0KHNwZWMsIGNvbmZpZyk7XG4gICAgfVxuICAgIHJldHVybiBub3JtYWxpemVOb25GYWNldFVuaXQoc3BlYywgY29uZmlnKTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IobG9nLm1lc3NhZ2UuSU5WQUxJRF9TUEVDKTtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplRmFjZXQoc3BlYzogR2VuZXJpY0ZhY2V0U3BlYzxDb21wb3NpdGVVbml0U3BlYywgRXh0ZW5kZWRMYXllclNwZWM+LCBjb25maWc6IENvbmZpZyk6IE5vcm1hbGl6ZWRGYWNldFNwZWMge1xuICBjb25zdCB7c3BlYzogc3Vic3BlYywgLi4ucmVzdH0gPSBzcGVjO1xuICByZXR1cm4ge1xuICAgIC4uLnJlc3QsXG4gICAgLy8gVE9ETzogcmVtb3ZlIFwiYW55XCIgb25jZSB3ZSBzdXBwb3J0IGFsbCBmYWNldCBsaXN0ZWQgaW4gaHR0cHM6Ly9naXRodWIuY29tL3ZlZ2EvdmVnYS1saXRlL2lzc3Vlcy8yNzYwXG4gICAgc3BlYzogbm9ybWFsaXplKHN1YnNwZWMsIGNvbmZpZykgYXMgYW55XG4gIH07XG59XG5cbmZ1bmN0aW9uIG1lcmdlRW5jb2Rpbmcob3B0OiB7cGFyZW50RW5jb2Rpbmc6IEVuY29kaW5nPGFueT4sIGVuY29kaW5nOiBFbmNvZGluZzxhbnk+fSk6IEVuY29kaW5nPGFueT4ge1xuICBjb25zdCB7cGFyZW50RW5jb2RpbmcsIGVuY29kaW5nfSA9IG9wdDtcbiAgaWYgKHBhcmVudEVuY29kaW5nICYmIGVuY29kaW5nKSB7XG4gICAgY29uc3Qgb3ZlcnJpZGVuID0ga2V5cyhwYXJlbnRFbmNvZGluZykucmVkdWNlKChvLCBrZXkpID0+IHtcbiAgICAgIGlmIChlbmNvZGluZ1trZXldKSB7XG4gICAgICAgIG8ucHVzaChrZXkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG87XG4gICAgfSwgW10pO1xuXG4gICAgaWYgKG92ZXJyaWRlbi5sZW5ndGggPiAwKSB7XG4gICAgICBsb2cud2Fybihsb2cubWVzc2FnZS5lbmNvZGluZ092ZXJyaWRkZW4ob3ZlcnJpZGVuKSk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgbWVyZ2VkID0ge1xuICAgIC4uLihwYXJlbnRFbmNvZGluZyB8fCB7fSksXG4gICAgLi4uKGVuY29kaW5nIHx8IHt9KVxuICB9O1xuICByZXR1cm4ga2V5cyhtZXJnZWQpLmxlbmd0aCA+IDAgPyBtZXJnZWQgOiB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIG1lcmdlUHJvamVjdGlvbihvcHQ6IHtwYXJlbnRQcm9qZWN0aW9uOiBQcm9qZWN0aW9uLCBwcm9qZWN0aW9uOiBQcm9qZWN0aW9ufSkge1xuICBjb25zdCB7cGFyZW50UHJvamVjdGlvbiwgcHJvamVjdGlvbn0gPSBvcHQ7XG4gIGlmIChwYXJlbnRQcm9qZWN0aW9uICYmIHByb2plY3Rpb24pIHtcbiAgICBsb2cud2Fybihsb2cubWVzc2FnZS5wcm9qZWN0aW9uT3ZlcnJpZGRlbih7cGFyZW50UHJvamVjdGlvbiwgcHJvamVjdGlvbn0pKTtcbiAgfVxuICByZXR1cm4gcHJvamVjdGlvbiB8fCBwYXJlbnRQcm9qZWN0aW9uO1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVMYXllcihcbiAgc3BlYzogRXh0ZW5kZWRMYXllclNwZWMsXG4gIGNvbmZpZzogQ29uZmlnLFxuICBwYXJlbnRFbmNvZGluZz86IEVuY29kaW5nPHN0cmluZyB8IFJlcGVhdFJlZj4sXG4gIHBhcmVudFByb2plY3Rpb24/OiBQcm9qZWN0aW9uXG4pOiBOb3JtYWxpemVkTGF5ZXJTcGVjIHtcbiAgY29uc3Qge2xheWVyLCBlbmNvZGluZywgcHJvamVjdGlvbiwgLi4ucmVzdH0gPSBzcGVjO1xuICBjb25zdCBtZXJnZWRFbmNvZGluZyA9IG1lcmdlRW5jb2Rpbmcoe3BhcmVudEVuY29kaW5nLCBlbmNvZGluZ30pO1xuICBjb25zdCBtZXJnZWRQcm9qZWN0aW9uID0gbWVyZ2VQcm9qZWN0aW9uKHtwYXJlbnRQcm9qZWN0aW9uLCBwcm9qZWN0aW9ufSk7XG4gIHJldHVybiB7XG4gICAgLi4ucmVzdCxcbiAgICBsYXllcjogbGF5ZXIubWFwKChzdWJzcGVjKSA9PiB7XG4gICAgICBpZiAoaXNMYXllclNwZWMoc3Vic3BlYykpIHtcbiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZUxheWVyKHN1YnNwZWMsIGNvbmZpZywgbWVyZ2VkRW5jb2RpbmcsIG1lcmdlZFByb2plY3Rpb24pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5vcm1hbGl6ZU5vbkZhY2V0VW5pdChzdWJzcGVjLCBjb25maWcsIG1lcmdlZEVuY29kaW5nLCBtZXJnZWRQcm9qZWN0aW9uKTtcbiAgICB9KVxuICB9O1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVSZXBlYXQoc3BlYzogR2VuZXJpY1JlcGVhdFNwZWM8Q29tcG9zaXRlVW5pdFNwZWMsIEV4dGVuZGVkTGF5ZXJTcGVjPiwgY29uZmlnOiBDb25maWcpOiBOb3JtYWxpemVkUmVwZWF0U3BlYyB7XG4gIGNvbnN0IHtzcGVjOiBzdWJzcGVjLCAuLi5yZXN0fSA9IHNwZWM7XG4gIHJldHVybiB7XG4gICAgLi4ucmVzdCxcbiAgICBzcGVjOiBub3JtYWxpemUoc3Vic3BlYywgY29uZmlnKVxuICB9O1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVWQ29uY2F0KHNwZWM6IEdlbmVyaWNWQ29uY2F0U3BlYzxDb21wb3NpdGVVbml0U3BlYywgRXh0ZW5kZWRMYXllclNwZWM+LCBjb25maWc6IENvbmZpZyk6IE5vcm1hbGl6ZWRDb25jYXRTcGVjIHtcbiAgY29uc3Qge3Zjb25jYXQ6IHZjb25jYXQsIC4uLnJlc3R9ID0gc3BlYztcbiAgcmV0dXJuIHtcbiAgICAuLi5yZXN0LFxuICAgIHZjb25jYXQ6IHZjb25jYXQubWFwKChzdWJzcGVjKSA9PiBub3JtYWxpemUoc3Vic3BlYywgY29uZmlnKSlcbiAgfTtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplSENvbmNhdChzcGVjOiBHZW5lcmljSENvbmNhdFNwZWM8Q29tcG9zaXRlVW5pdFNwZWMsIEV4dGVuZGVkTGF5ZXJTcGVjPiwgY29uZmlnOiBDb25maWcpOiBOb3JtYWxpemVkQ29uY2F0U3BlYyB7XG4gIGNvbnN0IHtoY29uY2F0OiBoY29uY2F0LCAuLi5yZXN0fSA9IHNwZWM7XG4gIHJldHVybiB7XG4gICAgLi4ucmVzdCxcbiAgICBoY29uY2F0OiBoY29uY2F0Lm1hcCgoc3Vic3BlYykgPT4gbm9ybWFsaXplKHN1YnNwZWMsIGNvbmZpZykpXG4gIH07XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUZhY2V0ZWRVbml0KHNwZWM6IEZhY2V0ZWRDb21wb3NpdGVVbml0U3BlYywgY29uZmlnOiBDb25maWcpOiBOb3JtYWxpemVkRmFjZXRTcGVjIHtcbiAgLy8gTmV3IGVuY29kaW5nIGluIHRoZSBpbnNpZGUgc3BlYyBzaG91bGQgbm90IGNvbnRhaW4gcm93IC8gY29sdW1uXG4gIC8vIGFzIHJvdy9jb2x1bW4gc2hvdWxkIGJlIG1vdmVkIHRvIGZhY2V0XG4gIGNvbnN0IHtyb3c6IHJvdywgY29sdW1uOiBjb2x1bW4sIC4uLmVuY29kaW5nfSA9IHNwZWMuZW5jb2Rpbmc7XG5cbiAgLy8gTWFyayBhbmQgZW5jb2Rpbmcgc2hvdWxkIGJlIG1vdmVkIGludG8gdGhlIGlubmVyIHNwZWNcbiAgY29uc3Qge21hcmssIHdpZHRoLCBwcm9qZWN0aW9uLCBoZWlnaHQsIHNlbGVjdGlvbiwgZW5jb2Rpbmc6IF8sIC4uLm91dGVyU3BlY30gPSBzcGVjO1xuXG4gIHJldHVybiB7XG4gICAgLi4ub3V0ZXJTcGVjLFxuICAgIGZhY2V0OiB7XG4gICAgICAuLi4ocm93ID8ge3Jvd30gOiB7fSksXG4gICAgICAuLi4oY29sdW1uID8ge2NvbHVtbn06IHt9KSxcbiAgICB9LFxuICAgIHNwZWM6IG5vcm1hbGl6ZU5vbkZhY2V0VW5pdCh7XG4gICAgICAuLi4ocHJvamVjdGlvbiA/IHtwcm9qZWN0aW9ufSA6IHt9KSxcbiAgICAgIG1hcmssXG4gICAgICAuLi4od2lkdGggPyB7d2lkdGh9IDoge30pLFxuICAgICAgLi4uKGhlaWdodCA/IHtoZWlnaHR9IDoge30pLFxuICAgICAgZW5jb2RpbmcsXG4gICAgICAuLi4oc2VsZWN0aW9uID8ge3NlbGVjdGlvbn0gOiB7fSlcbiAgICB9LCBjb25maWcpXG4gIH07XG59XG5cbmZ1bmN0aW9uIGlzTm9uRmFjZXRVbml0U3BlY1dpdGhQcmltaXRpdmVNYXJrKHNwZWM6IEdlbmVyaWNVbml0U3BlYzxFbmNvZGluZzxGaWVsZD4sIEFueU1hcms+KTpcbiAgc3BlYyBpcyBHZW5lcmljVW5pdFNwZWM8RW5jb2Rpbmc8RmllbGQ+LCBNYXJrPiB7XG4gICAgcmV0dXJuIGlzUHJpbWl0aXZlTWFyayhzcGVjLm1hcmspO1xufVxuXG5mdW5jdGlvbiBnZXRQb2ludE92ZXJsYXkobWFya0RlZjogTWFya0RlZiwgbWFya0NvbmZpZzogTGluZUNvbmZpZywgZW5jb2Rpbmc6IEVuY29kaW5nPEZpZWxkPik6IE1hcmtQcm9wZXJ0aWVzIHtcbiAgaWYgKG1hcmtEZWYucG9pbnQgPT09ICd0cmFuc3BhcmVudCcpIHtcbiAgICByZXR1cm4ge29wYWNpdHk6IDB9O1xuICB9IGVsc2UgaWYgKG1hcmtEZWYucG9pbnQpIHsgLy8gdHJ1dGh5IDogdHJ1ZSBvciBvYmplY3RcbiAgICByZXR1cm4gaXNPYmplY3QobWFya0RlZi5wb2ludCkgPyBtYXJrRGVmLnBvaW50IDoge307XG4gIH0gZWxzZSBpZiAobWFya0RlZi5wb2ludCAhPT0gdW5kZWZpbmVkKSB7IC8vIGZhbHNlIG9yIG51bGxcbiAgICByZXR1cm4gbnVsbDtcbiAgfSBlbHNlIHsgLy8gdW5kZWZpbmVkIChub3QgZGlzYWJsZWQpXG4gICAgaWYgKG1hcmtDb25maWcucG9pbnQgfHwgZW5jb2Rpbmcuc2hhcGUpIHtcbiAgICAgIC8vIGVuYWJsZSBwb2ludCBvdmVybGF5IGlmIGNvbmZpZ1ttYXJrXS5wb2ludCBpcyB0cnV0aHkgb3IgaWYgZW5jb2Rpbmcuc2hhcGUgaXMgcHJvdmlkZWRcbiAgICAgIHJldHVybiBpc09iamVjdChtYXJrQ29uZmlnLnBvaW50KSA/IG1hcmtDb25maWcucG9pbnQgOiB7fTtcbiAgICB9XG4gICAgLy8gbWFya0RlZi5wb2ludCBpcyBkZWZpbmVkIGFzIGZhbHN5XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0TGluZU92ZXJsYXkobWFya0RlZjogTWFya0RlZiwgbWFya0NvbmZpZzogQXJlYUNvbmZpZyk6IE1hcmtQcm9wZXJ0aWVzIHtcbiAgaWYgKG1hcmtEZWYubGluZSkgeyAvLyB0cnVlIG9yIG9iamVjdFxuICAgIHJldHVybiBtYXJrRGVmLmxpbmUgPT09IHRydWUgPyB7fSA6IG1hcmtEZWYubGluZTtcbiAgfSBlbHNlIGlmIChtYXJrRGVmLmxpbmUgIT09IHVuZGVmaW5lZCkgeyAvLyBmYWxzZSBvciBudWxsXG4gICAgcmV0dXJuIG51bGw7XG4gIH0gZWxzZSB7IC8vIHVuZGVmaW5lZCAobm90IGRpc2FibGVkKVxuICAgIGlmIChtYXJrQ29uZmlnLmxpbmUpIHtcbiAgICAgIC8vIGVuYWJsZSBsaW5lIG92ZXJsYXkgaWYgY29uZmlnW21hcmtdLmxpbmUgaXMgdHJ1dGh5XG4gICAgICByZXR1cm4gbWFya0NvbmZpZy5saW5lID09PSB0cnVlID8ge30gOiBtYXJrQ29uZmlnLmxpbmU7XG4gICAgfVxuICAgIC8vIG1hcmtEZWYucG9pbnQgaXMgZGVmaW5lZCBhcyBmYWxzeVxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZU5vbkZhY2V0VW5pdChcbiAgc3BlYzogR2VuZXJpY1VuaXRTcGVjPEVuY29kaW5nPEZpZWxkPiwgQW55TWFyaz4sIGNvbmZpZzogQ29uZmlnLFxuICBwYXJlbnRFbmNvZGluZz86IEVuY29kaW5nPHN0cmluZyB8IFJlcGVhdFJlZj4sIHBhcmVudFByb2plY3Rpb24/OiBQcm9qZWN0aW9uXG4pOiBOb3JtYWxpemVkVW5pdFNwZWMgfCBOb3JtYWxpemVkTGF5ZXJTcGVjIHtcbiAgY29uc3Qge2VuY29kaW5nLCBwcm9qZWN0aW9ufSA9IHNwZWM7XG4gIGNvbnN0IG1hcmsgPSBpc01hcmtEZWYoc3BlYy5tYXJrKSA/IHNwZWMubWFyay50eXBlIDogc3BlYy5tYXJrO1xuXG5cbiAgLy8gbWVyZ2UgcGFyZW50IGVuY29kaW5nIC8gcHJvamVjdGlvbiBmaXJzdFxuICBpZiAocGFyZW50RW5jb2RpbmcgfHwgcGFyZW50UHJvamVjdGlvbikge1xuICAgIGNvbnN0IG1lcmdlZFByb2plY3Rpb24gPSBtZXJnZVByb2plY3Rpb24oe3BhcmVudFByb2plY3Rpb24sIHByb2plY3Rpb259KTtcbiAgICBjb25zdCBtZXJnZWRFbmNvZGluZyA9IG1lcmdlRW5jb2Rpbmcoe3BhcmVudEVuY29kaW5nLCBlbmNvZGluZ30pO1xuICAgIHJldHVybiBub3JtYWxpemVOb25GYWNldFVuaXQoe1xuICAgICAgLi4uc3BlYyxcbiAgICAgIC4uLihtZXJnZWRQcm9qZWN0aW9uID8ge3Byb2plY3Rpb246IG1lcmdlZFByb2plY3Rpb259IDoge30pLFxuICAgICAgLi4uKG1lcmdlZEVuY29kaW5nID8ge2VuY29kaW5nOiBtZXJnZWRFbmNvZGluZ30gOiB7fSksXG4gICAgfSwgY29uZmlnKTtcbiAgfVxuXG4gIGlmIChpc05vbkZhY2V0VW5pdFNwZWNXaXRoUHJpbWl0aXZlTWFyayhzcGVjKSkge1xuICAgIC8vIFRPRE86IHRob3JvdWdobHkgdGVzdFxuICAgIGlmIChpc1JhbmdlZChlbmNvZGluZykpIHtcbiAgICAgIHJldHVybiBub3JtYWxpemVSYW5nZWRVbml0KHNwZWMpO1xuICAgIH1cblxuICAgIGlmIChtYXJrID09PSAnbGluZScgJiYgKGVuY29kaW5nLngyIHx8IGVuY29kaW5nLnkyKSkge1xuICAgICAgbG9nLndhcm4obG9nLm1lc3NhZ2UubGluZVdpdGhSYW5nZSghIWVuY29kaW5nLngyLCAhIWVuY29kaW5nLnkyKSk7XG5cbiAgICAgIHJldHVybiBub3JtYWxpemVOb25GYWNldFVuaXQoe1xuICAgICAgICBtYXJrOiAncnVsZScsXG4gICAgICAgIC4uLnNwZWNcbiAgICAgIH0sIGNvbmZpZywgcGFyZW50RW5jb2RpbmcsIHBhcmVudFByb2plY3Rpb24pO1xuICAgIH1cblxuICAgIGlmIChpc1BhdGhNYXJrKG1hcmspKSB7XG4gICAgICByZXR1cm4gbm9ybWFsaXplUGF0aE92ZXJsYXkoc3BlYywgY29uZmlnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3BlYzsgLy8gTm90aGluZyB0byBub3JtYWxpemVcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY29tcG9zaXRlTWFyay5ub3JtYWxpemUoc3BlYywgY29uZmlnKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBub3JtYWxpemVSYW5nZWRVbml0KHNwZWM6IE5vcm1hbGl6ZWRVbml0U3BlYykge1xuICBjb25zdCBoYXNYID0gY2hhbm5lbEhhc0ZpZWxkKHNwZWMuZW5jb2RpbmcsIFgpO1xuICBjb25zdCBoYXNZID0gY2hhbm5lbEhhc0ZpZWxkKHNwZWMuZW5jb2RpbmcsIFkpO1xuICBjb25zdCBoYXNYMiA9IGNoYW5uZWxIYXNGaWVsZChzcGVjLmVuY29kaW5nLCBYMik7XG4gIGNvbnN0IGhhc1kyID0gY2hhbm5lbEhhc0ZpZWxkKHNwZWMuZW5jb2RpbmcsIFkyKTtcbiAgaWYgKChoYXNYMiAmJiAhaGFzWCkgfHwgKGhhc1kyICYmICFoYXNZKSkge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRTcGVjID0gZHVwbGljYXRlKHNwZWMpO1xuICAgIGlmIChoYXNYMiAmJiAhaGFzWCkge1xuICAgICAgbm9ybWFsaXplZFNwZWMuZW5jb2RpbmcueCA9IG5vcm1hbGl6ZWRTcGVjLmVuY29kaW5nLngyO1xuICAgICAgZGVsZXRlIG5vcm1hbGl6ZWRTcGVjLmVuY29kaW5nLngyO1xuICAgIH1cbiAgICBpZiAoaGFzWTIgJiYgIWhhc1kpIHtcbiAgICAgIG5vcm1hbGl6ZWRTcGVjLmVuY29kaW5nLnkgPSBub3JtYWxpemVkU3BlYy5lbmNvZGluZy55MjtcbiAgICAgIGRlbGV0ZSBub3JtYWxpemVkU3BlYy5lbmNvZGluZy55MjtcbiAgICB9XG5cbiAgICByZXR1cm4gbm9ybWFsaXplZFNwZWM7XG4gIH1cbiAgcmV0dXJuIHNwZWM7XG59XG5cbmZ1bmN0aW9uIGRyb3BMaW5lQW5kUG9pbnQobWFya0RlZjogTWFya0RlZik6IE1hcmtEZWYgfCBNYXJrIHtcbiAgY29uc3Qge3BvaW50OiBfcG9pbnQsIGxpbmU6IF9saW5lLCAuLi5tYXJrfSA9IG1hcmtEZWY7XG5cbiAgcmV0dXJuIGtleXMobWFyaykubGVuZ3RoID4gMSA/IG1hcmsgOiBtYXJrLnR5cGU7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZVBhdGhPdmVybGF5KHNwZWM6IE5vcm1hbGl6ZWRVbml0U3BlYywgY29uZmlnOiBDb25maWcgPSB7fSk6IE5vcm1hbGl6ZWRMYXllclNwZWMgfCBOb3JtYWxpemVkVW5pdFNwZWMge1xuXG4gIC8vIF8gaXMgdXNlZCB0byBkZW5vdGUgYSBkcm9wcGVkIHByb3BlcnR5IG9mIHRoZSB1bml0IHNwZWNcbiAgLy8gd2hpY2ggc2hvdWxkIG5vdCBiZSBjYXJyaWVkIG92ZXIgdG8gdGhlIGxheWVyIHNwZWNcbiAgY29uc3Qge3NlbGVjdGlvbiwgcHJvamVjdGlvbiwgZW5jb2RpbmcsIG1hcmssIC4uLm91dGVyU3BlY30gPSBzcGVjO1xuICBjb25zdCBtYXJrRGVmID0gaXNNYXJrRGVmKG1hcmspID8gbWFyayA6IHt0eXBlOiBtYXJrfTtcblxuICBjb25zdCBwb2ludE92ZXJsYXkgPSBnZXRQb2ludE92ZXJsYXkobWFya0RlZiwgY29uZmlnW21hcmtEZWYudHlwZV0sIGVuY29kaW5nKTtcbiAgY29uc3QgbGluZU92ZXJsYXkgPSBtYXJrRGVmLnR5cGUgPT09ICdhcmVhJyAmJiBnZXRMaW5lT3ZlcmxheShtYXJrRGVmLCBjb25maWdbbWFya0RlZi50eXBlXSk7XG5cbiAgaWYgKCFwb2ludE92ZXJsYXkgJiYgIWxpbmVPdmVybGF5KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnNwZWMsXG4gICAgICAvLyBEbyBub3QgaW5jbHVkZSBwb2ludCAvIGxpbmUgb3ZlcmxheSBpbiB0aGUgbm9ybWFsaXplIHNwZWNcbiAgICAgIG1hcms6IGRyb3BMaW5lQW5kUG9pbnQobWFya0RlZilcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgbGF5ZXI6IE5vcm1hbGl6ZWRVbml0U3BlY1tdID0gW3tcbiAgICAvLyBEbyBub3QgaW5jbHVkZSBwb2ludCAvIGxpbmUgb3ZlcmxheSBpbiB0aGUgbm9ybWFsaXplIHNwZWNcbiAgICBtYXJrOiBkcm9wTGluZUFuZFBvaW50KHtcbiAgICAgIC4uLm1hcmtEZWYsXG4gICAgICAvLyBtYWtlIGFyZWEgbWFyayB0cmFuc2x1Y2VudCBieSBkZWZhdWx0XG4gICAgICAvLyBUT0RPOiBleHRyYWN0IHRoaXMgMC43IHRvIGJlIHNoYXJlZCB3aXRoIGRlZmF1bHQgb3BhY2l0eSBmb3IgcG9pbnQvdGljay8uLi5cbiAgICAgIC4uLihtYXJrRGVmLnR5cGUgPT09ICdhcmVhJyA/IHtvcGFjaXR5OiAwLjd9IDoge30pLFxuICAgIH0pLFxuICAgIGVuY29kaW5nXG4gIH1dO1xuXG4gIC8vIEZJWE1FOiBkaXNhYmxlIHRvb2x0aXAgZm9yIHRoZSBsaW5lIGxheWVyIGlmIHRvb2x0aXAgaXMgbm90IGdyb3VwLWJ5IGZpZWxkLlxuICAvLyBGSVhNRTogZGV0ZXJtaW5lIHJ1bGVzIGZvciBhcHBseWluZyBzZWxlY3Rpb25zLlxuXG4gIC8vIE5lZWQgdG8gY29weSBzdGFjayBjb25maWcgdG8gb3ZlcmxheWVkIGxheWVyXG4gIGNvbnN0IHN0YWNrUHJvcHMgPSBzdGFjayhtYXJrRGVmLCBlbmNvZGluZywgY29uZmlnID8gY29uZmlnLnN0YWNrIDogdW5kZWZpbmVkKTtcblxuICBsZXQgb3ZlcmxheUVuY29kaW5nID0gZW5jb2Rpbmc7XG4gIGlmIChzdGFja1Byb3BzKSB7XG4gICAgY29uc3Qge2ZpZWxkQ2hhbm5lbDogc3RhY2tGaWVsZENoYW5uZWwsIG9mZnNldH0gPSBzdGFja1Byb3BzO1xuICAgIG92ZXJsYXlFbmNvZGluZyA9IHtcbiAgICAgIC4uLmVuY29kaW5nLFxuICAgICAgW3N0YWNrRmllbGRDaGFubmVsXToge1xuICAgICAgICAuLi5lbmNvZGluZ1tzdGFja0ZpZWxkQ2hhbm5lbF0sXG4gICAgICAgIC4uLihvZmZzZXQgPyB7c3RhY2s6IG9mZnNldH0gOiB7fSlcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgaWYgKGxpbmVPdmVybGF5KSB7XG4gICAgbGF5ZXIucHVzaCh7XG4gICAgICAuLi4ocHJvamVjdGlvbiA/IHtwcm9qZWN0aW9ufSA6IHt9KSxcbiAgICAgIG1hcms6IHtcbiAgICAgICAgdHlwZTogJ2xpbmUnLFxuICAgICAgICAuLi5saW5lT3ZlcmxheVxuICAgICAgfSxcbiAgICAgIC4uLihzZWxlY3Rpb24gPyB7c2VsZWN0aW9ufSA6IHt9KSxcbiAgICAgIGVuY29kaW5nOiBvdmVybGF5RW5jb2RpbmdcbiAgICB9KTtcbiAgfVxuICBpZiAocG9pbnRPdmVybGF5KSB7XG4gICAgbGF5ZXIucHVzaCh7XG4gICAgICAuLi4ocHJvamVjdGlvbiA/IHtwcm9qZWN0aW9ufSA6IHt9KSxcbiAgICAgIG1hcms6IHtcbiAgICAgICAgdHlwZTogJ3BvaW50JyxcbiAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgZmlsbGVkOiB0cnVlLFxuICAgICAgICAuLi5wb2ludE92ZXJsYXlcbiAgICAgIH0sXG4gICAgICAuLi4oc2VsZWN0aW9uID8ge3NlbGVjdGlvbn0gOiB7fSksXG4gICAgICBlbmNvZGluZzogb3ZlcmxheUVuY29kaW5nXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIC4uLm91dGVyU3BlYyxcbiAgICBsYXllclxuICB9O1xufVxuXG4vLyBUT0RPOiBhZGQgdmwuc3BlYy52YWxpZGF0ZSAmIG1vdmUgc3R1ZmYgZnJvbSB2bC52YWxpZGF0ZSB0byBoZXJlXG5cbi8qIEFjY3VtdWxhdGUgbm9uLWR1cGxpY2F0ZSBmaWVsZERlZnMgaW4gYSBkaWN0aW9uYXJ5ICovXG5mdW5jdGlvbiBhY2N1bXVsYXRlKGRpY3Q6IGFueSwgZGVmczogRmllbGREZWY8RmllbGQ+W10pOiBhbnkge1xuICBkZWZzLmZvckVhY2goZnVuY3Rpb24oZmllbGREZWYpIHtcbiAgICAvLyBDb25zaWRlciBvbmx5IHB1cmUgZmllbGREZWYgcHJvcGVydGllcyAoaWdub3Jpbmcgc2NhbGUsIGF4aXMsIGxlZ2VuZClcbiAgICBjb25zdCBwdXJlRmllbGREZWYgPSBbJ2ZpZWxkJywgJ3R5cGUnLCAndmFsdWUnLCAndGltZVVuaXQnLCAnYmluJywgJ2FnZ3JlZ2F0ZSddLnJlZHVjZSgoZiwga2V5KSA9PiB7XG4gICAgICBpZiAoZmllbGREZWZba2V5XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGZba2V5XSA9IGZpZWxkRGVmW2tleV07XG4gICAgICB9XG4gICAgICByZXR1cm4gZjtcbiAgICB9LCB7fSk7XG4gICAgY29uc3Qga2V5ID0gaGFzaChwdXJlRmllbGREZWYpO1xuICAgIGRpY3Rba2V5XSA9IGRpY3Rba2V5XSB8fCBmaWVsZERlZjtcbiAgfSk7XG4gIHJldHVybiBkaWN0O1xufVxuXG4vKiBSZWN1cnNpdmVseSBnZXQgZmllbGREZWZzIGZyb20gYSBzcGVjLCByZXR1cm5zIGEgZGljdGlvbmFyeSBvZiBmaWVsZERlZnMgKi9cbmZ1bmN0aW9uIGZpZWxkRGVmSW5kZXg8VD4oc3BlYzogR2VuZXJpY1NwZWM8YW55LCBhbnk+LCBkaWN0OiBEaWN0PEZpZWxkRGVmPFQ+PiA9IHt9KTogRGljdDxGaWVsZERlZjxUPj4ge1xuICAvLyBGSVhNRShodHRwczovL2dpdGh1Yi5jb20vdmVnYS92ZWdhLWxpdGUvaXNzdWVzLzIyMDcpOiBTdXBwb3J0IGZpZWxkRGVmSW5kZXggZm9yIHJlcGVhdFxuICBpZiAoaXNMYXllclNwZWMoc3BlYykpIHtcbiAgICBzcGVjLmxheWVyLmZvckVhY2gobGF5ZXIgPT4ge1xuICAgICAgaWYgKGlzVW5pdFNwZWMobGF5ZXIpKSB7XG4gICAgICAgIGFjY3VtdWxhdGUoZGljdCwgdmxFbmNvZGluZy5maWVsZERlZnMobGF5ZXIuZW5jb2RpbmcpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpZWxkRGVmSW5kZXgobGF5ZXIsIGRpY3QpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2UgaWYgKGlzRmFjZXRTcGVjKHNwZWMpKSB7XG4gICAgYWNjdW11bGF0ZShkaWN0LCB2bEVuY29kaW5nLmZpZWxkRGVmcyhzcGVjLmZhY2V0KSk7XG4gICAgZmllbGREZWZJbmRleChzcGVjLnNwZWMsIGRpY3QpO1xuICB9IGVsc2UgaWYgKGlzUmVwZWF0U3BlYyhzcGVjKSkge1xuICAgIGZpZWxkRGVmSW5kZXgoc3BlYy5zcGVjLCBkaWN0KTtcbiAgfSBlbHNlIGlmIChpc0NvbmNhdFNwZWMoc3BlYykpIHtcbiAgICBjb25zdCBjaGlsZFNwZWMgPSBpc1ZDb25jYXRTcGVjKHNwZWMpID8gc3BlYy52Y29uY2F0IDogc3BlYy5oY29uY2F0O1xuICAgIGNoaWxkU3BlYy5mb3JFYWNoKGNoaWxkID0+IGZpZWxkRGVmSW5kZXgoY2hpbGQsIGRpY3QpKTtcbiAgfSBlbHNlIHsgLy8gVW5pdCBTcGVjXG4gICAgYWNjdW11bGF0ZShkaWN0LCB2bEVuY29kaW5nLmZpZWxkRGVmcyhzcGVjLmVuY29kaW5nKSk7XG4gIH1cbiAgcmV0dXJuIGRpY3Q7XG59XG5cbi8qIFJldHVybnMgYWxsIG5vbi1kdXBsaWNhdGUgZmllbGREZWZzIGluIGEgc3BlYyBpbiBhIGZsYXQgYXJyYXkgKi9cbmV4cG9ydCBmdW5jdGlvbiBmaWVsZERlZnMoc3BlYzogR2VuZXJpY1NwZWM8YW55LCBhbnk+KTogRmllbGREZWY8YW55PltdIHtcbiAgcmV0dXJuIHZhbHMoZmllbGREZWZJbmRleChzcGVjKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1N0YWNrZWQoc3BlYzogVG9wTGV2ZWw8RmFjZXRlZENvbXBvc2l0ZVVuaXRTcGVjPiwgY29uZmlnPzogQ29uZmlnKTogYm9vbGVhbiB7XG4gIGNvbmZpZyA9IGNvbmZpZyB8fCBzcGVjLmNvbmZpZztcbiAgaWYgKGlzUHJpbWl0aXZlTWFyayhzcGVjLm1hcmspKSB7XG4gICAgcmV0dXJuIHN0YWNrKHNwZWMubWFyaywgc3BlYy5lbmNvZGluZyxcbiAgICAgICAgICAgIGNvbmZpZyA/IGNvbmZpZy5zdGFjayA6IHVuZGVmaW5lZFxuICAgICAgICAgICkgIT09IG51bGw7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuIl19